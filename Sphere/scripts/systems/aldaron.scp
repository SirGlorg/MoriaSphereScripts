//////////////
/// EVENTS ///
//////////////
// 06D - action going home
// 044D - super farba, pouzi ju niekde :P
//////////////

[events e_ztracene_mesto_paladin_boss]
on=@death
  f_ring_column(2,0)
  f_ring_column(0,2)
  f_ring_column(-2,0)
  f_ring_column(0,-2)
  newitem(i_vargate)
  lastnew.p=<p>
  lastnew.color=0987
  lastnew.morep=807,633,0,2
  lastnew.timer=300
  lastnew.name=Zarici brana

[events e_ztracene_mesto_druid_medved]
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@aftergetswing
if !(tag(polymorfmdelay))
  tag(polymorfmdelay,<serv.time>+50)
  return 0
endif
if (rand(2)==1) && !(findid(i_druid_morf)) && (tag(polymorfmdelay) < <serv.time>)
  dorand 2
    tag(doceho,c_ztracene_mesto_druid_medved_morf)
    tag(doceho,c_ztracene_mesto_druid_vlk_morf)
  enddo
  newequip(i_druid_morf)
  lastnew.tag(zmenimsena,<tag(doceho)>)
endif
return 0

on=@beforegetswing
on=@beforedoeffect
on=@beforegeteffect

[itemdef i_druid_morf]
id=i_memory
type=t_eq_script
name=morfovatko

on=@create
timer=1

on=@equip
cont.events=+e_pojistka_druid_morf
cont.tag(changed,1)
tag(puvodnitelo,<cont.Obody>)
tag(puvodnijmeno,<cont.name>)
tag(puvodnibrain,<cont.brain>)
cont.action=065
cont.EFFECT(3,i_fx_sparkle,6,20,2)
cont.emote("changing!")

on=@unequip
cont.tag(changed,"")
cont.flag_immobile=0

on=@timer
cont.action=""
if !tag(secenznul)
  topobj.body=(<tag(zmenimsena)>)
  topobj.name=Druid
  tag(secenznul,1)
  timer=20
else
  topobj.events=-e_pojistka_druid_morf
  topobj.name=<tag(puvodnijmeno)>  
  topobj.body=<tag(puvodnitelo)>
  topobj.brain=<tag(puvodnibrain)>
  topobj.tag(polymorfmdelay,<serv.time>+100)//10s
  topobj.EFFECT(3,i_fx_sparkle,6,20,2)
  topobj.emote("changing!")
  remove
endif
return 1

[events e_pojistka_druid_morf]
on=@aftergetswing
if (hits) < (maxhits/10)
  tag(polymorfmdelay,<serv.time>+10000)
  findid(i_druid_morf).timer=0
endif
return 0

on=@beforegetswing
on=@beforedoeffect
on=@Created
on=@DrinkingPotion
on=@afterswing
on=@beforegeteffect

/////////////
/// seals ///
/////////////

[ITEMDEF i_ztracene_mesto_seal]
ID=i_crystal_ball
Name=Seal
TYPE=T_normal

ON=@CREATE
attr=010
color=0987

ON=@Timer
 if (0<tag(aktivovane) == 1>)
  name=Seal
 	color=0987
 	tag(aktivovane,0)
 endif
 if (0<tag(spawnute) == 1>)
 	tag(spawnute,0)
 endif
return 1

on=@userDClick
 if (<src.flags>&statf_dead)
   return 0
 endif
 if (tag(aktivovane) == 0)
   tag(aktivovane,1)
   name=Broken Seal
   color=098C
   timer=300
 endif
 if ((0<tag(seal).tag(aktivovane) == 1>) && (0<tag(aktivovane) == 1>) && (tag(spawnute) == 0) && (0<tag(seal).tag(aktivovane) == 1>))
   src.newnpc(<c_ztracene_mesto_paladin>)
   src.act.p=784,642,0,2
   src.act.home=784,642,0,2
   src.act.homedist=5
   src.act.newequip(i_mazatko_paladina)
   timer=1200
   tag(spawnute,1)
   tag(seal).tag(spawnute,1)
   tag(seal).timer=1200
 endif

[itemdef i_mazatko_paladina]
id=i_memory
type=t_eq_script
name=mazatko

on=@create
timer=7200

on=@timer
cont.remove
remove
  
/////////////////////
/// DVERE + KLICE ///
/////////////////////

[itemdef i_ztracene_mesto_dvere]
ID=i_door_metal
Type=t_door_locked
Name=Dvere

ON=@Create
attr=010

on=@UserDClick
if (<SRC.RESTEST(i_ztracene_mesto_kluc_1)> && <SRC.RESTEST(i_ztracene_mesto_kluc_2)> && <SRC.RESTEST(i_ztracene_mesto_kluc_3)> && <SRC.RESTEST(i_ztracene_mesto_kluc_4)> && <SRC.RESTEST(i_ztracene_mesto_kluc_5)>)
  src.consume(i_ztracene_mesto_kluc_1)
  src.consume(i_ztracene_mesto_kluc_2)
  src.consume(i_ztracene_mesto_kluc_3)
  src.consume(i_ztracene_mesto_kluc_4)
  src.consume(i_ztracene_mesto_kluc_5)
  type=t_door
  tag(zatvaratko).tag(otvorene,1)
  tag(zatvaratko).timer=180
endif
if (tag(zatvaratko).tag(otvorene) == 0)
  src.sysMessage("Dvere jsou pevne zavrene, ale vidis 5 otvoru na klice.")
endif
return 0

on=@Timer
  if !(<dispid> == <tag(dispID)>)
    dclick
  endif	
  return 1
  
[itemdef i_ztracene_mesto_dvere_zatvaratko]
ID=02C51
Type=t_script
Name=Zatvaratko

ON=@Create
attr=090
color=0986

on=@timer
if (0<tag(otvorene) == 1>)
tag(dvere).type=t_door_locked
endif
tag(otvorene,0)
return 1



///////////////
/// KLUCIKY ///
///////////////

[ITEMDEF i_ztracene_mesto_kluc_1]
ID=i_key_copper
Name=Klic
TYPE=T_normal

ON=@CREATE
color=0987

[ITEMDEF i_ztracene_mesto_kluc_2]
ID=i_key_copper
Name=Klic
TYPE=T_normal

ON=@CREATE
color=0987

[ITEMDEF i_ztracene_mesto_kluc_3]
ID=i_key_copper
Name=Klic
TYPE=T_normal

ON=@CREATE
color=0987

[ITEMDEF i_ztracene_mesto_kluc_4]
ID=i_key_copper
Name=Klic
TYPE=T_normal

ON=@CREATE
color=0987

[ITEMDEF i_ztracene_mesto_kluc_5]
ID=i_key_copper
Name=Klic
TYPE=T_normal

ON=@CREATE
color=0987


////////////////////////////////////////////////////////
////////////////////////////////////////////////////////
////////////////////////////////////////////////////////
////////////////////////////////////////////////////////

//////////////////////////////////////
////// Oblast cerne smrti - OCS //////
//////////////////////////////////////

////////////////////////
// VSTUP - portovatko //
////////////////////////
// NASTAVOVANIE
//
// ovladac - maximum
// ovladac - cas_blok
// ovladac - cas_na_prechod
// ovladac - truhla - UIDcko truhly
// ovladac - destination
// odlavac - databaza - UIDcko truhly s databazou
// ovladac - dvere_heslo - UIDcko dveri na heslo
// ovladac - heslo_cislo - nastavit 1tku
// ovladac - heslo_1 - prve heslo
// ovladac - heslo_2 - druhe heslo
// ovladac - heslo_3 - tretie heslo
// ovladac - heslo_4 - stvrte heslo
// ovladac - heslo_5 - piate heslo
//
// truhla - ovladac - UIDcko ovladaca
//

[ITEMDEF i_ocs_portovatko]
ID=i_bottle_ale
Name=Podivny alkohol
TYPE=T_normal

ON=@CREATE
color=00

on=@UserDClick
if (src.isgm)
	src.go(<tag(ovladac).tag(destination)>) 
	src.sysMessage("Vstupil si do dungu ako gm.")	
else
  if (strcmpi("<region.name>","Tajemna Hospoda")) // ak nieje v hospode - aby to nepouzivali ako instat zachranu
	  src.sysMessage("Vypil jsi alkohol.")	
  else // ak je v hospode
    if (<tag(ovladac).tag(maximum)> > <tag(ovladac).tag(preslo)>)
      if (tag(ovladac).tag(prechadzaju) == 0)
        src.go(<tag(ovladac).tag(destination)>) 
	      tag(ovladac).tag(preslo,<eval(tag(ovladac).tag(preslo)+1)>)
	      tag(ovladac).tag(prechadzaju,1)
	      tag(ovladac).tag(cislo_skupiny,<eval(tag(ovladac).tag(cislo_skupiny)+1)>)
    	  tag(ovladac).timer(<eval(tag(ovladac).tag(cas_na_prechod))>)
    	  tag(ovladac).tag(hrac<tag(ovladac).tag(preslo)>,<src.uid>)
    	  src.allitmove(<tag(ovladac).tag(truhla)>)
    	  src.ocs_databaze_save_player(<tag(ovladac).tag(databaza)>,<tag(ovladac).tag(cislo_skupiny)>)
    	  ocs_set_password
    	  src.tag(ovladac,<tag(ovladac)>)
    	  src.qtag(q038_ocs,1,44)
    	  src.ocs_prepare_for_start
    	  src.tag(q038_ocs_mygroup,<tag(ovladac).tag(cislo_skupiny)>)
    	elseif (tag(ovladac).tag(prechadzaju) == 1)
	      src.go(<tag(ovladac).tag(destination)>) 
        tag(ovladac).tag(preslo,<eval(tag(ovladac).tag(preslo)+1)>)	
        tag(ovladac).tag(hrac<tag(ovladac).tag(preslo)>,<src.uid>)
    	  src.allitmove(<tag(ovladac).tag(truhla)>)
    	  src.ocs_databaze_save_player(<tag(ovladac).tag(databaza)>,<tag(ovladac).tag(cislo_skupiny)>)
    	  src.qtag(q038_ocs,1,44)
    	  src.ocs_prepare_for_start
    	  src.tag(q038_ocs_mygroup,<tag(ovladac).tag(cislo_skupiny)>)
      elseif (tag(ovladac).tag(prechadzaju) == 2)
        src.sysMessage("Vypil si alkohol")	
      endif
    else
	    src.sysMessage("Vypil jsi alkohol")	
	  endif
  endif
endif
remove

[function ocs_prepare_for_start]
src.newitem(i_robe).equip	
src.newitem(i_potion_Nightsight).bounce
src.giveitem(i_fish_cut_cooked,{30})
src.nightsight = 0
src.food = 0


[function ocs_set_password]
if (tag(ovladac).tag(heslo_cislo) == 1) 
	tag(ovladac).tag(heslo_cislo,2)
	tag(ovladac).tag(heslo_sucasne,1)
	tag(ovladac).tag(dvere_heslo).tag(password,<tag(ovladac).tag(heslo_1)>)
elseif (tag(ovladac).tag(heslo_cislo) == 2) 
	tag(ovladac).tag(heslo_cislo,3)
	tag(ovladac).tag(heslo_sucasne,2)
	tag(ovladac).tag(dvere_heslo).tag(password,<tag(ovladac).tag(heslo_2)>)
elseif (tag(ovladac).tag(heslo_cislo) == 3) 
	tag(ovladac).tag(heslo_cislo,4)
	tag(ovladac).tag(heslo_sucasne,3)
	tag(ovladac).tag(dvere_heslo).tag(password,<tag(ovladac).tag(heslo_3)>)
elseif (tag(ovladac).tag(heslo_cislo) == 4) 
	tag(ovladac).tag(heslo_cislo,5)
	tag(ovladac).tag(heslo_sucasne,4)
	tag(ovladac).tag(dvere_heslo).tag(password,<tag(ovladac).tag(heslo_4)>)
elseif (tag(ovladac).tag(heslo_cislo) == 5) 
	tag(ovladac).tag(heslo_cislo,1)
	tag(ovladac).tag(heslo_sucasne,5)
	tag(ovladac).tag(dvere_heslo).tag(password,<tag(ovladac).tag(heslo_5)>)
endif
	
[function ocs_databaze_save_player] /// argv(0) == UIDcko bagliku kam ho hodit || argv(1) == tag skupiny ktory tam chceme ulozit
newitem = i_ocs_player_zaznam
lastnew.name = <name>
lastnew.tag(hrac,<uid>)
lastnew.tag(group,<argv(1)>)
lastnew.cont = <argv(0)>

[ITEMDEF i_ocs_player_zaznam]
ID=i_crystal_red
Name=Zaznam hraca
TYPE=T_normal

ON=@CREATE
attr=090

[defnames movelayerinchest]
layer_move_count 20
layer_move_1 1
layer_move_2 2
layer_move_3 3
layer_move_4 4
layer_move_5 5
layer_move_6 6
layer_move_7 7
layer_move_8 8
layer_move_9 10
layer_move_10 12
layer_move_11 13
layer_move_12 14
layer_move_13 15
layer_move_14 17
layer_move_15 18
layer_move_16 19
layer_move_17 20
layer_move_18 22
layer_move_19 23
layer_move_20 24


[function allitmove] // ARGS uid truhly
if (findid(t_eq_horse))
  dismount
  f_shrink(<lastnewchar>,<uid>)
endif

if (!strlen(<args>))
  return 1
endif

newitem = i_backpack
lastnew.name <name>
lastnew.cont = <args>
arg(backuid,<lastnew>)
arg(layercount,<layer_move_count>)
arg(ovladac,<args.tag(ovladac)>)
finduid(<arg(ovladac)>).tag(bag<finduid(<arg(ovladac)>).tag(preslo)>,<arg(backuid)>)

while(arg(layercount))
  findlayer(<layer_move_<arg(layercount)>>).cont = <arg(backuid)>
  arg(layercount,<eval <arg(layercount)>-1>)
endif
if (<safe finduid(<src.findlayer.21>).rescount>)
  arg(count,<finduid(<src.findlayer.21>).rescount>)
  while (arg(count))
    arg(count,<eval <arg(count)>-1>)
    if(<finduid(<src.findlayer.21>).findcont(<arg(count)>).attr>!=<finduid(<src.findlayer.21>).findcont(<arg(count)>).attr>|attr_move_never)
     finduid(<src.findlayer.21>).findcont(<arg(count)>).cont = <arg(backuid)>
    endif
  endwhile
endif

[function f_ocs_port_check_players]
f_ocs_port_remove_bags
if ((<tag(cesta)> == 1)||(<tag(cesta)> == 2))
	f_ocs_port_remove_players
else
  f_ocs_port_kick_players
endif

[function f_ocs_port_remove_bags]
arg(i,1)
while (i <= tag(preslo))
  if (tag(bag<arg(i)>).topobj.UID == tag(truhla))
  	tag(bag<arg(i)>).remove
  endif
  tag.remove(bag<arg(i)>)
arg(i,#+1)
endwhile
 	
[function f_ocs_port_kick_players]
arg(i,1)
while (i <= tag(preslo))
if (tag(hrac<arg(i)>))
  if !(strcmpi("<tag(hrac<arg(i)>).region.name>","Oblast Cerne Smrti"))
		if !(strcmpi("<tag(player).region.name>","Oblast Cerne Smrti Labyrint"))
			if !(strcmpi("<tag(player).region.name>","Oblast Cerne Smrti Boss"))
				if !(strcmpi("<tag(player).region.name>","Oblast Cerne Smrti Jeskyne"))
				  if !(strcmpi("<tag(player).region.name>","Oblast Cerne Smrti (Small Stone and Plaster House)"))
				    if !(strcmpi("<tag(player).region.name>","Oblast Cerne Smrti (Small Wood House)"))
				    	if !(strcmpi("<tag(player).region.name>","Stredozeme"))
    						tag(hrac<arg(i)>).gohome
    						tag(hrac<arg(i)>).sysMessage("Neuspel si")
    					endif
    				endif
    			endif
    		endif
    	endif
    endif
  endif
endif
arg(i,#+1)
endwhile
f_ocs_port_remove_players

[function f_ocs_port_remove_players]
   tag.remove(hrac1)
   tag.remove(hrac2)
   tag.remove(hrac3)
   tag.remove(hrac4)
   tag.remove(hrac5)
   tag.remove(hrac6)
   tag.remove(hrac7)
   tag.remove(hrac8)
   tag(preslo,0)
   

[ITEMDEF i_ocs_portovatko_ovladac]
ID=0EDC
Name=Ovladac portu
TYPE=T_normal

ON=@CREATE
attr=090
color=0986
tag(heslo_cislo,1)

on=@timer
if (tag(prechadzaju) == 1)
	tag(prechadzaju,2)
	timer=<eval(tag(cas_blok))>
elseif (tag(prechadzaju) == 2)
  tag(prechadzaju,0)
  f_ocs_port_check_players
endif
return 1


//////////////
// Guards
/

[EVENTS e_guard_ocs]    
on=@hittry
greykarma
events(+e_tele_to_target)
return 0

ON=@aftergetswing
events(+e_tele_to_target)
attack(<src>)
if (src.isconjured)
 src.hits=0
 return 1
endif
return 0

ON=@NPCSeeNewPlayer
greykarma
if (src.flag_invul)
 return 1
endif
if (<src.tag(hypno_mystik)>)
 if (<src.karma> > -10000)
  return 1
 endif
endif
var(ban_out,0)

if (!(ocs_myguard))
 if(<var(ban_out)>) //banned ale stoji mimo
  var(ban_out,"")
  say(Zmizni odsud!)
 endif
 dorand 2
  say("<src.name>, odejdi nebo zemri!")
  say("<src.name>, nemas tu co pohledavat!")
 enddo  
 attack(<src>)
 events(+e_tele_to_target)   
endif
var(ban_out,"")
//return 0

on=@skillstroke //provadeni akce - simulujeme navrat domu pri spatreni hrace, guardi maj tendenci se courat
if(isfighting)||(iscasting)
 if(act.ischar)
  if(act.npc) //bojuje s npcckem
   //je to npc spawnute ve meste - zrejme se mydlej guardi navzajem
   if(strlen(<act.memoryfindtype(MEMORY_ISPAWNED).link.region.tag(jmeno_mesta)>))
    while(memoryfindtype(MEMORY_FIGHT))
     memoryfindtype(MEMORY_FIGHT).remove
    endwhile
    removememories
    go(<home>)
   endif
  endif
 endif
endif
if(action==06d)&&(distancefrom(<memoryfindtype(MEMORY_ISPAWNED).link>) > 10) //going home
 go(<home>)  
endif

on=@beforegetswing
on=@beforegeteffect
on=@beforedoeffect
on=@Created
on=@DrinkingPotion
on=@afterswing

[function ocs_myguard]
if (npc)
 if (typedef.tag(guard))
  if (src.isplayer)
   if (typedef.tag.guard==1)
    if (src.tag(ocs_pomaha)>0) 
     if (src.tag(ocs_pomaha)==1)
        return 1
     endif
    endif
   elseif (typedef.tag.guard==2)
    if (src.tag(ocs_pomaha)>0)
     if (src.tag(ocs_pomaha)==2)
      return 1
     endif
    endif
   endif
  endif
 endif
endif
return 0

////////////////
// STOJANY NA BRNKA
////////////////


[ITEMDEF i_ocs_stojan_plate]
ID=03057
NAME=Stojan s brnenim
TYPE=t_normal

on=@create
attr=attr_move_never
color=00

on=@userdclick
if (<src.qtag(q038_ocs)> == 1)
	if ((src.profession==class_craft)||(src.profession==class_war))
    src.qtag(q038_ocs,2,44)
    src.newitem(i_copper_heater_shield).equip
    src.newitem(i_sword_long_copper).equip
    src.sysMessage("Sebral jsi stare brneni.")
  elseif (src.profession==class_priest)
    src.qtag(q038_ocs,2,44)
    src.newitem(i_copper_heater_shield).equip
    src.sysMessage("Sebral jsi stare brneni.")
  endif
else 
  src.sysMessage("Zde neni nic pro tebe...")
endif
return 1

[ITEMDEF i_ocs_stojan_chain]
ID=0388F
NAME=Stojan s brnenim
TYPE=t_normal

on=@create
attr=attr_move_never
color=00

on=@userdclick
if (<src.qtag(q038_ocs)> == 1)
	if (src.profession==class_thief)
    src.qtag(q038_ocs,2,44)
    src.newitem(i_copper_metal_shield).equip
    src.newitem(i_kryss_copper).equip
    src.sysMessage("Sebral jsi stare brneni.")
  endif
else 
  src.sysMessage("Zde neni nic pro tebe...")
endif
return 1

[ITEMDEF i_ocs_stojan_ranger]
ID=0390A
NAME=Stojan se zbranemi
TYPE=t_normal

on=@create
attr=attr_move_never
color=00

on=@userdclick
if (<src.qtag(q038_ocs)> == 1)
	if (src.profession==class_ranger)
    src.qtag(q038_ocs,2,44)
    src.newitem(i_crossbow_heavy_copper).equip
    src.giveitem(i_xbolt_piercing_copper,{100})
    src.sysMessage("Sebral jsi starou kusi a sipy.")
  endif
else 
  src.sysMessage("Zde neni nic pro tebe...")
endif
return 1

[ITEMDEF i_ocs_stojan_gn]
ID=0285E
NAME=Skrina
TYPE=t_normal

on=@create
attr=attr_move_never
color=00

on=@userdclick
if (<src.qtag(q038_ocs)> == 1)
	if (src.profession==class_mag)
    src.qtag(q038_ocs,2,44)
    src.newitem(i_staff_gnarled_copper).equip
    src.newitem(i_spellbook).bounce
    lastnew.addspell=s_fireball
    lastnew.addspell=s_flamestrike
    lastnew.addspell=s_harm
    lastnew.addspell=s_energy_bolt
    lastnew.addspell=s_mind_blast
    lastnew.addspell=s_night_sight
    lastnew.addspell=s_magic_reflection
    src.sysMessage("Zobral si staru hul a knihu.")
  elseif (src.profession==class_necro)
    src.qtag(q038_ocs,2,44)
    src.newitem(i_staff_gnarled_copper).equip
    src.newitem(i_spellbook).bounce
    lastnew.addspell=s_flamestrike
    lastnew.addspell=s_harm
    lastnew.addspell=s_night_sight    
    lastnew.addspell=s_fire_bolt
    lastnew.addspell=s_magic_reflection
    src.newitem(i_customscroll_frostbolt).bounce
    src.sysMessage("Sebral si starou hul a knihu.") 
  elseif (src.profession==class_mystik)
    src.qtag(q038_ocs,2,44)
    src.newitem(i_staff_gnarled_copper).equip
    src.newitem(i_spellbook).bounce
    lastnew.addspell=s_magic_arrow
    lastnew.addspell=s_bless
    lastnew.addspell=s_greater_heal
    lastnew.addspell=s_magic_reflection
    src.sysMessage("Sebral jsi starou hul a knihu.")
  elseif (src.profession==class_shaman)
    src.qtag(q038_ocs,2,44)
    src.newitem(i_staff_gnarled_copper).equip
    src.newitem(i_spellbook).bounce
    lastnew.addspell=s_magic_arrow
    lastnew.addspell=s_harm
    lastnew.addspell=s_energy_bolt
    lastnew.addspell=s_mind_blast
    src.newitem(i_customscroll_frostbolt).bounce
    src.sysMessage("Sebral jsi starou hul a knihu.")
  endif
else 
  src.sysMessage("Zde neni nic pro tebe...")
endif
return 1


////////////////
// dvere otvarajuce sa na qtag
////////////////
// 
// NASTAVOVANIE
//
// zatvaratko - qtag_nazov
// zatvaratko - qtag_hodnota_X
// zatvaratko - cas_otvorenia
// zatvaratko - dvere - UIDcko dveri
// zatvaratko - qtag_pocet - pocet qtagov
//
// dvere - zatvaratko - UIDcko zatvaratka
// dvere - dispID - dispID zatvorenych dveri
//

[itemdef i_ocs_dvere_qtag]
ID=i_door_metal
Type=t_door_locked
Name=Dvere

ON=@Create
attr=010


on=@UserDClick
arg(i,1)
while (i <= tag(zatvaratko).tag(qtag_pocet))
if (<eval src.qtag(<tag(zatvaratko).tag(qtag_nazov)>)> == <tag(zatvaratko).tag(qtag_hodnota_<arg(i)>)>)
	type=t_door
  tag(zatvaratko).tag(otvorene,1)
  tag(zatvaratko).timer=<tag(zatvaratko).tag(cas_otvorenia)>
endif
arg(i,#+1)
endwhile
if (tag(zatvaratko).tag(otvorene) == 0)
  src.sysMessage("Dvere jsou pevne zavrene.")
endif
return 0

on=@Timer
  if !(<dispid> == <tag(dispID)>)
    dclick
  endif	
  return 1
  
[itemdef i_ocs_dvere_qtag_zatvaratko]
ID=02C51
Type=t_script
Name=Zatvaratko

ON=@Create
attr=090
color=0986

on=@timer
if (0<tag(otvorene) == 1>)
tag(dvere).type=t_door_locked
endif
tag(otvorene,0)
return 1

///////////////////
  
[itemdef i_ocs_nuzky]
ID=i_scissors
Type=t_normal
Name=Nuzky

ON=@Create
attr=010

on=@timer
tag(zobrane,0)
return 1

on=@UserDClick
if (tag(zobrane) == 0)
  src.sysMessage("Nasel jsi nuzky.")
  src.newitem(i_scissors).bounce
  tag(zobrane,1)
  timer=3600
else
	src.sysMessage("Tyto se nedaji pouzivat.")
endif
return 0

////////////////
// mass qtag set
////////////////

[function ocs_qtag_set] /// argv(0) == UIDcko ovladaca || argv(1) == qtag ktory chceme nastavit || argv(2) == cislo skupiny
finduid(argv(0).tag(databaza)).contents(f_ocs_qtag_set(<argv(1)>,<argv(2)>))

[function f_ocs_qtag_set] // argv(0) == qtag ktory chceme nastavit, argv(1) == cislo skupiny ktorej to chceme nastavit
arg(zaznam,<UID>)
if(ocs_ismygroup(<argv(1)>,<arg(zaznam).tag(group)>))
	finduid(arg(zaznam).tag(hrac)).qtag(q038_ocs,<argv(0)>,44)
  if (finduid(arg(zaznam).tag(hrac)).tag(ocs_pomaha) == 0) && (<argv(0)> == 3)
    finduid(arg(zaznam).tag(hrac)).tag(ocs_pomaha,1)
    finduid(arg(zaznam).tag(hrac)).sysMessage("Zvolili ste si, ze budete pomahat Salmatom.")
  elseif (finduid(arg(zaznam).tag(hrac)).tag(ocs_pomaha) == 0) && (<argv(0)> == 17)
    finduid(arg(zaznam).tag(hrac)).tag(ocs_pomaha,2)
    finduid(arg(zaznam).tag(hrac)).sysMessage("Zvolili jste si, ze budete pomahat Sermatom.")
  endif
  finduid(arg(zaznam).tag(hrac)).sysMessage("Nekdo z vasi skupiny jiz rozhodl za tebe!")
else 
  finduid(arg(zaznam).tag(hrac)).sysMessage("NEFACHA")
endif

[function ocs_ismygroup] // args == cislo skupiny ktoru potrebujeme
if (<argv(0)> == <argv(1)>)
 return 1
else
 return 0
endif

///////////// 
/// going home dlazky
/////////////
// 
// npc - tag walker 1 - chodi po dlazkach
// dlazka - next_home - pozicia dalsej home dlazky
// last_changer 1 - posledny changer, nema dalsi home poziciu
//

[ITEMDEF i_home_changer]
ID=0AEC
NAME=Home changer - NEMAZAT

CATEGORY=Noe
SUBSECTION=misc
DESCRIPTION=home changer dlazdica

ON=@Create
attr=090
COLOR=0481

on=@step
if !(src.isplayer)
	if (0<src.tag(walker) == 1>)
		if (0<tag(last_changer) == 1>)
			src.action 067			
		else
			if (ocs_player_is_close)
	      src.home <tag(next_home)>
	      src.action 06D
	    	if (src.tag(have_told) == 1)
	    		src.tag(have_told,0)
	      endif
	    else
	    	src.action 065
	    	if !(src.tag(have_told) == 1)
	    		src.tag(have_told,1)
	    	  src.say("Tak pojd, honem!")
	    	endif 	
	    endif
	  endif
	endif
endif

[function ocs_player_is_close]
arg(i,1)
while (i <= (src.tag(number_of_players)))
  if (src.distancefrom(<src.tag(hrac_<i>)>) < 10)
	  if !(<src.tag(hrac_<i>).flags>&statf_invisible)
		  if !(<src.tag(hrac_<i>).flags>&statf_hidden)
        return 1
      endif
    endif
  endif
  arg(i,#+1)
endwhile

///////
// event pre attack npcka ktore chodi
///////
//
// tag number_of_players - pocet hracov ktori ho strazia
// tag hrac_<cislo> - UIDcko hraca cisloX
//
// hrac - ocs_guard_npc - UIDcko NPCka ktore guardi
// hrac - ocs_guardi - pocet NPCcek ktore guardi
//////////////
// Guards
//


[EVENTS e_ocs_guard_npc]    
on=@hittry
greykarma
return 0

ON=@aftergetswing
attack(<src.tag(ocs_guard_npc)>)
if (src.tag(ocs_guard_npc).isconjured)
 src.tag(ocs_guard_npc).hits=0
 return 1
endif
return 0

ON=@NPCSeeNewPlayer
newitemsafe(i_memory_cleaner)
greykarma
if (src.tag(ocs_guard_npc).flag_invul)
 return 1
endif
if (<src.tag(ocs_guard_npc).tag(hypno_mystik)>)
 if (<src.karma> > -10000)
  return 1
 endif
endif

if (ocs_guard_npc)
 dorand 2
  say("<src.tag(ocs_guard_npc).name> je zradce! Zabte ho!")
  say("<src.tag(ocs_guard_npc).name> nas zradil! Chrante naseho pana!")
 enddo  
 attack(<src.tag(ocs_guard_npc)>)
endif
//return 0

on=@skillstroke //provadeni akce - simulujeme navrat domu pri spatreni hrace, guardi maj tendenci se courat
if(action==06d)&&(distancefrom(<memoryfindtype(MEMORY_ISPAWNED).link>) > 10) //going home
 go(<home>)  
endif

on=@beforegetswing
on=@beforegeteffect
on=@beforedoeffect
on=@Created
on=@DrinkingPotion
on=@afterswing

[function ocs_guard_npc]
  if (src.isplayer)
    if (src.tag(ocs_guardi)>0) 
     if (src.tag(ocs_guardi)==1)
        return 1
     endif
    endif
   endif 
return 0

[CHARDEF c_ocs_guard_npc_killer]
ID=C_man
NAME=Killer
ICON=i_man
attack=55
ARMOR=20
CAN=MT_EQUIP|MT_WALK|MT_RUN|MT_USEHANDS

TEVENTS=e_ocs_guard_npc
TEVENTS=e_character

CATEGORY=Dungeons
SUBSECTION=OCS
DESCRIPTION=Guard npc killer

ON=@Create
NAME=#NAMES_HUMANMALE
Title=Mestan

tag(resist_para,{800 850})
tag(resist_poison,1000)

karma=1000
brain=6//vendor - teleportuje se domu
//ALIGNMENT=GOOD
COLOR=colors_skin

STR=1000
DEX=500
INT=222

MAXHITS=1000
MAXSTAM=600
MAXMANA=2000

DETECTINGHIDDEN={90.0 100.0}
FORENSICS={90.0 100.0}
FENCING={100.0 110.0}
PARRYING={100.0 110.0}
SWORDSMANSHIP={100.0 110.0}
WRESTLING={100.0 110.0}
MACEFIGHTING={100.0 110.0}
TACTICS={90.0 100.0}
SpiritSpeak=80.00
peacemaking=100.0
provocation=100.0

tag(noanimate,1)
tag(hypnotizable,0)
tag.hypnotizable=<tag.hypnotizable>|<flag_Buff[4]>//dmg
tag.hypnotizable=<tag.hypnotizable>|<flag_BuffPower[7]>

ON=@NPCRestock

ON=@NPCRefuseItem
	SAY("Mne nemuzes podplatit. Odejdi!")
	return 1
	
//////////////////
/// eventy pre kapitana a obludu - nastavovanie qtagu massovo
//////////////////

[events e_ocs_freak]
on=@death
arg(players,<memoryfindtype(Memory_ISpawned).link.tag(players)>)
arg(i,1)
while (i <= arg(players))
  if (<eval memoryfindtype(Memory_ISpawned).link.tag(player_<i>).qtag(q038_ocs)> == 11)
    memoryfindtype(Memory_ISpawned).link.tag(player_<i>).qtag(q038_ocs,12)
    memoryfindtype(Memory_ISpawned).link.tag(player_<i>).sysMessage("Obluda konecne naposledy vydechla. Snad je konecne zdroj morove nakazy definitivne vymycen.")
    memoryfindtype(Memory_ISpawned).link.tag.remove(player_<i>)
  elseif (<eval memoryfindtype(Memory_ISpawned).link.tag(player_<i>).qtag(q038_ocs)> == 25)
    memoryfindtype(Memory_ISpawned).link.tag(player_<i>).qtag(q038_ocs,26)
    memoryfindtype(Memory_ISpawned).link.tag(player_<i>).sysMessage("Obluda konecne naposledy vydechla. Snad je konecne zdroj morove nakazy definitivne vymycen.")
    memoryfindtype(Memory_ISpawned).link.tag.remove(player_<i>)
  endif
arg(i,#+1)
endwhile
memoryfindtype(Memory_ISpawned).link.tag.remove(players)


[events e_ocs_capitan]
on=@death
arg(players,<memoryfindtype(Memory_ISpawned).link.tag(players)>)
arg(i,1)
while (i <= arg(players))
  if (<eval memoryfindtype(Memory_ISpawned).link.tag(player_<i>).qtag(q038_ocs)> == 13)
    memoryfindtype(Memory_ISpawned).link.tag(player_<i>).qtag(q038_ocs,14)
    memoryfindtype(Memory_ISpawned).link.tag(player_<i>).sysMessage("Kapitan straze byl mozna ochlasta, ale s mecem se ohanet umel. Nez potkal vas.")
    memoryfindtype(Memory_ISpawned).link.tag.remove(player_<i>)
  endif
arg(i,#+1)
endwhile
memoryfindtype(Memory_ISpawned).link.tag.remove(players)

//////////
/// eventy pre final bossa
//////////


[events e_ocs_boss_resser]
on=@aftergetswing
IF (RAND(10)==1)
	tag(databaza).contents(f_ocs_create_monsters(<tag(databaza)>))
	SAYU("Pomocnici moji, povstante!")
return 0
endif
on=@beforegetswing
on=@Created
on=@DrinkingPotion
on=@afterswing
on=@beforedoeffect
on=@beforegeteffect

[function f_ocs_create_monsters]
if (tag(pomocnik) == 1)
src.newnpc(C_ocs_boss_helper_1)
else 
src.newnpc(C_ocs_boss_helper_2)
endif
lastnewchar.p=<tag(corpse_position)>
lastnewchar.tag(experience,0)
lastnewchar.tag(databaza,<args>)
lastnewchar.newequip(i_mazatko_paladina)
lastnewchar.home=<tag(corpse_position)>
lastnewchar.homedist=3

tag(mazatko).timer=0


[events e_ocs_boss_resurrection_able]
on=@DeathCorpse
newitem = i_ocs_monster_zaznam
lastnew.name = <src.name>
lastnew.tag(corpse_uid,<argo.uid>)
lastnew.tag(corpse_position,<argo.p>)
lastnew.tag(pomocnik,<src.tag(pomocnik)>)
lastnew.cont = <src.tag(databaza)>

arg(databaza_zaznam,<lastnew.uid>)

newitemsafe(i_ocs_monster_remover)
lastnew.tag(databaza_zaznam,<arg(databaza_zaznam)>)
lastnew.timer = 200
lastnew.tag(corpse_uid,<argo.uid>)
lastnew.tag(pomocnik,<src.tag(pomocnik)>)
lastnew.p=<argo.p>

arg(mazatko,<lastnew.uid>)
arg(databaza_zaznam).tag(mazatko,<arg(mazatko)>)


[ITEMDEF i_ocs_monster_remover]
ID=i_worldgem_bit
Name=mazatko
TYPE=T_normal

ON=@CREATE
attr=090

on=@timer
finduid(<tag(databaza_zaznam)>).remove
tag(corpse_uid).remove
remove
return 0

[ITEMDEF i_ocs_monster_zaznam]
ID=i_crystal_red
Name=Zaznam obludy pre bossa
TYPE=T_normal

ON=@CREATE
attr=090

/////////////////
////// gata na qtag
//
// nastavenie 
// 
// qtag_hodnota_1 - 1. hodnota qtagu
// qtag_hodnota_2 - 2. hodnota qtagu
// qtag_nazov - nazov qtagu
//

[ITEMDEF i_ocs_qtag_gate]
ID=i_moongate_blue
Name=Portal
TYPE=T_normal

ON=@CREATE
attr=010

on=@step
if (src.isgm)
	src.go <morep>
elseif ((<eval src.qtag(<tag(qtag_nazov)>)> == <tag(qtag_hodnota_1)>) || (<eval src.qtag(<tag(qtag_nazov)>)> == <tag(qtag_hodnota_2)>))
			src.go <morep>
else 
			src.sysMessage("Tato cesta neni pro tebe.")
endif


on=@timer
return 0
  
/////////////////
/// dlazka pustajuca hraca s qtagom
// 
// nastavenie
// 
// qtag_hodnota_1 - 1. potrebna hodnota qtagu
// qtag_hodnota_2 - 2. potrebna hodnota qtagu 
// qtag_nazov - nazov potrebneho qtagu
//

[ITEMDEF i_ocs_qtag_dlazka]
ID=0AEC
NAME=pusti qtag

ON=@Create
attr=090
COLOR=0481

ON=@step
if (<src.isGM>)
  return 1
endif
if (<src.flags>&statf_dead)
  src.move(<dir_inttochar(<dir_revert(<src.dir>)>)>)
  return 1
endif
if ((<eval src.qtag(<tag(qtag_nazov)>)> == <tag(qtag_hodnota_1)>) || (<eval src.qtag(<tag(qtag_nazov)>)> == <tag(qtag_hodnota_2)>))
else
  src.move(<dir_inttochar(<dir_revert(<src.dir>)>)>)
endif

//////////////////
//// niejake tie ability pre npc
//////////////////
//
//
//
//tag(e_explosionlava_chance,300) //30% chance
//tag(e_explosionlava_range,6)
//tag(e_explosionlava_time,20)
//
//

[events e_explosionlava]
on=@gethit
f_explosionlava_setVars
if (chance(<tag(e_explosionlava_chance)>,3))
  arg(server_time,<fixnumber((<serv.time>/10))>)  //server time v sekundach
  arg(rozdiel,<fixnumber(<server_time>-<tag(e_explosionlava_last_time)>)>)
  if (arg(rozdiel)>tag(e_explosionlava_time))
    tag(e_explosionlava_last_time,<fixnumber((<serv.time>/10))>)
    emote("throws lava bomb")
    arg(start_x,<eval(-tag(e_explosionlava_range)+<rand(2*tag(e_explosionlava_range)+1)>)>)
    arg(start_y,<eval(-tag(e_explosionlava_range)+<rand(2*tag(e_explosionlava_range)+1)>)>)
    newitem=i_potion_lava
    lastnew.p=<p_x>+start_x,<p_y>+start_y,<p_z>,<mapplane>
    lastnew.attr=attr_static|attr_decay|attr_move_never 
    lastnew.trigger(userdclick)
    lastnew.timer=2
  endif
endif

on=@beforeGetSwing
on=@aftergetswing
on=@Created
on=@DrinkingPotion
on=@afterswing
on=@beforedoeffect
on=@beforegeteffect

[function f_explosionlava_setVars]
if (strlen(<tag(explosionlava_varsChecked)>) == 0)
  if (strlen(<tag(e_explosionlava_chance)> == 0)
    tag(e_explosionlava_chance,50) //default 5.0%
  endif
  if (strlen(<tag(e_explosionlava_range)>) == 0)
    tag(e_explosionlava_range,5)
  endif
  if (strlen(<tag(e_explosionlava_last_time)>) == 0)  //kedy hodil bombu
    tag(e_explosionlava_last_time,<fixnumber((<serv.time>/10))>)  // v sekundach
  endif
  if (strlen(<tag(e_explosionlava_time)>) == 0)  //cas za ktory hodi dalsiu
    tag(e_explosionlava_time,30)  // v sekundach
  endif
  tag(explosionlava_varsChecked,1)
endif


[events e_bomba_boy]
on=@gethit
on=@beforeGetSwing
on=@aftergetswing
on=@Created
on=@DrinkingPotion
on=@afterswing
if(tag(vybuch) != 1)
  say("Umrete!")
  newitem(i_bomba_boy)
  lastnewitem.p=<p>
  lastnewitem.timer=1
  lastnewitem.tag(bomba_boy_dmg,<tag.bomba_boy_dmg>)
  //sector.allchars(bomba_boy(<uid>,<tag.bomba_boy_dmg>))
  effect(3,<s_explosion.EFFECTID>,6,15,1)
  sound=<s_explosion.sound>	
  newequip(i_mazatko_paladina)
  lastnewitem.timer=1
  tag(vybuch,1)
endif
  
  	
on=@beforedoeffect
on=@beforegeteffect

[ITEMDEF i_bomba_boy]
ID=i_worldgem_bit
Name=bomber
TYPE=T_normal

ON=@CREATE
attr=090

ON=@timer
if (tag(vybuch) == 1)
	remove
else
sector.allchars(bomba_boy(<uid>,<tag.bomba_boy_dmg>))
tag(vybuch,1)
timer=1
endif

remove



[function bomba_boy]
arg(distance,distancefrom(<argv(0)>))
if (isplayer)
	if (!(isgm))
  	if (<eval arg(distance)> < 5)
    	if (<eval arg(distance)> > 1)
    	  damage_noResponse(<(<argv(1)> - (<eval arg(distance)> * 5))>,dam_fire|dam_magic)
   	    //damage_noResponse(500,dam_fire|dam_magic)
      else
  	    damage_noResponse(<argv(1)>,dam_fire|dam_magic)
   	    //damage_noResponse(1000,dam_fire|dam_magic)
      endif
      effect(3,<s_explosion.EFFECTID>,6,15,1)
      sound=<s_explosion.sound>
    endif
  endif
endif 

///////////////
//// podmienkova funkcia na qtag pre vargatu
///////////////
//
// nastavenia tagov na vargatu:
// qtag_nazov - nazov qtagu
// qtag_needed - potrebny qtag
// qtag_wanted - nastavovany qtag
//

[function f_ocs_vg_qtag]
if (<eval src.qtag(<(<args>).tag(qtag_nazov)>)> == (<args>).tag(qtag_needed))
	src.qtag(<(<args>).tag(qtag_nazov)>,<(<args>).tag(qtag_wanted)>)
	return 0 // succeed -> player can go through
else
	return 1 
endif

///////////////
//
// qtag_nazov - nazov qtagu
// qtag_needed - potrebny qtag
// qtag_wanted - nastavovany qtag
// more2 - pocet expov ktory chceme pridat
//

[ITEMDEF i_ocs_qtag_expgate]
ID=i_moongate_blue
Name=Portal
TYPE=T_normal

ON=@CREATE
attr=010

on=@step
if (src.isgm)
	src.go <morep>
elseif (<eval src.qtag(<tag(qtag_nazov)>)> == <tag(qtag_needed)>)
    if (<src.tag(hypno_mystik)>)
      src.sysMessage("Tuto gatu nemuzes pouzivat.")
      return 1
    endif
    if (tag(hrac[<src>])>serv.time)
      src.sysMessage("Jeste nemuzes dostat zkusenosti.")
    else
      tag(hrac[<src>],<eval serv.time+60*10>)
      src.addexp(<more2>)
    endif
    src.qtag(<tag(qtag_nazov)>,<tag(qtag_wanted)>)
    src.go <morep>
else 
			src.sysMessage("Tato cesta neni pro tebe.")
endif


on=@timer
return 0

/////////////////////
//// EXIT FUNCKIA
/////////////////////
//
// maze:
// item z databazy
// tagy z hraca:
// tag(ocs_guard_npc)
// tag(ocs_guardi)
// tag(ocs_pomaha)
// tag(q038_ocs_mygroup)
//
// qtagy z hraca
//

[function f_ocs_exit]
src.newequip(i_ocs_exiter)
lastnew.tag(ovladac,<src.tag(ovladac)>)
lastnew.tag(player,<src.uid>)
lastnew.timer=2
  
[ITEMDEF i_ocs_exiter]
ID=i_worldgem_bit
Name=exiter
TYPE=t_eq_script

ON=@CREATE
attr=090

on=@timer
f_ocs_exit_equip
remove


[function f_ocs_exit_equip]

//if (tag(player).region.tag(ocs) != 1)
//	tag(ovladac).tag(databaza).contents(f_ocs_remove_record(<tag(player)>))
//  
//	tag(player).tag.remove(ocs_guard_npc)
//	tag(player).tag.remove(ocs_guardi)
//	tag(player).tag.remove(q038_ocs_mygroup)
//	tag(player).tag.remove(ocs_pomaha)
//	tag(player).tag.remove(ovladac)
//	
//	tag(player).qtagremove(q038_ocs)
//	tag(player).sysMessage("Opustil jsi Oblast Cerne Smrti.")
//endif


if (strcmpi("<tag(player).region.name>","Oblast Cerne Smrti"))
	if (strcmpi("<tag(player).region.name>","Oblast Cerne Smrti Labyrint"))
		if (strcmpi("<tag(player).region.name>","Oblast Cerne Smrti Boss"))
			if (strcmpi("<tag(player).region.name>","Oblast Cerne Smrti Jeskyne"))
			  if (strcmpi("<tag(player).region.name>","Oblast Cerne Smrti (Small Stone and Plaster House)"))
			    if (strcmpi("<tag(player).region.name>","Oblast Cerne Smrti (Small Wood House)"))
			    	if (strcmpi("<tag(player).region.name>","Stredozeme"))
  						tag(ovladac).tag(databaza).contents(f_ocs_remove_record(<tag(player)>))
 
							tag(player).tag.remove(ocs_guard_npc)
							tag(player).tag.remove(ocs_guardi)
							tag(player).tag.remove(q038_ocs_mygroup)
							tag(player).tag.remove(ocs_pomaha)
							tag(player).tag.remove(ovladac)
	
							tag(player).qtagremove(q038_ocs)
							tag(player).sysMessage("Opustil jsi Oblast Cerne Smrti.")
						endif
					endif
				endif
			endif
		endif
	endif
endif

//if (!(<strcmp("<tag(player).region.name>","Oblast Cerne Smrti")> > 15))
//  tag(ovladac).tag(databaza).contents(f_ocs_remove_record(<tag(player)>))
//  
//	tag(player).tag.remove(ocs_guard_npc)
//	tag(player).tag.remove(ocs_guardi)
//	tag(player).tag.remove(q038_ocs_mygroup)
//	tag(player).tag.remove(ocs_pomaha)
//	tag(player).tag.remove(ovladac)
//
//  tag(player).qtagremove(q038_ocs)
//	tag(player).sysMessage("Opustil jsi Oblast Cerne Smrti.")
//endif

[function f_ocs_remove_record]
 if (<tag(hrac)> == <args>)
 	remove
 endif
 
[function f_ocs_save_players_on_npc] //<argv(0)> - UID npcka, <argv(1)> - cislo skupiny, <argv(2)> - hodnota qtagu, ktoru maju mat
if (<tag(group)> == <argv(1)>)
	if (<tag(hrac).qtag(q038_ocs)> == <argv(2)>)
		argv(0).tag(hrac_<argv(0).tag(number_of_players)>,<tag(hrac)>)
		argv(0).tag(number_of_players,<tag(number_of_players)>+1)
	endif
endif
		
/////////////////////////
////////// event pre mestanov
///////


[EVENTS e_ocs_citizen]    
on=@hittry
ON=@aftergetswing
ON=@NPCSeeNewPlayer
  say("Ne! Tady nemuzete byt! Vsichni zemreme!")

on=@skillstroke 
on=@beforegetswing
on=@beforegeteffect
on=@beforedoeffect
on=@Created
on=@DrinkingPotion
on=@afterswing


[EVENTS e_ocs_town_guard]    
on=@hittry
ON=@aftergetswing
ON=@NPCSeeNewPlayer
  say("Tady uvnitr mesta mohou zit jen zdravi! Zhynte!")

on=@skillstroke 
on=@beforegetswing
on=@beforegeteffect
on=@beforedoeffect
on=@Created
on=@DrinkingPotion
on=@afterswing

/////////////////////////
//// remover of tags on water controller
////////////////////////


[function f_water_tag_remover]
tag.remove(sud_1_hrac_[<args>])
tag.remove(sud_2_hrac_[<args>])
tag.remove(sud_3_hrac_[<args>])
tag.remove(sud_4_hrac_[<args>])
tag.remove(sud_5_hrac_[<args>])
tag.remove(sud_6_hrac_[<args)>])

///////////////////////////
// RUNE FOR RESIST RESTORE
///////////////////////////

[Function f_rune_reset_mask_set]
	tag(second_name,<argv(0)>)
	tag(second_realm,<argv(3)>)
	
	
[itemdef i_rune_resist]
id=i_rune_marker
name=Resist rune
type=t_normal

on=@create
color=098C
attr=attr_move_never|attr_newbie
tag(activated,0)

on=@userDClick
 if (<src.flags>&statf_dead)
   return 0
 endif
 if (src.ismagic)
   src.redMessage("Nesmis byt pod zadnym magickym vlivem...")
   return 0
 endif
if (tag(lastUsage) > serv.time)
 src.redMessage("Jeste nemuzes pouzit.")
 return 0
else
 if (tag(activated) == 0)
 	 if (src.profession==class_thief)  
 	 	 if (src.isnazgul) 	
 	 	 	 if (strlen("<src.tag(maskattribs)>"))
 	 		   tag(first_name,<src.tag(playersname>)
 	 	 	   tag(first_realm,<src.tag(realm)>)
 	 	 	   f_rune_reset_mask_set(<src.tag(maskattribs)>)
 	 	   else
 	 	 	   tag(name,<src.tag(playersname)>)
 	 	 	   tag(realm,<src.tag(realm)>)
 	 	   endif 	 	 
 	 	 elseif (strlen("<src.tag(maskattribs)>"))
 	 		 tag(first_name,<src.name>)
 	 	 	 tag(first_realm,<src.tag(realm)>)
 	 	 	 f_rune_reset_mask_set(<src.tag(maskattribs)>)
 	 	 else
 	 	 	 tag(name,<src.name>)
 	 	 	 tag(realm,<src.tag(realm)>)
 	 	 endif
 	 else
 	 	 tag(realm,<src.tag(realm)>)
 	 	 if (src.isnazgul)
 	 	   tag(name,<src.tag(playersname)>)
 	 	 else
 	 	   tag(name,<src.name>)
 	 	 endif
 	 endif
 	 tag(resist,<src.Resist>)
 	 tag(activated,1)
 	 logmsg("Postava <src.uid> (meno: <src.name>, acc: <src.account.name>) si nastavuje runu na reset resistu na hodnotu <src.resist>.")
 	 src.classmessage("Nastavila se runa pro pocitani resistu.")
 else
 	 if (src.profession==class_thief)
 	 	 if (src.isnazgul)
 	 	 	 if (strlen("<src.tag(maskattribs)>"))
 	 	 	   //if (((src.tag(playersname)) == (tag(first_name))||((src.tag(playersname)) == (tag(second_name))))
 	 	 	   //	 if (((src.tag(realm)) == (tag(first_realm)))||((src.tag(realm)) == (tag(second_realm))))
 	 	 	   //if ((src.tag(playersname)) == (tag(first_name)))
			   if (!(strcmpi("<tag(first_name)>","<src.tag(playersname)>")))
 	 	 	   	 if ((src.tag(realm)) == (tag(first_realm)))
 	 	 	   	 	 if (!((src.Resist) == <tag(resist)>))
 	   	 	       logmsg("postava <src.uid> (meno: <src.name>, acc: <src.account.name>) pouziva runu na vraceni resistu z hodnoty <src.resist> a nastavuje na <tag.resist>.")
 	 	 	   	 	   src.Resist=<tag(resist)>
 	 	 	   	 	   src.classmessage("Byl ti znovu nastaven resist.")
               tag(lastUsage,<eval serv.time+10>)
 	 	 	   	 	   return 1
 	 	 	   	 	 else
 	 	 	   	 	   src.classmessage("Resist ma puvodni hodnotu.")
 	 	 	   	 	   return 0
 	 	 	   	 	 endif
 	 	 	   	 else
 	 	 	   	 	 src.sysMessage("Nesouhlasi tvuj realm.")
 	 	 	   	 	 return 0
 	 	 	   	 endif
 	 	 	   //elseif ((src.tag(playersname)) == (tag(second_name)))
 	 	 	   elseif (!(strcmpi("<tag(second_name)>","<src.tag(playersname)>")))
 	 	 	   	 if ((src.tag(realm)) == (tag(second_realm)))
 	 	 	   	 	 if (!((src.Resist) == <tag(resist)>))
 	   	 	       logmsg("postava <src.uid> (meno: <src.name>, acc: <src.account.name>) pouziva runu na vraceni resistu z hodnoty <src.resist> a nastavuje na <tag.resist>.")
 	 	 	   	 	   src.Resist=<tag(resist)>
               tag(lastUsage,<eval serv.time+10>)
 	 	 	   	 	   src.classmessage("Byl ti znovu nastaveny resist.")
 	 	 	   	 	   return 1
 	 	 	   	 	 else
 	 	 	   	 	   src.classmessage("Resist ma puvodni hodnotu.")
 	 	 	   	 	   return 0
 	 	 	   	 	 endif
 	 	 	   	 else
 	 	 	   	 	 src.sysMessage("Nesouhlasi tvuj realm.")
 	 	 	   	 	 return 0
 	 	 	   	 endif
 	 	 	   else
 	 	 	   	 src.redmessage("Chyba c. 1, kontaktuj GM, nejlepe GM Aldarona.")
 	 	 	   	 return 0
 	 	 	   endif
 	 	 	 else
 	 	 	 	 //if (src.tag(playersname)) == (tag(name))
 	 	 	 	 if (!(strcmpi("<tag(name)>","<src.tag(playersname)>")))
 	 	 	 	 	 if ((src.tag(realm)) == (tag(realm)))
 	 	 	   	 	 if (!((src.Resist) == <tag(resist)>))
 	   	 	       logmsg("postava <src.uid> (meno: <src.name>, acc: <src.account.name>) pouziva runu na vraceni resistu z hodnoty <src.resist> a nastavuje na <tag.resist>.")
 	 	 	   	 	   src.Resist=<tag(resist)>
 	 	 	   	 	   src.classmessage("Byl ti znovu nastaveny resist.")
               tag(lastUsage,<eval serv.time+10>)
 	 	 	   	 	   return 1
 	 	 	   	 	 else
 	 	 	   	 	   src.classmessage("Resist ma puvodni hodnotu.")
 	 	 	   	 	   return 0
 	 	 	   	 	 endif
 	 	 	   	 else
 	 	 	   	 	 src.sysMessage("Nesouhlasi tvuj realm.")
 	 	 	   	 	 return 0
 	 	 	   	 endif
 	 	 	   else
 	 	 	   	 src.redmessage("Chyba c. 2, kontaktuj GM, nejlepe GM Aldarona. ")
 	 	 	   	 return 0
 	 	 	   endif
 	 	 	 endif
 	 	 else 
 	 	 	 if (strlen("<src.tag(maskattribs)>"))
 	 	 	   //if (<src.name> == <tag(first_name)>)
 	 	 	   if (!(strcmpi("<tag(first_name)>","<src.name>")))
 	 	 	   	 if ((src.tag(realm)) == (tag(first_realm)))
 	 	 	   	 	 if (!((src.Resist) == <tag(resist)>))
 	   	 	       logmsg("postava <src.uid> (meno: <src.name>, acc: <src.account.name>) pouziva runu na vratenie resistu z hodnoty <src.resist> a nastavuje na <tag.resist>.")
 	 	 	   	 	   src.Resist=<tag(resist)>
 	 	 	   	 	   src.classmessage("Byl ti znovu nastaveny resist.")
               tag(lastUsage,<eval serv.time+10>)
 	 	 	   	 	   return 1
 	 	 	   	 	 else
 	 	 	   	 	   src.classmessage("Resist ma puvodni hodnotu.")
 	 	 	   	 	   return 0
 	 	 	   	 	 endif
 	 	 	   	 else
 	 	 	   	 	 src.sysMessage("Nesouhlasi tvuj realm.")
 	 	 	   	 	 return 0
 	 	 	   	 endif
 	 	 	   //elseif (<src.name> == <tag(second_name)>)
 	 	 	   elseif (!(strcmpi("<tag(second_name)>","<src.name>")))
 	 	 	   	 if ((src.tag(realm)) == (tag(second_realm)))
 	 	 	   	 	 if (!((src.Resist) == <tag(resist)>))
 	   	 	       logmsg("postava <src.uid> (meno: <src.name>, acc: <src.account.name>) pouziva runu na vraceni resistu z hodnoty <src.resist> a nastavuje na <tag.resist>.")
 	 	 	   	 	   src.Resist=<tag(resist)>
 	 	 	   	 	   src.classmessage("Byl ti znovu nastaveny resist.")
               tag(lastUsage,<eval serv.time+10>)
 	 	 	   	 	   return 1
 	 	 	   	 	 else
 	 	 	   	 	   src.classmessage("Resist ma puvodni hodnotu.")
 	 	 	   	 	   return 0
 	 	 	   	 	 endif
 	 	 	   	 else
 	 	 	   	 	 src.sysMessage("Nesouhlasi tvuj realm.")
 	 	 	   	 	 return 0
 	 	 	   	 endif
 	 	 	   else
 	 	 	   	 src.redmessage("Chyba c. 3, kontaktuj GM, nejlepe GM Aldarona. ")
 	 	 	   	 return 0
 	 	 	   endif
 	 	 	 else
 	 	 	 	 //if (<src.name>) == (tag(name))
 	 	 	 	 if (!(strcmpi("<tag(name)>","<src.name>")))
 	 	 	 	 	 if ((src.tag(realm)) == (tag(realm)))
 	 	 	   	 	 if (!((src.Resist) == <tag(resist)>))
 	   	 	       logmsg("postava <src.uid> (meno: <src.name>, acc: <src.account.name>) pouziva runu na vraceni resistu z hodnoty <src.resist> a nastavuje na <tag.resist>.")
 	 	 	   	 	   src.Resist=<tag(resist)>
 	 	 	   	 	   src.classmessage("Byl ti znovu nastaveny resist.")
               tag(lastUsage,<eval serv.time+10>)
 	 	 	   	 	   return 1
 	 	 	   	 	 else
 	 	 	   	 	   src.classmessage("Resist ma puvodni hodnotu.")
 	 	 	   	 	   return 0
 	 	 	   	 	 endif
 	 	 	   	 else
 	 	 	   	 	 src.sysMessage("Nesouhlasi tvuj realm.")
 	 	 	   	 	 return 0
 	 	 	   	 endif
 	 	 	   else
 	 	 	   	 src.redmessage("Chyba c. 4, kontaktuj GM, nejlepe GM Aldarona.")
 	 	 	   	 return 0
 	 	 	   endif
 	 	 	 endif
 	 	 endif
 	 else
 	 	 //if (<src.name>) == (tag(name))
 	 	 if (src.isnazgul)
 	 	 	 if (!(strcmpi("<tag(name)>","<src.tag(playersname)>")))
 	 	 	 	 if ((src.tag(realm)) == (tag(realm)))
 	 	 	   	 if (!((src.Resist) == <tag(resist)>))
 	   	 	     logmsg("postava <src.uid> (meno: <src.name>, acc: <src.account.name>) pouziva runu na vratenie resistu z hodnoty <src.resist> a nastavuje na <tag.resist>.")
 	 	 	   	   src.Resist=<tag(resist)>
 	 	 	   	   src.classmessage("Byl ti znovu nastaveny resist.")
             tag(lastUsage,<eval serv.time+10>)
 	 	 	   	   return 1
 	 	 	   	 else
 	 	 	   	   src.classmessage("Resist ma puvodni hodnotu.")
 	 	 	   	   return 0
 	 	 	   	 endif
 	 	 	   else
 	 	 	   	 src.sysMessage("Nesouhlasi tvuj realm.")
 	 	 	   	 return 0
 	 	 	   endif
 	 	 	 else
 	 	 	   src.redmessage("Chyba c. 5, kontaktuj GM, nejlepe GM Aldarona.")
 	 	 	   return 0
 	 	 	 endif
 	 	 else
 	 	   if (!(strcmpi("<tag(name)>","<src.name>")))
 	 	     if ((src.tag(realm)) == (tag(realm)))
 	     	   if (!((src.Resist) == <tag(resist)>))
 	     	   	 logmsg("postava <src.uid> (meno: <src.name>, acc: <src.account.name>) pouziva runu na vratenie resistu z hodnoty <src.resist> a nastavuje na <tag.resist>.")
 	 	   	     src.Resist=<tag(resist)>
 	 	     	   src.classmessage("Byl ti znovu nastaveny resist.")
             tag(lastUsage,<eval serv.time+10>)
 	 	     	   return 1
 	 	     	 else
 	 	      	 src.classmessage("Resist ma puvodni hodnotu.")
 	 	      	 return 0
 	 	    	 endif
 	       else
 	 	   	   src.sysMessage("Nesouhlasi tvuj realm.")
 	 	   	   return 0
 	   	 else
 	   	 	 src.redmessage("Chyba c. 6, kontaktuj GM, nejlepe GM Aldarona.")
 	   	 	 return 0
 	   	 endif
 	 	 endif
   endif
 endif
 return 0
 
[itemdef i_sword_test]
name=Tancici mec [artefakt]
ID=i_cutlass
RESOURCES=10 i_ingot_mithril
SKILLMAKE=BLACKSMITHING 100.0, TINKERING 95.0
DAM=70

on=@create
hitpoints=03200
color=098c
attr=014
EVENTS=tmi_info
EVENTS=tmi_61
EVENTS=tmi_103
tag(imi_other_present,"61, 103")
tag(imi_value_61,30)
tag(imi_value_103,20)
tag(equip,0)

ON=@userCLICK
SRC.sysMessage("Nemuzes odtrhnout zrak od dokonale zbrane...")

on=@userDClick
if (attr == 014)
	attr = 004
endif
if (tag(equip) != 1)
	equip
	attr=014
	tag(equip,1)
else
	unequip
	attr=014
	tag(equip,0)
endif
attr=014
return 0
	
ON=@equip
cont.events=+e_mithril
cont.sysMessage("Citis magicke chveni...")

on=@unequip
cont.events=-e_mithril

////////////////////////
////// STINOVE ZBRANE 
////////////////////////

[itemdef i_shadow_weapon_bag]
id=i_bag

on=@create
type=shadow_weapon_bag
color=07FFF
Name=Pytlik s magickou zbrani

on=@userclick
return"<allcontainersClick>"

[typedef shadow_weapon_bag]
on=@create
color=07FFF
Name=Pytlik s magickou zbrani

on=@userdclick
f_shadow_weapon_create
return 0

on=@StackOn
f_stackOn_dropBy(<argo>)
return 1

[FUNCTION f_shadow_weapon_create] /// POTOM DOPLNIT CLASSY A ROZNE ITEMY
if (src.profession==class_thief)
  src.newitemsafe(i_kryss_obsidian)
  src.tag(shadow_weapon,<lastnew>)
  lastnew.tag(imi_value[51], 10)
  lastnew.tag(imi_value[101], 10)
  lastnew.tag(imi_value[102], 10)
  lastnew.tag(imi_value[103], 10)
  lastnew.tag(imi_value[104], 10)
  lastnew.tag(imi_value[105], 10)  
  lastnew.mif_finishitem
  lastnew.name=Stinova zbran
  lastnew.color=07FFF
  lastnew.attr=014
  lastnew.events=+t_weapon_shadow
  lastnew.bounce
  lastnew.tag(deaths,0)
  lastnew.tag(max_deaths,10)
  lastnew.tag(equip,0)
  lastnew.tag(container,<lastnew.cont.uid>)
	lastnew.tag(craftedby,<src.uid>)
  src.events +e_shadow_weapon
elseif (src.profession==class_war)
  src.newitemsafe(i_sword_long_obsidian)
  src.tag(shadow_weapon,<lastnew>)
  lastnew.tag(imi_value[51], 10)
  lastnew.tag(imi_value[101], 10)
  lastnew.tag(imi_value[102], 10)
  lastnew.tag(imi_value[103], 10)
  lastnew.tag(imi_value[104], 10)
  lastnew.tag(imi_value[105], 10)  
  lastnew.mif_finishitem
  lastnew.name=Stinova zbran
  lastnew.color=07FFF
  lastnew.attr=014
  lastnew.events=+t_weapon_shadow
  lastnew.bounce
  lastnew.tag(deaths,0)
  lastnew.tag(max_deaths,10)
  lastnew.tag(equip,0)
  lastnew.tag(container,<lastnew.cont.uid>)
	lastnew.tag(craftedby,<src.uid>)
  src.events +e_shadow_weapon
elseif (src.profession==class_priest)
  src.newitemsafe(i_hammer_pick_obsidian)
  src.tag(shadow_weapon,<lastnew>)
  lastnew.tag(imi_value[51], 10)
  lastnew.tag(imi_value[101], 10)
  lastnew.tag(imi_value[102], 10)
  lastnew.tag(imi_value[103], 10)
  lastnew.tag(imi_value[104], 10)
  lastnew.tag(imi_value[105], 10)  
  lastnew.mif_finishitem
  lastnew.name=Stinova zbran
  lastnew.color=07FFF
  lastnew.attr=014
  lastnew.events=+t_weapon_shadow
  lastnew.bounce
  lastnew.tag(deaths,0)
  lastnew.tag(max_deaths,10)
  lastnew.tag(equip,0)
  lastnew.tag(container,<lastnew.cont.uid>)
	lastnew.tag(craftedby,<src.uid>)
  src.events +e_shadow_weapon
elseif ((src.profession==class_ranger) || (src.profession==class_craft))
  src.newitemsafe(i_crossbow_heavy_obsidian)
  src.tag(shadow_weapon,<lastnew>)
  lastnew.tag(imi_value[51], 10)
  lastnew.tag(imi_value[101], 10)
  lastnew.tag(imi_value[102], 10)
  lastnew.tag(imi_value[103], 10)
  lastnew.tag(imi_value[104], 10)
  lastnew.tag(imi_value[105], 10)  
  lastnew.mif_finishitem
  lastnew.name=Stinova zbran
  lastnew.color=07FFF
  lastnew.attr=014
  lastnew.events=+t_weapon_shadow
  lastnew.bounce
  lastnew.tag(deaths,0)
  lastnew.tag(max_deaths,10)
  lastnew.tag(equip,0)
  lastnew.tag(container,<lastnew.cont.uid>)
	lastnew.tag(craftedby,<src.uid>)
  src.events +e_shadow_weapon
elseif ((src.profession==class_mystik) || (src.profession==class_necro) || (src.profession==class_mag) || (src.profession==class_shaman))
  src.newitemsafe(i_staff_gnarled_obsidian)
  src.tag(shadow_weapon,<lastnew>)
  lastnew.tag(imi_value[25], 10)
  lastnew.tag(imi_value[101], 10)
  lastnew.tag(imi_value[102], 10)
  lastnew.tag(imi_value[103], 10)
  lastnew.tag(imi_value[104], 10)
  lastnew.tag(imi_value[105], 10)  
  lastnew.mif_finishitem
  lastnew.name=Stinova zbran
  lastnew.color=07FFF
  lastnew.attr=014
  lastnew.events=+t_weapon_shadow
  lastnew.bounce
  lastnew.tag(deaths,0)
  lastnew.tag(max_deaths,10)
  lastnew.tag(equip,0)
  lastnew.tag(container,<lastnew.cont.uid>)
	lastnew.tag(craftedby,<src.uid>)
  src.events +e_shadow_weapon
endif
//remove

[EVENTS e_shadow_weapon]
on=@death
if (!(strcmpi("<src.findlayer(1).name>","Stinova zbran")))||(!(strcmpi("<src.findlayer(2).name>","Stinova zbran")))
	shadowequip
endif

if !(findid(i_checkstats_timer)) // iba ak ztraca expy, nech ho nepripravime nejakymi hlupymi resskillmi
  tag(shadow_weapon).tag(deaths,<tag(shadow_weapon).tag(deaths)>+1)
endif

if (tag(shadow_weapon).tag(deaths) == tag(shadow_weapon).tag(max_deaths)) // uprava smrti shadow zbrane, docasne 30, neskor bude 20
	sysMessage("Stinova zbran byla taka slaba, ze se rozplynula ve vzduchu")
	tag(shadow_weapon).remove
	tag.remove(shadow_weapon)
	events -e_shadow_weapon
else
	sysMessage("Diky tve smrti ztratila Stinova zbran cast sve sily...")
endif

[EVENTS e_shadow_weapon_dmg]
on=@Created
on=@DrinkingPotion
on=@afterswing
if ((src.profession==class_war) || (src.profession==class_craft) || (src.profession==class_thief) || (src.profession==class_ranger))
  if (act.npc) && (<eval act.tag(resist_magic)> < 999)
    act.damage_noResponse(<eval  (var(ubrano)*{<nastaveni_efekt_shadow>}/1000)>,dam_magic)
    act.effect(3,i_FX_glow_spike,6,15,1)
    //src.sysMessage("shadow : <eval  (var(ubrano)*{<nastaveni_efekt_shadow>}/1000)>")
    //act.say("shadow : <eval  (var(ubrano)*{<nastaveni_efekt_shadow>}/1000)>")
  endif
endif
return 0
on=@beforedoeffect
on=@beforegeteffect
on=@beforegetswing
on=@aftergetswing


[typedef t_weapon_shadow]
on=@pickup_pack
if (src!=topobj) // niesom vlastnik itemu
  src.sysMessage("Zbran te odmita...")
  return 0
endif
src.sysMessage("S touhle zbrani nepohnes.")
//TRIGGER=@DCLICK
return 1

on=@DROPON_CHAR
bounce
return 0


on=@DROPON_GROUND
bounce
//cont = <tag(container)>
update
return 0

on=@dropon_obj
bounce
return 0

ON=@equip
cont.events=+e_shadow_weapon_dmg
cont.tag(shadow_weapon_dmg,1)
//attr=014

on=@unequip
cont.events=-e_shadow_weapon_dmg
cont.tag(shadow_weapon_dmg,0)
//cont = <tag(container)>
//attr=04
f_shadow_weapon_check_cont(<uid>)


ON=@userDCLICK
if (<attr> == 014)
  if(<tag(equip)>)
    tag(equip,0)
    bounce
//    src.findlayer(1).bounce
    return 1
  else
    tag(equip,1)
    equip
    return 1
  endif
endif

ON=@userCLICK
if (<topobj>==<src>)||(src.isgm)
	if (tag(max_deaths) == 10)
  	if (tag(deaths) == 0) // pre 10 smrti
  		cont.sysMessage("Zbran se silne chveje.")
  	elseif (tag(deaths) > 0) && (tag(deaths) < 5) // pre 10 smrti
  		cont.sysMessage("Zbran se porad chveje silne, ale jiz ne tolik co predtim.")
    elseif (tag(deaths) > 5) && (tag(deaths) < 9) // pre 10 smrti
  		cont.sysMessage("Zbran se uz skoro nechveje.")
    elseif (tag(deaths) == 9) // pre 10 smrti
    	cont.sysMessage("Zbran se vubec nechveje.")
  	endif
  elseif (tag(max_deaths) == 20)
  	if (tag(deaths) >= 0) && (tag(deaths) < 3) // pre 20 smrti
  		cont.sysMessage("Zbran se silne chveje.")
  	elseif (tag(deaths) > 2) && (tag(deaths) < 10) // pre 20 smrti
  		cont.sysMessage("Zbran se porad chveje silne, ale jiz ne tolik co predtim.")
  	elseif (tag(deaths) > 9) && (tag(deaths) < 19) // pre 20 smrti
  		cont.sysMessage("Zbran se uz skoro nechveje.")
  	elseif (tag(deaths) == 19) // pre 20 smrti
	  	cont.sysMessage("Zbran se vubec nechveje.")
	  endif
	elseif (tag(max_deaths) == 30)
	
	if (tag(deaths) >= 0) && (tag(deaths) < 4) // pre 30 smrti	
  		cont.sysMessage("Zbran se silne chveje.")
  	elseif (tag(deaths) > 3) && (tag(deaths) < 15) // pre 30 smrti
  		cont.sysMessage("Zbran se porad chveje silne, ale jiz ne tolik co predtim.")
  	elseif (tag(deaths) > 14) && (tag(deaths) < 28) // pre 30 smrti
  		cont.sysMessage("Zbran se uz skoro nechveje.")
  	elseif (tag(deaths) == 28) || (tag(deaths) == 29 ) // pre 30 smrti	
	  	cont.sysMessage("Zbran se vubec nechveje.")
  	endif
  endif
endif

[FUNCTION f_shadow_weapon_check_cont]
src.newequip(i_shadow_weapon_checker)
lastnew.tag(weapon,<args>)
lastnew.tag(player,<src.uid>)
lastnew.tag(container,<tag(container)>)
lastnew.timer=10
  
[ITEMDEF i_shadow_weapon_checker]
ID=i_worldgem_bit
Name=checker
TYPE=t_eq_script

ON=@CREATE
attr=090

on=@timer
f_shadow_weapon_check
remove


[FUNCTION f_shadow_weapon_check]
if ((<tag(weapon).cont.uid>) != (<tag(container)>))
	if ((<tag(weapon).cont.uid>) != (<tag(container).cont.uid>))
		if (tag(weapon).cont.cont.isChar) 
			tag(weapon).cont.cont.sysMessage("Stinova zbran nebyla tva a proto se vratila k svemu pravemu majiteli...")
		endif
	  tag(weapon).cont = tag(container)
	  update
	  tag(container).cont.sysMessage("Stinova zbran se vratila zpet k tobe...")
    logmsg("vraciam shadow zbran <tag(weapon)> do baglika majitela <tag(container).cont.uid> (meno: <tag(container).cont.name>, acc<tag(container).cont.account.name>)")
    return 0
  endif
endif

////////////////////
//
// nastavovanie:
// 
//
//

[ITEMDEF i_shadow_weapon_krystal_giver]
ID=0390A
NAME=Stojan s krystalom
TYPE=t_normal

on=@create
attr=attr_move_never
color=00

on=@timer
if (tag(gave_krystal) == 1)
	tag(gave_krystal,0)
endif
return 1

on=@userdclick
if (src.isgm)
	src.sysMessage("Nastavovani veci: ")
	src.sysMessage("chance(1-7) ")
	dialog(d_shadow_weapon_krystal)
	return 1
endif
if (src.isdead)
	src.redmessage("Jako duch tohle nemuzes!")
	return 1
endif
if (tag(gave_krystal) == 0)
  doswitch {0 <tag(chance1)> 1 <tag(chance2)> 2 <tag(chance3)> 3 <tag(chance4)> 4 <tag(chance5)> 5 <tag(chance6)> 6 <tag(chance7)>}
    arg(krystalID,1)
    arg(krystalID,2)
    arg(krystalID,3)
    arg(krystalID,4)
    arg(krystalID,5)
    arg(krystalID,6)
    arg(krystalID,7)
  enddo
  src.newitemsafe(i_shadow_weapon_krystal_<arg(krystalID)>)
  lastnew.bounce
  tag(gave_krystal,1)
  timer 172800
else 
  src.sysMessage("Tady uz nic neni...")
endif
return 1

////// chance dialog


[dialog d_shadow_weapon_krystal]
arg(textcolor,52)
argo.SetLocation=285,50

argo.tag(sirka,290)
argo.tag(vyska,321)

argo.dialog_prvni
argo.dialog_pozadi(<argo.tag(nexty)>,1)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138)
argo.dialog_pozadi(<argo.tag(nexty)>,6,123,138)
argo.dialog_zpruhledni

argo.texta(<argo.dialog_textpos(0,0)>,42,"Nastavovanie chance na padanie krystalov:")
argo.texta(<argo.dialog_textpos(1,0)>,<d_def_writecolor>,"Chance 1: ")
argo.settext(1001,"<?eval tag(chance1)?>")
argo.textentry(<argo.dialog_textpos(1,1)>,128,<d_def_radek_vyska>,textcolor,1,1001)
argo.texta(<argo.dialog_textpos(2,0)>,<d_def_writecolor>,"Chance 2:")
argo.settext(1002,"<?eval tag(chance2)?>")
argo.textentry(<argo.dialog_textpos(2,1)>,128,<d_def_radek_vyska>,textcolor,1,1002)
argo.texta(<argo.dialog_textpos(3,0)>,<d_def_writecolor>,"Chance 3:")
argo.settext(1003,"<?eval tag(chance3)?>")
argo.textentry(<argo.dialog_textpos(3,1)>,128,<d_def_radek_vyska>,textcolor,1,1003)
argo.texta(<argo.dialog_textpos(4,0)>,<d_def_writecolor>,"Chance 4:")
argo.settext(1004,"<?eval tag(chance4)?>")
argo.textentry(<argo.dialog_textpos(4,1)>,128,<d_def_radek_vyska>,textcolor,1,1004)
argo.texta(<argo.dialog_textpos(5,0)>,<d_def_writecolor>,"Chance 5:")
argo.settext(1001,"<?eval tag(chance5)?>")
argo.textentry(<argo.dialog_textpos(5,1)>,128,<d_def_radek_vyska>,textcolor,1,1001)
argo.texta(<argo.dialog_textpos(6,0)>,<d_def_writecolor>,"Chance 6:")
argo.settext(1001,"<?eval tag(chance6)?>")
argo.textentry(<argo.dialog_textpos(6,1)>,128,<d_def_radek_vyska>,textcolor,1,1001)
argo.texta(<argo.dialog_textpos(7,0)>,<d_def_writecolor>,"Chance 7:")
argo.settext(1001,"<?eval tag(chance7)?>")
argo.textentry(<argo.dialog_textpos(7,1)>,128,<d_def_radek_vyska>,textcolor,1,1001)

//argo.texta(lastxpos+125,lastypos+(1*d_def_radek_vyska),<d_def_readcolor>,<tag(spawn_<eval arg(pctRadku)>)>)

//arg(pctRadku,0)
//argo.dialog_textpos(2,0)
//while (<arg(pctRadku)> < <argv(0)>)
//  argo.texta(lastxpos,lastypos+(<arg(pctRadku)>*d_def_radek_vyska),<d_def_writecolor>,"Spawn <eval arg(pctRadku)+1>:")
//  argo.texta(lastxpos+125,lastypos+(<arg(pctRadku)>*d_def_radek_vyska),<d_def_readcolor>,<tag(spawn_<eval arg(pctRadku)>)>)
//  argo.button(lastxpos+88,lastypos+(<arg(pctRadku)>*d_def_radek_vyska),0fb1,0fb3,1,0,<arg(pctRadku)>+10)	//nastav novej spawn
//  arg(pctRadku,#+1)
//endwhile

argo.button(<d_def_okraj>+<d_def_skvira>,(<argo.tag(vyska)>-<d_def_okraj>)-23,0fb7,0fb9,1,0,1)//ok
argo.button(<d_def_okraj>+<d_def_skvira>+33,(<argo.tag(vyska)>-<d_def_okraj>)-23,0fb1,0fb3,1,0,0)//cancel

[dialog d_shadow_weapon_krystal button]
on=0
src.sysMessage("<src.sex Stornoval Stornovala> jsi volbu. Nastaveni zustava nezmeneno.")

on=1
Src.sysMessage("Nastavujes chance padavosti krystalov.")
if (<eval argtxt(1)> > 0)
 tag(chance1,<eval argtxt(1)>)
else
 src.RedMessage("Pozor! <src.sex Nenastavil Nenastavila> chance padavosti krystalu..")
endif
if (<eval argtxt(2)> > 0)
 tag(chance2,<eval argtxt(1)>)
else
 src.RedMessage("Pozor! <src.sex Nenastavil Nenastavila> chance padavosti krystalu..")
endif
if (<eval argtxt(3)> > 0)
 tag(chance3,<eval argtxt(1)>)
else
 src.RedMessage("Pozor! <src.sex Nenastavil Nenastavila> chance padavosti krystalu..")
endif
if (<eval argtxt(4)> > 0)
 tag(chance4,<eval argtxt(1)>)
else
 src.RedMessage("Pozor! <src.sex Nenastavil Nenastavila> chance padavosti krystalu..")
endif
if (<eval argtxt(5)> > 0)
 tag(chance5,<eval argtxt(1)>)
else
 src.RedMessage("Pozor! <src.sex Nenastavil Nenastavila> chance padavosti krystalu..")
endif
if (<eval argtxt(6)> > 0)
 tag(chance6,<eval argtxt(1)>)
else
 src.RedMessage("Pozor! <src.sex Nenastavil Nenastavila> chance padavosti krystalu..")
endif
if (<eval argtxt(7)> > 0)
 tag(chance7,<eval argtxt(1)>)
else
 src.RedMessage("Pozor! <src.sex Nenastavil Nenastavila> chance padavosti krystalu..")
endif

on=@anybutton

//////////////////


[ITEMDEF i_shadow_weapon_krystal_1]
ID=01869
Name=Krystal
TYPE=T_normal

ON=@CREATE
color=098a

[ITEMDEF i_shadow_weapon_krystal_2]
ID=01869
Name=Krystal
TYPE=T_normal

ON=@CREATE
color=098b

[ITEMDEF i_shadow_weapon_krystal_3]
ID=01869
Name=Krystal
TYPE=T_normal

ON=@CREATE
color=098c

[ITEMDEF i_shadow_weapon_krystal_4]
ID=01869
Name=Krystal
TYPE=T_normal

ON=@CREATE
color=098d

[ITEMDEF i_shadow_weapon_krystal_5]
ID=01869
Name=Krystal
TYPE=T_normal

ON=@CREATE
color=098e

[ITEMDEF i_shadow_weapon_krystal_6]
ID=01869
Name=Krystal
TYPE=T_normal

ON=@CREATE
color=098f

[ITEMDEF i_shadow_weapon_krystal_7]
ID=01869
Name=Krystal
TYPE=T_normal

ON=@CREATE
color=0989

//////////////////////////////////////
// EVENT pre 4 bratov v shadow_weapon queste

[EVENTS e_shadow_weapon_brother]
on=@death
if (tag(randomizer))
	tag(randomizer).timer 0
endif

ON=@NPCSeeNewPlayer
if !(findID(i_mem_shadowremover))
	dorand 10
  	say("Vidim te, tebe poslal kovar?")
    say("Nepriblizuj se ke me!")
    say("Pomoc vrazi!")
    say("Nechces si prvne popovidat?")
    say("Hele v klidu se posad a ja si pro neco skocim!")
    say("Jestli jste se neprecenili...")
    say("Nemuzeme se nejak dohodnout?")
    say("Heru Morgul Kel")
    say("Tak kdo z vas umre prvni?")
    say("Tak pojdte milankove!")
  enddo
  newequip(i_mem_shadowremover)
  lastnew.timer=<tag(shadow_remover)>
  lastnew.tag(told,0)
  tag(randomizer,<memoryfindtype(Memory_ISpawned).link.tag(randomizer)>)
  lastnew.tag(randomizer,<memoryfindtype(Memory_ISpawned).link.tag(randomizer)>)
endif
  
[ITEMDEF i_mem_shadowremover]
id=i_memory
Name=remover
TYPE=t_eq_script

ON=@CREATE
attr=090

on=@timer
topobj.newitem(i_fx_glow2)
lastnew.name=energie
lastnew.color=098c
lastnew.p=<topobj.p>
lastnew.timer=4
dorand 10
  lastnew.say("Moc vam to zabijeni nejde - ja se loucim!")
  lastnew.say("Priste to zkuste rychleji! Papa.")
  lastnew.say("Tak jsme si pohrali a ja pujdu...")
  lastnew.say("Pozdravujte kovare a at si priste najme silnejsi kumpany. ")
  lastnew.say("Vas poslal kovar? Slabota. Loucim se.")
  lastnew.say("Radsi se rozloucim. Pozdravujte kovare.")
  lastnew.say("Priste vam to pujde snad lepe. Loudalove.")
  lastnew.say("Koukejte jit trenovat, na mne nemate!")
  lastnew.say("HAHAHA")
  lastnew.say("To bylo reci o pomste a ted takove lamy!")
enddo
if (tag(randomizer))
	tag(randomizer).timer=0
endif
cont.remove
remove

//////////////////
/// equip shadow zbrane

[function shadowequip]
if (src.tag(shadow_weapon))
  if (!(strcmpi("<src.findlayer(1).name>","Stinova zbran")))
    src.findlayer(1).unequip
    src.findlayer(1).bounce
  elseif (!(strcmpi("<src.findlayer(2).name>","Stinova zbran")))
    src.findlayer(2).unequip
    src.findlayer(2).bounce
  else
  	src.tag(shadow_weapon).equip
  endif
else
	src.sysMessage("Toto neni pro tebe.")
endif

/////////////////////
//// skulls and heads event

[typedef t_head_in_corpse]
on=@pickup_pack
if (topobj.isItem)
  doswitch {0 40 1 60}
    arg(remove,1)
    arg(remove,0)
  enddo
endif
if (arg(remove) == 1)
	src.sysMessage("<name> byla tak krehka, ze se rozpadla.")
	remove
	update
else
	src.sysMessage("Musis byt velmi opatrny pri zachazeni s tak krehkym predmetem.")
endif
events -t_head_in_corpse


/////////////////////////
//// spawn randomizer
//

// spawn - spawn ktory ma ovladat

// chance1 - chance na c_q039_verlix
// chance2 - chance na c_q039_mercelis
// chance3 - chance na c_q039_gloata
// chance4 - chance na c_q039_bakchor

[ITEMDEF i_shadow_quest_randomizer]
ID=0EDC
Name=Ovladac spawnu
TYPE=T_normal

ON=@CREATE
attr=090
color=0986

on=@timer
if !(finduid(tag(spawn).tag(lastspawned)))
  doswitch {0 <tag(chance1)> 1 <tag(chance2)> 2 <tag(chance3)> 3 <tag(chance4)>}
    arg(charid,c_q039_verlix)
    arg(charid,c_q039_mercelis)
    arg(charid,c_q039_gloata)
    arg(charid,c_q039_bakchor)
  enddo
  tag(spawn).more1(arg(charid))
  tag(spawn).timer(<f_get_spawn_timer(<tag(spawn).moreP>)>)
endif
return 1


[Function f_get_spawn_timer]
return (<argv(1)>*60)

///////////////////////////////
//// traps for OCS
//


[ITEMDEF i_ocs_trap]
ID=0495
Name=Podivna dlazka
TYPE=T_normal

ON=@CREATE
attr=010
color=00

on=@step
if (src.isgm) 
	return 0
endif	
if (<src.flags>&statf_dead)
  return 0
endif
if (tag(controller).tag(traps_active) == 1)
	if (src.hasarmor)
    src.hits = 0
    effect(2,i_trap_axe_2,6,16,0)
    //src.effect(3,i_fx_curse,6,15,1)
    //sound=<s_explosion.sound>
	  src.sysMessage("Pod tvou vahou se dlazdice propadla a past spustila. Ale bylo to rychle, skoro bezbolestne.")
  else
	  src.sysMessage("Dlazdice sice vydava podivne zvuky, ale zustava na svem miste.")
  endif	
else
	src.sysMessage("Dlazdice sice vydava podivne zvuky, ale zustava na svem miste.")
endif
return 1

[function hasarmor]
if (src.findlayer(3))
	if !(src.findlayer(3).isarmor)
		return 1
	endif
endif
if (src.findlayer(4))
	if !(src.findlayer(4).isarmor)
		return 1
	endif
endif
if (src.findlayer(5))
	if !(src.findlayer(5).isarmor)
		return 1
	endif
endif
if (src.findlayer(6))
	if !(src.findlayer(6).isarmor)
		return 1
	endif
endif
if (src.findlayer(7))
	if !(src.findlayer(7).isarmor)
		return 1
	endif
endif
if (src.findlayer(10))
	if !(src.findlayer(10).isarmor)
		return 1
	endif
endif
if (src.findlayer(12))
	if !(src.findlayer(12).isarmor)
		return 1
	endif
endif
if (src.findlayer(13))
	if !(src.findlayer(13).isarmor)
		return 1
	endif
endif
if (src.findlayer(17))
	if !(src.findlayer(17).isarmor)
		return 1
	endif
endif
if (src.findlayer(19))
	if !(src.findlayer(19).isarmor)
		return 1
	endif
endif
if (src.findlayer(20))
	if !(src.findlayer(20).isarmor)
		return 1
	endif
endif
if (src.findlayer(22))
	if !(src.findlayer(22).isarmor)
		return 1
	endif
endif
if (src.findlayer(23))
	if !(src.findlayer(23).isarmor)
		return 1
	endif
endif
if (src.findlayer(24))
	if !(src.findlayer(24).isarmor)
		return 1
	endif
endif
return 0

[ITEMDEF i_ocs_trap_controller]
id=0A0A
name=Pochoden
type=t_normal

on=@create
tag(traps_active,1)

on=@UserDClick
if (tag(traps_active) == 1)
  if (dispID==i_torch_wall)
    dispID=0A07
  else
    dispID=0A0C
  endif
  update
  sfx(054)
	tag(traps_active,0)
	timer(10)
else
	src.sysMessage("Nic se nestalo")
endif

on=@timer
if (tag(traps_active) == 0)
	tag(traps_active,1)
	if (dispID==i_torch_wall_lit)
    dispID=0A05
  else
    dispID=0A0A
  endif
  update
  sfx(04BB)
endif
return 1

////////////////////////
//// kanon
//


[ITEMDEF i_ocs_cannon]
ID=0E8B
Name=Cannon
TYPE=T_normal

ON=@CREATE
attr=010
color=00

on=@userDClick
if (src.isgm) 
	return 0
endif	

if (<src.flags>&statf_dead)
  return 0
endif

if (tag(first_part).tag(shooted) == 0)
  if (<src.RESTEST(i_cannon_ball)>)
	  src.consume(1,i_cannon_ball)
	  tag(wall).timer=1
	  tag(first_part).tag(shooted,1)
	  timer=7200
	  tag(first_part).effect(2,i_fx_explode,2,15,1)
	  tag(wall).effect(0,i_cannon_ball,6,15,1)
  else
	  src.sysMessage("Nemas cim vystrelit.")
  endif
else
	src.sysMessage("Uz jsi vystrelil.")
endif
return 1

on=@timer
if (tag(first_part).tag(shooted) == 1)
	tag(first_part).tag(shooted,0)
	tag(wall).nudgedown(80)
	tag(wall).attr = 010
	tag(wall).update
endif
return 1


[ITEMDEF i_ocs_cannon_wall]
ID=i_wall_stone
Name=Stena
TYPE=T_normal

ON=@CREATE
attr=010
color=00

on=@dclick
if (src.isgm) 
	return 0
endif	

if (<src.flags>&statf_dead)
  return 0
endif
return 0

on=@timer
effect(2,i_fx_explode,2,15,1)
nudgeup(80)
attr = 090
update
return 1

////////////////////////////////
//// VETESNIK && ITEMY MENU
//

[function vetesnik]
if (src.isgm)
  dialog(d_vetesnik_info)
else
	src.sysMessage("Tato funkce neni pro tebe")
endif

[dialog d_vetesnik_info]
//<finduid(#0274EA9).tag(payedgold)>
arg(textcolor,52)
argo.SetLocation=205,150

argo.tag(sirka,572)
argo.tag(vyska,447)

argo.dialog_prvni
argo.dialog_pozadi(<argo.tag(nexty)>,2,333)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,207)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,207)
argo.dialog_pozadi(<argo.tag(nexty)>,1)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,207)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,207)
argo.dialog_pozadi(<argo.tag(nexty)>,2)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138,138)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138,138)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138,138)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,207)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,207)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,207)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,207)
argo.dialog_pozadi(<argo.tag(nexty)>,1)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138,138)
argo.dialog_pozadi(<argo.tag(nexty)>,1,123,138,138)
argo.dialog_zpruhledni

argo.texta(<argo.dialog_textpos(0,0)>,42,"VETESNIK")
argo.texta(lastxpos+333,lastypos+20,<d_def_readcolor>,"Od 22.1.2012:")
argo.texta(<argo.dialog_textpos(1,0)>,<d_def_readcolor>,"Prachy za ident:")
argo.texta(<argo.dialog_textpos(1,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(payedgold)>")
argo.texta(lastxpos+207,lastypos,<d_def_writecolor>,"<eval <finduid(#0402D472F).tag(payedgold)>-704996000>")
argo.texta(<argo.dialog_textpos(2,0)>,<d_def_readcolor>,"Identifik. itemy:")
argo.texta(<argo.dialog_textpos(2,1)>,<d_def_writecolor>,"<eval <finduid(#0402D472F).tag(payedgold)>/5000>")
argo.texta(lastxpos+207,lastypos,<d_def_writecolor>,"<eval (<finduid(#0402D472F).tag(payedgold)>/5000)-(704996000/5000)>")
argo.texta(<argo.dialog_textpos(3,0)>,<d_def_readcolor>,"Vymena:")
argo.texta(<argo.dialog_textpos(4,0)>,<d_def_readcolor>,"Vybrali itemov:")
argo.texta(<argo.dialog_textpos(4,1)>,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(collected_items)>")
argo.texta(lastxpos+207,lastypos,<d_def_writecolor>,"<eval <finduid(#0402D472F).tag(collected_items)>-1490>")
argo.texta(<argo.dialog_textpos(5,0)>,<d_def_readcolor>,"Rozdali itemov:")
argo.texta(<argo.dialog_textpos(5,1)>,<d_def_writecolor>,"<eval <finduid(#0402D472F).tag(collected_items)>/5>")
argo.texta(lastxpos+207,lastypos,<d_def_writecolor>,"<eval (<finduid(#0402D472F).tag(collected_items)>/5)-(1490/5)>")
argo.texta(<argo.dialog_textpos(6,0)>,42,"MAGICKE ITEMY")
argo.texta(<argo.dialog_textpos(7,1)>,<d_def_readcolor>,"Zelene")
argo.texta(lastxpos+140,lastypos,<d_def_readcolor>,"Hnede")
argo.texta(<argo.dialog_textpos(7,3)>,<d_def_readcolor>,"Cierne")
argo.texta(<argo.dialog_textpos(8,0)>,<d_def_readcolor>,"Padli:")
argo.texta(<argo.dialog_textpos(8,1)>,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(padnute_zelene)>")
argo.texta(lastxpos+140,lastypos,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(padnute_hnede)>")
argo.texta(<argo.dialog_textpos(8,3)>,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(padnute_cierne)>")
argo.texta(<argo.dialog_textpos(9,0)>,<d_def_readcolor>,"Boli rozklikane:")
argo.texta(<argo.dialog_textpos(9,1)>,<d_def_writecolor>,"<eval <eval finduid(#0402D472F).tag(gondori_zelene)>+<eval finduid(#0402D472F).tag(mordori_zelene)>>")
argo.texta(lastxpos+140,lastypos,<d_def_writecolor>,"<eval <eval finduid(#0402D472F).tag(gondori_hnede)>+<eval finduid(#0402D472F).tag(mordori_hnede)>>")
argo.texta(<argo.dialog_textpos(9,3)>,<d_def_writecolor>,"<eval <eval finduid(#0402D472F).tag(gondori_cierne)>+<eval finduid(#0402D472F).tag(mordori_cierne)>>")
argo.texta(<argo.dialog_textpos(10,1)>,<d_def_readcolor>,"Gondori rozklikali:")
argo.texta(lastxpos+210,lastypos,<d_def_readcolor>,"Mordori rozklikali:")
argo.texta(<argo.dialog_textpos(11,0)>,<d_def_readcolor>,"Zelene:")
argo.texta(<argo.dialog_textpos(11,1)>,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(gondori_zelene)>")
argo.texta(lastxpos+210,lastypos,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(mordori_zelene)>")
argo.texta(<argo.dialog_textpos(12,0)>,<d_def_readcolor>,"Hnede:")
argo.texta(<argo.dialog_textpos(12,1)>,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(gondori_hnede)>")
argo.texta(lastxpos+210,lastypos,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(mordori_hnede)>")
argo.texta(<argo.dialog_textpos(13,0)>,<d_def_readcolor>,"Cierne:")
argo.texta(<argo.dialog_textpos(13,1)>,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(gondori_cierne)>")
argo.texta(lastxpos+210,lastypos,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(mordori_cierne)>")
argo.texta(<argo.dialog_textpos(14,0)>,<d_def_readcolor>,"Podla materialu:")
argo.texta(<argo.dialog_textpos(15,0)>,<d_def_readcolor>,"Mithril:")
argo.texta(<argo.dialog_textpos(15,1)>,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(padnute_mithil)>")
argo.texta(lastxpos+140,lastypos,<d_def_readcolor>,"Elven:")
argo.texta(<argo.dialog_textpos(15,3)>,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(padnute_elven)>")
argo.texta(<argo.dialog_textpos(16,0)>,<d_def_readcolor>,"Adamantium:")
argo.texta(<argo.dialog_textpos(16,1)>,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(padnute_ada)>")
argo.texta(lastxpos+140,lastypos,<d_def_readcolor>,"Eben:")
argo.texta(<argo.dialog_textpos(16,3)>,<d_def_writecolor>,"<eval finduid(#0402D472F).tag(padnute_eben)>")

////////////////////////////////
//// mapy menu
//

[function mapy]
if (src.isgm)
  dialog(d_mapy_info)
else
	src.sysMessage("Tato funkce neni pro tebe")
endif

[dialog d_mapy_info]
arg(textcolor,52)
argo.SetLocation=205,150

argo.tag(sirka,290)
argo.tag(vyska,222)

argo.dialog_prvni
argo.dialog_pozadi(<argo.tag(nexty)>,1)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_zpruhledni

argo.texta(<argo.dialog_textpos(0,0)>,42,"TAJOMNE MAPY (22.1.2012)")
argo.texta(<argo.dialog_textpos(1,0)>,<d_def_readcolor>,"Padlo:")
argo.texta(<argo.dialog_textpos(1,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(padnute_mapy)>")
argo.texta(<argo.dialog_textpos(2,0)>,<d_def_readcolor>,"Z fishingu:")
argo.texta(<argo.dialog_textpos(2,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(padnute_mapy_fishing)>")
argo.texta(<argo.dialog_textpos(3,0)>,<d_def_readcolor>,"Lusknute:")
argo.texta(<argo.dialog_textpos(3,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(vylustene_mapy)>")
argo.texta(<argo.dialog_textpos(4,0)>,<d_def_readcolor>,"Vykopane:")
argo.texta(<argo.dialog_textpos(4,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(vykopane_mapy)>")
argo.texta(<argo.dialog_textpos(5,0)>,<d_def_readcolor>,"Padnute bonus:")
argo.texta(<argo.dialog_textpos(5,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(padnute_mapy_bonus)>")
argo.texta(<argo.dialog_textpos(6,0)>,<d_def_readcolor>,"Lusknute bonus:")
argo.texta(<argo.dialog_textpos(6,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(vylustene_mapy_bonus)>")
argo.texta(<argo.dialog_textpos(7,0)>,<d_def_readcolor>,"Vykopane bonus:")
argo.texta(<argo.dialog_textpos(7,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(vykopane_mapy_bonus)>")
argo.texta(<argo.dialog_textpos(8,0)>,<d_def_readcolor>,"Nacate fishing spawny: ")
argo.texta(<argo.dialog_textpos(8,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(fishing_area_started)>")

////////////////////////////////
//// mapy menu
//

[function craft_info]
if (src.isgm)
  dialog(d_craft_info)
else
	src.sysMessage("Tato funkce neni pro tebe")
endif

[dialog d_craft_info]
arg(textcolor,52)
argo.SetLocation=205,150

argo.tag(sirka,290)
argo.tag(vyska,222)

argo.dialog_prvni
argo.dialog_pozadi(<argo.tag(nexty)>,1)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_zpruhledni

argo.texta(<argo.dialog_textpos(0,0)>,42,"CRAFT INFO (9.3.2012 - 22:00)")
argo.texta(<argo.dialog_textpos(1,0)>,<d_def_readcolor>,"Pocet spawnov LJ")
argo.texta(<argo.dialog_textpos(1,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(lumber_area_started)>")
argo.texta(<argo.dialog_textpos(2,0)>,<d_def_readcolor>,"Pocet spawnov mining")
argo.texta(<argo.dialog_textpos(2,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(mining_area_started)>")
argo.texta(<argo.dialog_textpos(3,0)>,42,"Padlo:")
argo.texta(<argo.dialog_textpos(4,0)>,<d_def_readcolor>,"Maha:")
argo.texta(<argo.dialog_textpos(4,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(lumber_maha)>")
argo.texta(<argo.dialog_textpos(5,0)>,<d_def_readcolor>,"Eben:")
argo.texta(<argo.dialog_textpos(5,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(lumber_eben)>")
argo.texta(<argo.dialog_textpos(6,0)>,<d_def_readcolor>,"Elven:")
argo.texta(<argo.dialog_textpos(6,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(lumber_elven)>")
argo.texta(<argo.dialog_textpos(7,0)>,<d_def_readcolor>,"Obsid:")
argo.texta(<argo.dialog_textpos(7,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(mining_obs)>")
argo.texta(<argo.dialog_textpos(8,0)>,<d_def_readcolor>,"Ada:")
argo.texta(<argo.dialog_textpos(8,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(mining_ada)>")

//////////////////////////////
//// DRACI OHEN
// 

[function f_dragon_hit_strong]
if (<argv(3)> == 1)
  newitem(i_dragon_hit_fire_strong)
  lastnew.morep=<P>
  lastnew.p=<P>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
  if !(tag(fire_dragon_round_type))
    if !(lastnew.srccombatLOS)
   	  lastnew.remove
    endif
  else
  	lastnew.tag(resist_working,0)
  endif
elseif (<argv(3)> == 2)
  newitem(i_dragon_hit_cold_strong)
  lastnew.morep=<P>
  lastnew.p=<P>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
  if !(tag(fire_dragon_round_type))
    if !(lastnew.srccombatLOS)
   	  lastnew.remove
    endif
  else
  	lastnew.tag(resist_working,0)
  endif
elseif (<argv(3)> == 3)
  newitem(i_dragon_hit_poison_strong)
  lastnew.morep=<P>
  lastnew.p=<P>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
  if !(tag(fire_dragon_round_type))
    if !(lastnew.srccombatLOS)
   	  lastnew.remove
    endif
  else
  	lastnew.tag(resist_working,0)
  endif
elseif (<argv(3)> == 4)
  newitem(i_dragon_hit_black_strong)
  lastnew.morep=<P>
  lastnew.p=<P>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
  if !(tag(fire_dragon_round_type))
    if !(lastnew.srccombatLOS)
   	  lastnew.remove
    endif
  else
  	lastnew.tag(resist_working,0)
  endif
elseif (<argv(3)> == 5)
  newitem(i_dragon_hit_white_strong)
  lastnew.morep=<P>
  lastnew.p=<P>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
  if !(tag(fire_dragon_round_type))
    if !(lastnew.srccombatLOS)
   	  lastnew.remove
    endif
  else
  	lastnew.tag(resist_working,0)
  endif
endif

[function f_dragon_hit_weak]
if (<argv(3)> == 1)
  newitem(i_dragon_hit_fire_weak)
  lastnew.morep=<P>
  lastnew.p=<P>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
  if !(tag(fire_dragon_round_type))
    if !(lastnew.srccombatLOS)
   	  lastnew.remove
    endif
  else
  	lastnew.tag(resist_working,0)
  endif
elseif (<argv(3)> == 2)
  newitem(i_dragon_hit_cold_weak)
  lastnew.morep=<P>
  lastnew.p=<P>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
  if !(tag(fire_dragon_round_type))
    if !(lastnew.srccombatLOS)
   	  lastnew.remove
    endif
  else
  	lastnew.tag(resist_working,0)
  endif
elseif (<argv(3)> == 3)
  newitem(i_dragon_hit_poison_weak)
  lastnew.morep=<P>
  lastnew.p=<P>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
  if !(tag(fire_dragon_round_type))
    if !(lastnew.srccombatLOS)
   	  lastnew.remove
    endif
  else
  	lastnew.tag(resist_working,0)
  endif
elseif (<argv(3)> == 4)
  newitem(i_dragon_hit_black_weak)
  lastnew.morep=<P>
  lastnew.p=<P>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
  if !(tag(fire_dragon_round_type))
    if !(lastnew.srccombatLOS)
   	  lastnew.remove
    endif
  else
  	lastnew.tag(resist_working,0)
  endif
elseif (<argv(3)> == 5)
  newitem(i_dragon_hit_white_weak)
  lastnew.morep=<P>
  lastnew.p=<P>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
  if !(tag(fire_dragon_round_type))
    if !(lastnew.srccombatLOS)
   	  lastnew.remove
    endif
  else
  	lastnew.tag(resist_working,0)
  endif
endif

/////////////////////////////////////// ohne 

/////// fire
[ITEMDEF i_dragon_hit_fire_strong]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=098e
tag(resist_working,1)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
else
	if (<tag(resist_working)> == 1)
	  if (<tag(dmg)> > <src.tag(dragon_resist)>)
	    src.sysMessage("Byl jsi poranen dracim ohnem.")
      src.damage_noResponse(<eval <tag(dmg)>-((<tag(dmg)>*<src.tag(dragon_resist)>)/100)>,dam_fire|dam_magic)
      src.f_fire_dragon_efect_fire(<tag(dmg)>,6)
    else
	    src.sysMessage("Draci ohen te nezranil.")
    endif
  else
    src.damage_noResponse(<tag(dmg)>,dam_fire|dam_magic)
    //src.f_fire_dragon_efect_fire(<tag(dmg)>,6)
  endif  	
endif
remove
return 1

on=@timer
remove
return 1

[ITEMDEF i_dragon_hit_fire_weak]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=0992
tag(resist_working,1)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
else
	if (<tag(resist_working)> == 1)
	  if (<tag(dmg)> > <src.tag(dragon_resist)>)
	    src.sysMessage("Byl jsi poranen dracim ohnem.")
      src.damage_noResponse(<eval (<tag(dmg)>/2)-(((<tag(dmg)>/2)*<src.tag(dragon_resist)>)/100)>,dam_fire|dam_magic)
      src.f_fire_dragon_efect_fire(<tag(dmg)>,4)
    else
	    src.sysMessage("Draci ohen te nezranil.")
    endif
  else
    src.damage_noResponse(<eval <tag(dmg)>/2>,dam_fire|dam_magic)
    //src.f_fire_dragon_efect_fire(<tag(dmg)>,4)
  endif
endif
remove
return 1

on=@timer
remove
return 1

//////// cold

[ITEMDEF i_dragon_hit_cold_strong]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=0994
tag(resist_working,1)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
else
	if (<tag(resist_working)> == 1)
	  if (<tag(dmg)> > <src.tag(dragon_resist)>)
	    src.sysMessage("Byl jsi poranen dracim ohnem.")
      src.damage_noResponse(<eval <tag(dmg)>-((<tag(dmg)>*<src.tag(dragon_resist)>)/100)>,dam_fire|dam_magic)
      src.f_fire_dragon_efect_cold(<tag(dmg)>,6)
    else
	    src.sysMessage("Draci ohen te nezranil.")
    endif
  else
    src.damage_noResponse(<tag(dmg)>,dam_fire|dam_magic)
    //src.f_fire_dragon_efect_cold(<tag(dmg)>,6)
  endif  	
endif
remove
return 1

on=@timer
remove
return 1

[ITEMDEF i_dragon_hit_cold_weak]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=0481
tag(resist_working,1)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
else
	if (<tag(resist_working)> == 1)
	  if (<tag(dmg)> > <src.tag(dragon_resist)>)
	    src.sysMessage("Byl jsi poranen dracim ohnem.")
      src.damage_noResponse(<eval (<tag(dmg)>/2)-(((<tag(dmg)>/2)*<src.tag(dragon_resist)>)/100)>,dam_fire|dam_magic)
      src.f_fire_dragon_efect_cold(<tag(dmg)>,4)
    else
	    src.sysMessage("Draci ohen te nezranil.")
    endif
  else
    src.damage_noResponse(<eval <tag(dmg)>/2>,dam_fire|dam_magic)
    //src.f_fire_dragon_efect_cold(<tag(dmg)>,4)
  endif
endif
remove
return 1

on=@timer
remove
return 1

////////////////// poison

[ITEMDEF i_dragon_hit_poison_strong]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=097f
tag(resist_working,1)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
else
	if (<tag(resist_working)> == 1)
	  if (<tag(dmg)> > <src.tag(dragon_resist)>)
	    src.sysMessage("Byl jsi poranen dracim ohnem.")
      src.damage_noResponse(<eval <tag(dmg)>-((<tag(dmg)>*<src.tag(dragon_resist)>)/100)>,dam_fire|dam_magic)
      src.f_fire_dragon_efect_poison(<tag(dmg)>,6)
    else
	    src.sysMessage("Draci ohen te nezranil.")
    endif
  else
    src.damage_noResponse(<tag(dmg)>,dam_fire|dam_magic)
    //src.f_fire_dragon_efect_poison(<tag(dmg)>,6)
  endif
endif
remove
return 1

on=@timer
remove
return 1

[ITEMDEF i_dragon_hit_poison_weak]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=0111
tag(resist_working,1)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
else
	if (<tag(resist_working)> == 1)
	  if (<tag(dmg)> > <src.tag(dragon_resist)>)
	    src.sysMessage("Byl jsi poranen dracim ohnem.")
      src.damage_noResponse(<eval (<tag(dmg)>/2)-(((<tag(dmg)>/2)*<src.tag(dragon_resist)>)/100)>,dam_fire|dam_magic)
      src.f_fire_dragon_efect_poison(<tag(dmg)>,4)
    else
	    src.sysMessage("Draci ohen te nezranil.")
    endif
  else
    src.damage_noResponse(<eval <tag(dmg)>/2>,dam_fire|dam_magic)
    //src.f_fire_dragon_efect_poison(<tag(dmg)>,6)
  endif
endif
remove
return 1

on=@timer
remove
return 1

////////////////// black

[ITEMDEF i_dragon_hit_black_strong]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=0692
tag(resist_working,1)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
else
	if (<tag(resist_working)> == 1)
	  if (<tag(dmg)> > <src.tag(dragon_resist)>)
	    src.sysMessage("Byl jsi poranen dracim ohnem.")
      src.damage_noResponse(<eval <tag(dmg)>-((<tag(dmg)>*<src.tag(dragon_resist)>)/100)>,dam_fire|dam_magic)
      src.f_fire_dragon_efect_black(<tag(dmg)>,6)
    else
	    src.sysMessage("Draci ohen te nezranil.")
    endif
  else
    src.damage_noResponse(<tag(dmg)>,dam_fire|dam_magic)
    //src.f_fire_dragon_efect_poison(<tag(dmg)>,6)
  endif
endif
remove
return 1

on=@timer
remove
return 1

[ITEMDEF i_dragon_hit_black_weak]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=0770
tag(resist_working,1)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
else
	if (<tag(resist_working)> == 1)
	  if (<tag(dmg)> > <src.tag(dragon_resist)>)
	    src.sysMessage("Byl jsi poranen dracim ohnem.")
      src.damage_noResponse(<eval (<tag(dmg)>/2)-(((<tag(dmg)>/2)*<src.tag(dragon_resist)>)/100)>,dam_fire|dam_magic)
      src.f_fire_dragon_efect_black(<tag(dmg)>,4)
    else
	    src.sysMessage("Draci ohen te nezranil.")
    endif
  else
    src.damage_noResponse(<eval <tag(dmg)>/2>,dam_fire|dam_magic)
    //src.f_fire_dragon_efect_poison(<tag(dmg)>,6)
  endif
endif
remove
return 1

on=@timer
remove
return 1

////////////////// white

[ITEMDEF i_dragon_hit_white_strong]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=0098b
tag(resist_working,1)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
else
	if (<tag(resist_working)> == 1)
	  if (<tag(dmg)> > <src.tag(dragon_resist)>)
	    src.sysMessage("Byl jsi poranen dracim ohnem.")
      src.damage_noResponse(<eval <tag(dmg)>-((<tag(dmg)>*<src.tag(dragon_resist)>)/100)>,dam_fire|dam_magic)
      src.f_fire_dragon_efect_white(<tag(dmg)>,6)
    else
	    src.sysMessage("Draci ohen te nezranil.")
    endif
  else
    src.damage_noResponse(<tag(dmg)>,dam_fire|dam_magic)
    //src.f_fire_dragon_efect_poison(<tag(dmg)>,6)
  endif
endif
remove
return 1

on=@timer
remove
return 1

[ITEMDEF i_dragon_hit_white_weak]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=0481
tag(resist_working,1)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
else
	if (<tag(resist_working)> == 1)
	  if (<tag(dmg)> > <src.tag(dragon_resist)>)
	    src.sysMessage("Byl jsi poranen dracim ohnem.")
      src.damage_noResponse(<eval (<tag(dmg)>/2)-(((<tag(dmg)>/2)*<src.tag(dragon_resist)>)/100)>,dam_fire|dam_magic)
      src.f_fire_dragon_efect_white(<tag(dmg)>,4)
    else
	    src.sysMessage("Draci ohen te nezranil.")
    endif
  else
    src.damage_noResponse(<eval <tag(dmg)>/2>,dam_fire|dam_magic)
    //src.f_fire_dragon_efect_poison(<tag(dmg)>,6)
  endif
endif
remove
return 1

on=@timer
remove
return 1

//////////////////////////////////////

[function f_fire_dragon] // argv 0 = sila, argv 1 = druh - 1 == fire, 2 == cold, 3 == poison
arg(dir,<dir>)
arg(dmg,<argv(0)>)
arg(typ,<argv(1)>)
f_dragon_hit_strong(0,0,<arg(dmg)>,<arg(typ)>)
if (<arg(dir)> == 6)
	f_dragon_hit_strong(-1,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-2,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,-2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-6,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-6,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-6,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-6,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-6,-2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-7,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-7,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-7,-2,<arg(dmg)>,<arg(typ)>)
elseif (<arg(dir)> == 7)
	f_dragon_hit_strong(-1,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-2,-2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-2,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,-2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-4,-7,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-4,-8,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-5,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-6,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-6,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-6,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-6,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-7,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-8,-4,<arg(dmg)>,<arg(typ)>)
elseif (<arg(dir)> == 2)
	f_dragon_hit_strong(1,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(2,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,-2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(6,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(6,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(6,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(6,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(6,-2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(7,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(7,0,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(7,-2,<arg(dmg)>,<arg(typ)>)
elseif (<arg(dir)> == 5)
	f_dragon_hit_strong(-1,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-2,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-2,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-3,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-4,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-4,7,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-4,8,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-5,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-5,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-6,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-6,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-6,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-6,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-7,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-8,4,<arg(dmg)>,<arg(typ)>)
elseif (<arg(dir)> == 3)
	f_dragon_hit_strong(1,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(2,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(2,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(4,7,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(4,8,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(5,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(6,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(6,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(6,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(6,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(7,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(8,4,<arg(dmg)>,<arg(typ)>)
elseif (<arg(dir)> == 1)
	f_dragon_hit_strong(1,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(2,-2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(2,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,-2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(3,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(4,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(4,-7,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(4,-8,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(5,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(5,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(6,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(6,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(6,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(6,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(7,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(8,-4,<arg(dmg)>,<arg(typ)>)
elseif (<arg(dir)> == 4)
	f_dragon_hit_strong(0,1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(0,2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(1,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(0,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-1,3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(1,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(0,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-1,4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(2,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(1,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(0,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-1,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-2,5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(2,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(1,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(0,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-1,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-2,6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(2,7,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(0,7,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-2,7,<arg(dmg)>,<arg(typ)>)
elseif (<arg(dir)> == 0)
	f_dragon_hit_strong(0,-1,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(0,-2,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(1,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(0,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-1,-3,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(1,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(0,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-1,-4,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(2,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(1,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(0,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-1,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-2,-5,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(2,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(1,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(0,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-1,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_strong(-2,-6,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(2,-7,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(0,-7,<arg(dmg)>,<arg(typ)>)
	f_dragon_hit_weak(-2,-7,<arg(dmg)>,<arg(typ)>)
endif

[function f_fire_dragon_bomb]
arg(dmg,<argv(0)>)
arg(typ,<argv(1)>)

if (<argv(1)> == 1)
act.effect(0,i_cannon_ball,6,15,1,0986)
elseif (<argv(1)> == 2)
act.effect(0,i_cannon_ball,6,15,1,0480)
elseif (<argv(1)> == 3)
act.effect(0,i_cannon_ball,6,15,1,097f)
elseif (<argv(1)> == 4)
act.effect(0,i_cannon_ball,6,15,1,0692)
elseif (<argv(1)> == 5)
act.effect(0,i_cannon_ball,6,15,1,0480)
endif

f_dragon_hit_bomb_strong(0,0,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(0,1,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(0,2,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(0,3,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(0,-1,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(0,-2,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(0,-3,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(1,0,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(1,1,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(1,2,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(1,-1,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(1,-2,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(2,0,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(2,1,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(2,-1,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(2,2,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(2,-2,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(3,0,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(-1,0,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(-1,1,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(-1,2,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(-1,-1,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(-1,-2,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_strong(-2,0,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(-2,1,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(-2,-1,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(-2,2,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(-2,-2,<arg(dmg)>,<arg(typ)>,<act.p>)
f_dragon_hit_bomb_weak(-3,0,<arg(dmg)>,<arg(typ)>,<act.p>)

[function f_dragon_hit_bomb_strong]
if (<argv(3)> == 1)
  src.newitemsafe(i_dragon_hit_fire_strong)
  lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
elseif (<argv(3)> == 2)
  src.newitemsafe(i_dragon_hit_cold_strong)
  lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
elseif (<argv(3)> == 3)
  src.newitemsafe(i_dragon_hit_poison_strong)
  lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
elseif (<argv(3)> == 4)
  src.newitemsafe(i_dragon_hit_black_strong)
  lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
elseif (<argv(3)> == 5)
  src.newitemsafe(i_dragon_hit_white_strong)
  lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
endif


[function f_dragon_hit_bomb_weak]
if (<argv(3)> == 1)
  src.newitemsafe(i_dragon_hit_fire_weak)
  lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
elseif (<argv(3)> == 2)
  src.newitemsafe(i_dragon_hit_cold_weak)
  lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
elseif (<argv(3)> == 3)
  src.newitemsafe(i_dragon_hit_poison_weak)
  lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
elseif (<argv(3)> == 4)
  src.newitemsafe(i_dragon_hit_black_weak)
  lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
elseif (<argv(3)> == 5)
  src.newitemsafe(i_dragon_hit_white_weak)
  lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
  lastnew.move=<argv(0)>,<argv(1)>
  lastnew.tag(dmg,<argv(2)>)
  lastnew.timer=2
endif

//////////////////////
//// eventy vyuzivajuce draci ohen
//


//// draci ohen klasicky
//
// tagy - dragon_fire_chance - 1000 == 100%
// tagy - dragon_fire_dmg - 100 max - 1 = 1 hp
// tagy - dragon_fire_type - typ ohna - 1 = fire, 2 = cold, 3 = poiso
// tagy - dragon_fire_delay - pauza medzi ohnami v sekundach

[events e_fire_dragon]
on=@beforegetswing
on=@aftergetswing
fire_dragon

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
fire_dragon


[function fire_dragon]
if (chance(<tag(dragon_fire_chance)>,3)) // chance in promiles
	if !(tag(nextdragonfire))
		tag(nextdragonfire,0)
	endif
  if (<eval tag(nextdragonfire)> < <serv.time>)
    tag(nextdragonfire,<serv.time>+(<tag(dragon_fire_delay)>*10))
    emote(" se zhluboka nadychuje")
    newequip(i_e_fire_dragon_create)
    lastnew.tag(dmg,<tag(dragon_fire_dmg)>)
    lastnew.tag(type,<tag(dragon_fire_type)>)
    //f_fire_dragon(<tag(dragon_fire_dmg)>,<tag(dragon_fire_type)>)
  endif
endif

[itemdef i_e_fire_dragon_create]//dela efekt
ID=i_rune_poison_field
TYPE=t_eq_script
name=draci ohen creator

on=@equip
timer=1
cont.flag_immobile=1

on=@timer
cont.f_fire_dragon(<tag(dmg)>,<tag(type)>)
cont.flag_immobile=0
remove
return 1


[events e_fire_dragon_bomb]
on=@beforegetswing
on=@aftergetswing
fire_dragon_bomb

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
fire_dragon_bomb


[function fire_dragon_bomb]
if (chance(<tag(dragon_fire_bomb_chance)>,3)) // chance in promiles
	if !(tag(nextdragonfirebomb))
		tag(nextdragonfirebomb,0)
	endif
  if (<eval tag(nextdragonfirebomb)> < <serv.time>)
    tag(nextdragonfirebomb,<serv.time>+(<tag(dragon_fire_bomb_delay)>*10))
    f_fire_dragon_bomb(<tag(dragon_fire_bomb_dmg)>,<tag(dragon_fire_bomb_type)>)
  endif
endif

////////////////////////////////
//// event dracia aura
//

//tag(dragon_fire_aura_speed) // rychlost skitnuti
//tag(dragon_fire_aura_power) // pocet skitnuti
//tag(dragon_fire_aura_dmg) // velkost dmg
//tag(dragon_fire_aura_delay) // prodleva medzi rozhadzovanim aury
//tag(dragon_fire_aura_chance) // sanca na hodenie v promile

[events e_fire_dragon_aura]
on=@beforegetswing
on=@aftergetswing
fire_dragon_aura

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
fire_dragon_aura


[function fire_dragon_aura]
if (chance(<tag(dragon_fire_aura_chance)>,3)) // chance in promiles
	if !(tag(nextdragonfireaura))
		tag(nextdragonfireaura,0)
	endif
  if (<eval tag(nextdragonfireaura)> < <serv.time>)
    tag(nextdragonfireaura,<serv.time>+(<tag(dragon_fire_aura_delay)>*10))
    //emote("pusta draciu auru") // to treba zmenit
    //sector.allchars(f_fire_dragon_aura_create(<tag(dragon_fire_aura_speed)>,<tag(dragon_fire_aura_power)>,<tag(dragon_fire_aura_dmg)>))
    newitemsafe(i_dragon_aura_creator)
    lastnew.p=<src.p>
    lastnew.z=-100
    lastnew.tag(dragon_fire_aura_speed,<tag(dragon_fire_aura_speed)>)
    lastnew.tag(dragon_fire_aura_power,<tag(dragon_fire_aura_power)>)
    lastnew.tag(dragon_fire_aura_dmg,<tag(dragon_fire_aura_dmg)>)
    if (tag(dragon_fire_aura_resist))
    	if (<tag(dragon_fire_aura_resist)> == 0)
    		lastnew.tag(dragon_resist,0)
    	else
    		lastnew.tag(dragon_resist,1)
    	endif
    else
    	lastnew.tag(dragon_resist,0)
    endif
    lastnew.timerd=1
  endif
endif

[itemdef i_dragon_aura_creator]
id=i_memory
type=t_src_changer
name=dragon aura creator

on=@create
attr=010

on=@timer
sector.allchars(f_fire_dragon_aura_create(<tag(dragon_fire_aura_speed)>,<tag(dragon_fire_aura_power)>,<tag(dragon_fire_aura_dmg)>,<tag(dragon_resist)>,<mapplane>))
remove 
return 1

[function f_fire_dragon_aura_create]

if (isdead)||!(isplayer)||(isgm)
	return 1
endif
if !(<mapplane> == <argv(4)>)
	return 1
endif
if !(<restest(i_fire_dragon_aura)>)
	newequip(i_fire_dragon_aura)
  lastnew.tag(dragon_aura_speed,<argv(0)>)
  lastnew.tag(dragon_aura_power,<argv(1)>)
  lastnew.tag(dragon_aura_dmg,<argv(2)>)
  lastnew.tag(dragon_resist,<argv(3)>)
  lastnew.tag(max_power,<argv(1)>)
  lastnew.timer=1
else
	findid(i_fire_dragon_aura).tag(dragon_aura_power,<argv(1)>)
endif

[itemdef i_fire_dragon_aura]//dela efekt
ID=i_rune_poison_field
TYPE=t_eq_script
name=draci aura

on=@equip
timer=<eval tag(dragon_aura_speed)>//jak rychle bude skytat
cont.sysMessage("<cont.sex("Byl jsi zasazen draci aurou","Byla jsi zasazena draci aurou")>!")
cont.effect(3,i_fx_explode_ball,3,16,0)
tag(max_power,<eval tag(dragon_aura_power)>)

on=@timer
timer=<eval tag(dragon_aura_speed)>
arg(resist,<eval cont.tag(dragon_resist)>)
//<eval <tag(dmg)>-((<tag(dmg)>*<src.tag(dragon_resist)>)/100)>
arg(dmg,<eval ((<tag(dragon_aura_dmg)>*<tag(dragon_aura_power)>)/<tag(max_power)>)-(((<tag(dragon_aura_dmg)>*<tag(dragon_aura_power)>)/<tag(max_power)>)*<arg(resist)>/100)>)
if (<tag(dragon_resist)> == 1)
	arg(dmg,<eval <arg(dmg)>-<eval <eval <arg(dmg)>*<arg(resist)>>/100>>)
endif
if (<tag(dragon_aura_power)> < 1)||(<arg(dmg)> < 1)||(cont.isdead) //neni skit, likvidovat
  cont.sysMessage("Draci aura byla tak slaba, ze zmizla!")
  remove
  return 1
endif
if ((cont.profession==class_mag)||(cont.profession==class_necro)||(cont.profession==class_mystik))
	cont.damage_noResponse(<eval <eval <arg(dmg)>*3>/4>,dam_fire|dam_magic)
	if (<cont.mana> < <arg(dmg)>)
		cont.mana = 0
	else
	  cont.mana = <cont.mana>-<eval <arg(dmg)>/4>
	endif
	if (<cont.stam> < <arg(dmg)>)
		cont.stam = 0
	else
	  cont.stam = <cont.stam>-<eval <arg(dmg)>/3>
	endif
else
	cont.damage_noResponse(<arg(dmg)>,dam_fire|dam_magic)
	if (<cont.stam> < <arg(dmg)>)
		cont.stam = 0
	else
	  cont.stam = <cont.stam>-<eval <arg(dmg)>/3>
	endif
endif
cont.sysMessage("Poranila te draci aura")
cont.effect(3,i_fx_explode_ball,3,16,0)

if (cont.isdead) //je mrtvy, zrusime
  remove
  return 1
endif
tag(dragon_aura_power,#-1) // dame o 1 skit menej
return 1

///////////////////////////
/// efekty dracieho ohna
//
//<tag(dmg)> <src.tag(dragon_resist)>

// fire 

[function f_fire_dragon_efect_fire]
if (src.isdead)||!(src.isplayer)||(src.isgm)
	return 1
endif

if !(<src.restest(i_fire_dragon_efect_fire)>)
	src.newequip(i_fire_dragon_efect_fire)
  if (<argv(0)> > <src.tag(dragon_resist)>)
  	arg(dmg,<eval (<argv(0)>-<src.tag(dragon_resist)>)/10>)
  else
  	arg(dmg,0)
  endif
  lastnew.tag(fire_dmg,<arg(dmg)>)
  lastnew.tag(power,<argv(1)>)
  lastnew.tag(max_power,<argv(1)>)
  lastnew.timer=1
else
	src.findid(i_fire_dragon_efect_fire).tag(power,<argv(1)>)
endif

[itemdef i_fire_dragon_efect_fire]//dela efekt
ID=i_rune_poison_field
TYPE=t_eq_script
name=draci efekt fire

on=@equip
timer=4 //jak rychle bude skytat
cont.sysMessage("Pali te draci ohen!")
cont.effect(3,i_fire,3,16,0)

on=@timer
timer=4
arg(dmg,<eval (<tag(fire_dmg)>*<tag(power)>)/<tag(max_power)>>)
if (<tag(power)> < 1)||(<arg(dmg)> < 1)||(cont.isdead) //neni skit, likvidovat
  cont.sysMessage("Draci ohen dohorel!")
  remove
  return 1
endif
cont.damage_noResponse(<arg(dmg)>,dam_fire|dam_magic) //dmg
cont.sysMessage("Poranil te draci ohen.")
cont.effect(3,i_fire,3,16,0)

if (cont.isdead) //je mrtvy, zrusime
  remove
  return 1
endif
tag(power,#-1) // dame o 1 skit menej
return 1

/// cold 

[function f_fire_dragon_efect_cold]
if (src.isdead)||!(src.isplayer)||(src.isgm)
	return 1
endif

if !(<src.restest(i_fire_dragon_efect_cold)>)
	src.newequip(i_fire_dragon_efect_cold)
  if (<argv(0)> <= <src.tag(dragon_resist)>)
  	lastnew.remove
  	return 1
  endif
  lastnew.tag(power,<argv(1)>)
  lastnew.timer=1
else
	src.findid(i_fire_dragon_efect_cold).tag(power,<argv(1)>)
endif

[itemdef i_fire_dragon_efect_cold]
ID=i_rune_poison_field
TYPE=t_eq_script
name=draci efekt cold

on=@equip
timer=4 //jak rychle bude skytat
cont.sysMessage("Mrazi te draci ohen!")
cont.effect(3,i_fx_vortex,3,16,0)
//tag(max_power,6)

on=@timer
timer=4
if (<tag(power)> < 1)||(cont.isdead) //neni skit, likvidovat
  cont.sysMessage("Draci ohen te prestal mrazit!")
  remove
  return 1
endif
cont.paralyze(10)
cont.sysMessage("Mrazi te draci ohen.")
cont.effect(3,i_fx_vortex,3,16,0)

if (cont.isdead) //je mrtvy, zrusime
  remove
  return 1
endif
tag(power,#-1) // dame o 1 skit menej
return 1


// white 

[function f_fire_dragon_efect_white]
if (src.isdead)||!(src.isplayer)||(src.isgm)
	return 1
endif

if !(<src.restest(i_fire_dragon_efect_white)>)
	src.newequip(i_fire_dragon_efect_white)
  if (<argv(0)> > <src.tag(dragon_resist)>)
  	arg(dmg,<eval (<argv(0)>-<src.tag(dragon_resist)>)/10>)
  else
  	arg(dmg,0)
  endif
  lastnew.tag(mana_dmg,<arg(dmg)>)
  lastnew.tag(power,<argv(1)>)
  lastnew.tag(max_power,<argv(1)>)
  lastnew.timer=1
else
	src.findid(i_fire_dragon_efect_white).tag(power,<argv(1)>)
endif

[itemdef i_fire_dragon_efect_white]//dela efekt
ID=i_rune_poison_field
TYPE=t_eq_script
name=draci efekt white

on=@equip
timer=4 //jak rychle bude skytat
cont.sysMessage("Draci ohen ti vysava manu!")
cont.effect(3,i_fx_glow2,3,16,0)

on=@timer
timer=4
arg(dmg,<eval (<tag(mana_dmg)>*<tag(power)>)/<tag(max_power)>>)
if (<tag(power)> < 1)||(<arg(dmg)> < 1)||(cont.isdead) //neni skit, likvidovat
  cont.sysMessage("Draci ohen zmizel!")
  remove
  return 1
endif
if (<cont.mana> < <arg(dmg)>)
	cont.mana = 0
else
	cont.mana = <eval <cont.mana>-<arg(dmg)>> //dmg
endif
cont.sysMessage("Draci ohen ti vysava manu!.")
cont.effect(3,i_fx_glow2,3,16,0)

if (cont.isdead) //je mrtvy, zrusime
  remove
  return 1
endif
tag(power,#-1) // dame o 1 skit menej
return 1

// poison

[function f_fire_dragon_efect_poison]
if (src.isdead)||!(src.isplayer)||(src.isgm)
	return 1
endif

if !(<src.restest(i_fire_dragon_efect_poison)>)
	src.newequip(i_fire_dragon_efect_poison)
  if (<argv(0)> > <src.tag(dragon_resist)>)
  	arg(dmg,<eval (<argv(0)>-<src.tag(dragon_resist)>)/10>)
  else
  	arg(dmg,0)
  endif
  lastnew.tag(poison_dmg,<arg(dmg)>)
  lastnew.tag(power,<argv(1)>)
  lastnew.tag(max_power,<argv(1)>)
  lastnew.timer=1
else
	src.findid(i_fire_dragon_efect_poison).tag(power,<argv(1)>)
endif

[itemdef i_fire_dragon_efect_poison]//dela efekt
ID=i_rune_poison_field
TYPE=t_eq_script
name=draci efekt poison

on=@equip
timer=4 //jak rychle bude skytat
cont.sysMessage("Zabiji te draci jed!")
cont.effect(3,i_fx_curse,3,16,0)

on=@timer
timer=4
arg(dmg,<eval (<tag(poison_dmg)>*<tag(power)>)/<tag(max_power)>>)
if (<tag(power)> < 1)||(<arg(dmg)> < 1)||(cont.isdead) //neni skit, likvidovat
  cont.sysMessage("Draci jed vyprchal!")
  remove
  return 1
endif
cont.damage_noResponse(<arg(dmg)>,dam_fire|dam_magic) //dmg
cont.sysMessage("Zabiji te draci jed.")
cont.effect(3,i_fx_curse,3,16,0)

if (cont.isdead) //je mrtvy, zrusime
  remove
  return 1
endif
tag(power,#-1) // dame o 1 skit menej
return 1


// white 

[function f_fire_dragon_efect_black]
if (src.isdead)||!(src.isplayer)||(src.isgm)
	return 1
endif

if !(<src.restest(i_fire_dragon_efect_black)>)
	src.newequip(i_fire_dragon_efect_black)
  if (<argv(0)> > <src.tag(dragon_resist)>)
  	arg(dmg,<eval (<argv(0)>-<src.tag(dragon_resist)>)/10>)
  else
  	arg(dmg,0)
  endif
  lastnew.tag(stam_dmg,<arg(dmg)>)
  lastnew.tag(power,<argv(1)>)
  lastnew.tag(max_power,<argv(1)>)
  lastnew.timer=1
else
	src.findid(i_fire_dragon_efect_black).tag(power,<argv(1)>)
endif

[itemdef i_fire_dragon_efect_black]//dela efekt
ID=i_rune_poison_field
TYPE=t_eq_script
name=draci efekt black

on=@equip
timer=4 //jak rychle bude skytat
cont.sysMessage("Citis, jak te zasah ohnem vycerpava!")
cont.effect(3,i_fx_glow_spike,3,16,0)

on=@timer
timer=4
arg(dmg,<eval (<tag(stam_dmg)>*<tag(power)>)/<tag(max_power)>>)
if (<tag(power)> < 1)||(<arg(dmg)> < 1)||(cont.isdead) //neni skit, likvidovat
  cont.sysMessage("Draci ohen zmizel!")
  remove
  return 1
endif
reduceStamina(<arg(dmg)>)
cont.sysMessage("Citis, jak te zasah ohnem vycerpava!")
cont.effect(3,i_fx_glow_spike,3,16,0)

if (cont.isdead) //je mrtvy, zrusime
  remove
  return 1
endif
tag(power,#-1) // dame o 1 skit menej
return 1

///////////////////////////
/// dragon armor
//

[function dragon_armor_creator]
newequip(i_zamerovatko_dragon_armor_acreate)
lastnew.tag(quest_npc,<args>)

[itemdef i_zamerovatko_dragon_armor_acreate]
id=i_memory
name=zamerovatko na vytvoreni dragon armor
type=t_eq_script

on=@equip
target("Zamer brneni, ktere chces predelat.")

ON=@TARGON_ITEM
if (src.distancefrom(<tag(quest_npc)>) > 6)
  src.sysMessage("Na takovou vzdalenost ti to nepokove.")
  remove
  return 0
endif

if (src.targ.topobj!=<src.uid>)
  src.sysMessage("Vec musis mit u sebe!")
  remove
  return 1
elseif (<src.targ.cont> == <src>)
  src.targ.bounce
endif
if (src.targ.isrealmagicitem)
	src.sysMessage("Predmet nesmi byt magicky.")
	remove
	return 1
endif

if (src.targ.type == t_armor)||(src.targ.type == t_armor_leather)
	if (src.targ.dispid == i_platemail_chest)||(src.targ.dispid == 01416)||(src.targ.dispid == i_armor_female_plate)||(src.targ.dispid == 01c05)
		if (src.f_dragon_armor_scale_check(0,0,2,1,0,0,0))
			src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_hrud>)
		  src.f_dragon_armor_scale_consume(0,0,2,1,0,0,0)
		else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_platemail_leggings)||(src.targ.dispid == 0141a)
	  if (src.f_dragon_armor_scale_check(0,0,0,2,1,0,0))
	  	src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_nohy>)
		  src.f_dragon_armor_scale_consume(0,0,0,2,1,0,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_platemail_arms)||(src.targ.dispid == 01417)
	  if (src.f_dragon_armor_scale_check(0,0,0,0,1,1,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_lokte>)
		  src.f_dragon_armor_scale_consume(0,0,0,0,1,1,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_platemail_gloves)||(src.targ.dispid == 01418)
	  if (src.f_dragon_armor_scale_check(0,1,0,0,0,1,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_rukavice>)
		  src.f_dragon_armor_scale_consume(0,1,0,0,0,1,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_helm_nose)||(src.targ.dispid == 0140F)||(src.targ.dispid == i_helm_closed)||(src.targ.dispid == 01409)||(src.targ.dispid == i_platemail_helm)||(src.targ.dispid == 01419)||(src.targ.dispid == i_bascinet)||(src.targ.dispid == 0140D)
	  if (src.f_dragon_armor_scale_check(1,1,0,0,0,0,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_helma>)
		  src.f_dragon_armor_scale_consume(1,1,0,0,0,0,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_platemail_gorget)
		if (src.f_dragon_armor_scale_check(1,0,0,0,0,0,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_krk>)
		  src.f_dragon_armor_scale_consume(1,0,0,0,0,0,0)
		else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_chainmail_tunic)||(src.targ.dispid == 013C4) //// chain		
		if (src.f_dragon_armor_scale_check(0,0,2,1,0,0,0))
			src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_hrud>)
		  src.f_dragon_armor_scale_consume(0,0,2,1,0,0,0)
		else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_chainmail_leggings)
	  if (src.f_dragon_armor_scale_check(0,0,0,2,1,0,0))
	  	src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_nohy>)
		  src.f_dragon_armor_scale_consume(0,0,0,2,1,0,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_leather_sleeves)||(src.targ.dispid == 013C8)||(src.targ.dispid == 013CD)||(src.targ.dispid == 013CF)
	  if (src.f_dragon_armor_scale_check(0,0,0,0,1,1,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_lokte>)
		  src.f_dragon_armor_scale_consume(0,0,0,0,1,1,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_leather_gloves)||(src.targ.dispid == 013CE)
	  if (src.f_dragon_armor_scale_check(0,1,0,0,0,1,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_rukavice>)
		  src.f_dragon_armor_scale_consume(0,1,0,0,0,1,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_chainmail_coif)||(src.targ.dispid == 013C0)
	  if (src.f_dragon_armor_scale_check(1,1,0,0,0,0,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_helma>)
		  src.f_dragon_armor_scale_consume(1,1,0,0,0,0,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_leather_gorget)
		if (src.f_dragon_armor_scale_check(1,0,0,0,0,0,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_krk>)
		  src.f_dragon_armor_scale_consume(1,0,0,0,0,0,0)
		else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_ringmail_tunic)||(src.targ.dispid == 013ED) //// ring
		if (src.f_dragon_armor_scale_check(0,0,2,1,0,0,0))
			src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_hrud>)
		  src.f_dragon_armor_scale_consume(0,0,2,1,0,0,0)
		else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_ringmail_leggings)||(src.targ.dispid == 013F1)
	  if (src.f_dragon_armor_scale_check(0,0,0,2,1,0,0))
	  	src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_nohy>)
		  src.f_dragon_armor_scale_consume(0,0,0,2,1,0,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_ringmail_sleeves)||(src.targ.dispid == 013EF)
	  if (src.f_dragon_armor_scale_check(0,0,0,0,1,1,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_lokte>)
		  src.f_dragon_armor_scale_consume(0,0,0,0,1,1,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_ringmail_gloves)||(src.targ.dispid == 013F2)
	  if (src.f_dragon_armor_scale_check(0,1,0,0,0,1,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_rukavice>)
		  src.f_dragon_armor_scale_consume(0,1,0,0,0,1,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_helm_open)||(src.targ.dispid == 0140B)
	  if (src.f_dragon_armor_scale_check(1,1,0,0,0,0,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_helma>)
		  src.f_dragon_armor_scale_consume(1,1,0,0,0,0,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_studded_tunic)||(src.targ.dispid == 013E2)||(src.targ.dispid == 01C03)||(src.targ.dispid == i_armor_female_studded) //// studded
		if (src.f_dragon_armor_scale_check(0,0,2,1,0,0,0))
			src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_hrud>)
		  src.f_dragon_armor_scale_consume(0,0,2,1,0,0,0)
		else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_studded_leggings)||(src.targ.dispid == 013E1)
	  if (src.f_dragon_armor_scale_check(0,0,0,2,1,0,0))
	  	src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_nohy>)
		  src.f_dragon_armor_scale_consume(0,0,0,2,1,0,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif	
	elseif (src.targ.dispid == i_studded_sleeves)||(src.targ.dispid == 013DC)
	  if (src.f_dragon_armor_scale_check(0,0,0,0,1,1,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_lokte>)
		  src.f_dragon_armor_scale_consume(0,0,0,0,1,1,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_studded_gloves)||(src.targ.dispid == 013DD)
	  if (src.f_dragon_armor_scale_check(0,1,0,0,0,1,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_rukavice>)
		  src.f_dragon_armor_scale_consume(0,1,0,0,0,1,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_leather_cap)||(src.targ.dispid == 01DBA)
	  if (src.f_dragon_armor_scale_check(1,1,0,0,0,0,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_helma>)
		  src.f_dragon_armor_scale_consume(1,1,0,0,0,0,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_studded_gorget)
		if (src.f_dragon_armor_scale_check(1,0,0,0,0,0,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_krk>)
		  src.f_dragon_armor_scale_consume(1,0,0,0,0,0,0)
		else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_bone_chest)||(src.targ.dispid == 01454) //// bone
		if (src.f_dragon_armor_scale_check(0,0,2,1,0,0,0))
			src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_hrud>)
		  src.f_dragon_armor_scale_consume(0,0,2,1,0,0,0)
		else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_bone_leggings)||(src.targ.dispid == 01457)
	  if (src.f_dragon_armor_scale_check(0,0,0,2,1,0,0))
	  	src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_nohy>)
		  src.f_dragon_armor_scale_consume(0,0,0,2,1,0,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif	
	elseif (src.targ.dispid == i_bone_arms)||(src.targ.dispid == 01453)
	  if (src.f_dragon_armor_skin_check(0,0,0,0,1,1,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_lokte>)
		  src.f_dragon_armor_scale_consume(0,0,0,0,1,1,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_bone_gloves)||(src.targ.dispid == 01455)
	  if (src.f_dragon_armor_scale_check(0,1,0,0,0,1,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_rukavice>)
		  src.f_dragon_armor_scale_consume(0,1,0,0,0,1,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	elseif (src.targ.dispid == i_bone_helmet)||(src.targ.dispid == 01456)
	  if (src.f_dragon_armor_scale_check(1,1,0,0,0,0,0))
		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_helma>)
		  src.f_dragon_armor_scale_consume(1,1,0,0,0,0,0)
	  else
			src.sysMessage("Nemas vse potrebne")
			remove
			return 1
		endif
	endif
//elseif (src.targ.type == t_weapon)||(src.targ.type == t_weapon_sword)||(src.targ.type == t_weapon_fence)||(src.targ.type == t_weapon_mace_smith)||(src.targ.type == t_weapon_bow_run)||(src.targ.type == t_weapon_xbow)||(src.targ.type == t_weapon_mace_staff)
elseif (src.targ.isevent(t_allweapons))
	if (src.f_dragon_armor_scale_check(1,1,1,1,1,1,1))
		src.targ.f_dragon_armor_create_weapon
		src.targ.name Zbran drakobijce
		src.targ.color 09CE
		src.f_dragon_armor_scale_consume(1,1,1,1,1,1,1)
	else
	  src.sysMessage("Nemas vse potrebne")
		remove
		return 1
	endif
else
 src.sysMessage("Zameruj iba zbrane a brneni.")
endif
remove
RETURN 1 

ON=@TARGON_GROUND
src.sysMessage("Tady neni co pokovat.")
remove
RETURN 1 

ON=@TARGON_CHAR
src.sysMessage("Tady neni co pokovat.")
remove
RETURN 1 

[function f_dragon_armor_create_weapon]
if (isbow)
  tag(imi_value_31,20)
elseif (isfencing)||(issword)
  if (typedef.layer==1)
    tag(imi_value_42,20)
  elseif (typedef.layer==2)
    tag(imi_value_40,20)
  endif
elseif (ismace)
  tag(imi_value_41,20)
elseif (isstaff)||(iscrook)
  tag(imi_value_46,20)
  tag(imi_value_25,5)
endif 
tag(imi_value_102,30)
mif_finishitem

[function f_dragon_armor_scale_check] // argv 0 = hneda, argv 1 = zelena, argv 2 = biela, argv 3 = cierna, argv 4 = modra, argv 5 = cervena, argv 6 = zlata
if ((<src.rescount i_dragon_scale_brown> >= <argv(0)>)&&(<src.rescount i_dragon_scale_green> >= <argv(1)>)&&(<src.rescount i_dragon_scale_white> >= <argv(2)>)&&(<src.rescount i_dragon_scale_black> >= <argv(3)>)&&(<src.rescount i_dragon_scale_blue> >= <argv(4)>)&&(<src.rescount i_dragon_scale_red> >= <argv(5)>)&&(<src.rescount i_dragon_scale_gold> >= <argv(6)>)&&(<src.rescount i_gold> >= 50000))
	return 1
else
	return 0
endif

[function f_dragon_armor_scale_consume] // argv 0 = hneda, argv 1 = zelena, argv 2 = biela, argv 3 = cierna, argv 4 = modra, argv 5 = cervena, argv 6 = zlata
if (<argv(0)> > 0)
	src.consume(<argv(0)>,i_dragon_scale_brown)
endif
if (<argv(1)> > 0)
  src.consume(<argv(1)>,i_dragon_scale_green)
endif
if (<argv(2)> > 0)
  src.consume(<argv(2)>,i_dragon_scale_white)
endif
if (<argv(3)> > 0)
  src.consume(<argv(3)>,i_dragon_scale_black)
endif
if (<argv(4)> > 0)
  src.consume(<argv(4)>,i_dragon_scale_blue)
endif
if (<argv(5)> > 0)
  src.consume(<argv(5)>,i_dragon_scale_red)
endif
if (<argv(6)> > 0)
  src.consume(<argv(6)>,i_dragon_scale_gold)
endif
src.consume(50000,i_gold)

/////// supiny

[ITEMDEF i_dragon_scale_brown]
ID=01727
NAME=Hneda draci supina
TYPE=t_normal
WEIGHT=1

on=@create
color=02a // farby treba zmenit

on=@DROPON_GROUND
src.sysMessage("Ups, rozpadla se na prach...")
remove
return 0

on=@userclick
src.sysMessage("Hneda draci supina")
return 1

[ITEMDEF i_dragon_scale_green]
ID=01727
NAME=Zelena draci supina
TYPE=t_normal
WEIGHT=1

on=@create
color=0111 // farby treba zmenit

on=@DROPON_GROUND
src.sysMessage("Ups, rozpadla se na prach...")
remove
return 0

on=@userclick
src.sysMessage("Zelena draci supina")
return 1

[ITEMDEF i_dragon_scale_white]
ID=01727
NAME=Bila draci supina
TYPE=t_normal
WEIGHT=1

on=@create
color=0481 // farby treba zmenit

on=@DROPON_GROUND
src.sysMessage("Ups, rozpadla se na prach...")
remove
return 0

on=@userclick
src.sysMessage("Bila draci supina")
return 1

[ITEMDEF i_dragon_scale_black]
ID=01727
NAME=Cerna draci supina
TYPE=t_normal
WEIGHT=1

on=@create
color=0692 // farby treba zmenit

on=@DROPON_GROUND
src.sysMessage("Ups, rozpadla se na prach...")
remove
return 0

on=@userclick
src.sysMessage("Cerna draci supina")
return 1

[ITEMDEF i_dragon_scale_blue]
ID=01727
NAME=Modra draci supina
TYPE=t_normal
WEIGHT=1

on=@create
color=098f // farby treba zmenit

on=@DROPON_GROUND
src.sysMessage("Ups, rozpadla se na prach...")
remove
return 0

on=@userclick
src.sysMessage("Modra draci supina")
return 1

[ITEMDEF i_dragon_scale_red]
ID=01727
NAME=Ruda draci supina
TYPE=t_normal
WEIGHT=1

on=@create
color=026 // farby treba zmenit

on=@DROPON_GROUND
src.sysMessage("Ups, rozpadla se na prach...")
remove
return 0

on=@userclick
src.sysMessage("Ruda draci supina")
return 1

[ITEMDEF i_dragon_scale_gold]
ID=01727
NAME=Zlata draci supina
TYPE=t_normal
WEIGHT=1

on=@create
color=0986 // farby treba zmenit

on=@DROPON_GROUND
src.sysMessage("Ups, rozpadla se na prach...")
remove
return 0

on=@userclick
src.sysMessage("Zlata draci supina")
return 1

/////////////////////////////////////////////

[function f_dragon_armor_creator]
events +t_dragon_armor
name Draci brneni
color 09CE
tag(dragon_resist,<args>)

[typedef t_dragon_armor]
on=@equip
src.tag(dragon_resist,<src.tag(dragon_resist)>+<tag(dragon_resist)>)
src.sysMessage("Nasadil jsi si cast draci zbroje. Tvuj draci resist je nyni: <src.tag(dragon_resist)>%.")

on=@unequip
src.tag(dragon_resist,#-<tag(dragon_resist)>)
src.sysMessage("Sundal jsi cast draci zbroje. Tvuj draci resist je nyni: <src.tag(dragon_resist)>%.")

////////////////////////////////
// test drak

[CHARDEF c_drake_enzo_test]
DEFNAME=c_drake_enzo_test
ID=c_drake_base
NAME=Testovaci drak
SOUND=snd_MONSTER_DRAGON1
ICON=i_pet_dragon
moverate=5
attack=80,100
ARMOR={50 60}
RESOURCES=50 i_ribs_raw, 8 i_reag_dragon_blood
CAN=MT_WALK|MT_FIRE_IMMUNE|mt_run
FOODTYPE=25 t_meat_raw

TEVENTS=e_monster
TEVENTS=e_character
TEVENTS=e_looter
TEVENTS=e_fire_dragon
TEVENTS=e_fire_dragon_bomb
TEVENTS=e_fire_dragon_aura
TEVENTS=e_q040_dragon_death

CATEGORY=Monsters
SUBSECTION=Dragons and Drakes
DESCRIPTION=Drake Green


ON=@Create
NAME=#NAMES_DRAGON
COLOR=0996

str={1100 1300}
dex={180 240}
int={450 550}
maxhits={1100 1300}
maxstam={180 240}
maxmana=0

tag(q040_dragons_qtag_wanted,16)

tag(dragon_fire_aura_speed,5) // rychlost skitnuti
tag(dragon_fire_aura_power,10) // pocet skitnuti
tag(dragon_fire_aura_dmg,10) // velkost dmg
tag(dragon_fire_aura_delay,5) // prodleva medzi rozhadzovanim aury
tag(dragon_fire_aura_chance,500) // sanca na hodenie - 50%

tag(dragon_fire_chance,500)
tag(dragon_fire_dmg,100)
tag(dragon_fire_type,2)
tag(dragon_fire_delay,10)

tag(dragon_fire_bomb_chance,500)
tag(dragon_fire_bomb_dmg,100)
tag(dragon_fire_bomb_type,2)
tag(dragon_fire_bomb_delay,10)

tag.experience=<eval {40.0 60.0}>
tag(hypnotizable,0)
tag.hypnotizable=<tag.hypnotizable>|<flag_Buff[1]>//int
tag.hypnotizable=<tag.hypnotizable>|<flag_BuffPower[9]>
tag(monstertype,dragon)

tag.resist_fire=1000
tag.resist_sumon=800
tag.resist_poison=950

PARRYING={55.0 95.0}
Resist=90.0
TACTICS={90.0 100.0}
WRESTLING={90.0 100.0}
SpiritSpeak=1650.0



NPC=brain_monster

fame={2000 6000}

KARMA=-3000
ITEMnewbie=i_monster_create

ON=@NPCRestock
ITEM=loot_DRAGON
item=i_gold
////////////////////////////////////////////////////////
////////////////////////////////////////////////////////
////////////////////////////////////////////////////////



[function f_dragon_armor_create_kovar]
newequip(i_zamerovatko_dragon_armor_kovar_acreate)
lastnew.tag(quest_npc,<args>)

[itemdef i_zamerovatko_dragon_armor_kovar_acreate]
id=i_memory
name=zamerovatko na vytvoreni dragon armor
type=t_eq_script

on=@equip
target("Zamer brneni, ktere chces predelat.")

ON=@TARGON_ITEM
if (src.distancefrom(<tag(quest_npc)>) > 6)
  src.sysMessage("Na takovou vzdalenost ti to nepokove.")
  remove
  return 0
endif

if (src.targ.topobj!=<src.uid>)
  src.sysMessage("Vec musis mit u sebe!")
  remove
  return 1
elseif (<src.targ.cont> == <src>)
  src.targ.bounce
endif
//if (src.targ.isrealmagicitem)
//	src.sysMessage("Predmet nesmie byt magicky.")
//	remove
//	return 1
//endif

if (src.targ.type == t_armor)||(src.targ.type == t_armor_leather)
	if (src.targ.dispid == i_platemail_chest)||(src.targ.dispid == 01416)||(src.targ.dispid == i_armor_female_plate)||(src.targ.dispid == 01c05)
		if (<src.qtag(q040_dragons)> > 15)
		  if (src.f_dragon_armor_scale_check(0,0,2,1,0,0,0))
			  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_hrud>)
		    src.f_dragon_armor_scale_consume(0,0,2,1,0,0,0)
		  else
		  	src.sysMessage("Nemas vse potrebne")
		  	remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_platemail_leggings)||(src.targ.dispid == 0141a)
	  if (<src.qtag(q040_dragons)> > 13)
	    if (src.f_dragon_armor_scale_check(0,0,0,2,1,0,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_nohy>)
		    src.f_dragon_armor_scale_consume(0,0,0,2,1,0,0)
	    else
			  src.sysMessage("Nemas vse potrebne")
			  remove
			  return 1
			endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_platemail_arms)||(src.targ.dispid == 01417)
		if (<src.qtag(q040_dragons)> > 11)
	    if (src.f_dragon_armor_scale_check(0,0,0,0,1,1,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_lokte>)
	  	  src.f_dragon_armor_scale_consume(0,0,0,0,1,1,0)
	    else
	  		src.sysMessage("Nemas vse potrebne")
	  		remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_platemail_gloves)||(src.targ.dispid == 01418)
		if (<src.qtag(q040_dragons)> > 9)
  	  if (src.f_dragon_armor_scale_check(0,1,0,0,0,1,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_rukavice>)
  		  src.f_dragon_armor_scale_consume(0,1,0,0,0,1,0)
  	  else
  			src.sysMessage("Nemas vse potrebne")
  			remove
  			return 1
  		endif
  	else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_helm_nose)||(src.targ.dispid == 0140F)||(src.targ.dispid == i_helm_closed)||(src.targ.dispid == 01409)||(src.targ.dispid == i_platemail_helm)||(src.targ.dispid == 01419)||(src.targ.dispid == i_bascinet)||(src.targ.dispid == 0140D)
		if (<src.qtag(q040_dragons)> > 7)
	    if (src.f_dragon_armor_scale_check(1,1,0,0,0,0,0))
		    src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_helma>)
		    src.f_dragon_armor_scale_consume(1,1,0,0,0,0,0)
	    else
		  	src.sysMessage("Nemas vse potrebne")
		  	remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1			
		endif
	elseif (src.targ.dispid == i_platemail_gorget)
		if (<src.qtag(q040_dragons)> > 5)
  		if (src.f_dragon_armor_scale_check(1,0,0,0,0,0,0))
  		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_krk>)
  		  src.f_dragon_armor_scale_consume(1,0,0,0,0,0,0) 
  		else
  			src.sysMessage("Nemas vse potrebne")
  			remove
  			return 1
  		endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1			
		endif
	elseif (src.targ.dispid == i_chainmail_tunic)||(src.targ.dispid == 013C4) //// chain		
		if (<src.qtag(q040_dragons)> > 15)
		  if (src.f_dragon_armor_scale_check(0,0,2,1,0,0,0))
			  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_hrud>)
		    src.f_dragon_armor_scale_consume(0,0,2,1,0,0,0)
		  else
		  	src.sysMessage("Nemas vse potrebne")
		  	remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_chainmail_leggings)
	  if (<src.qtag(q040_dragons)> > 13)
	    if (src.f_dragon_armor_scale_check(0,0,0,2,1,0,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_nohy>)
		    src.f_dragon_armor_scale_consume(0,0,0,2,1,0,0)
	    else
			  src.sysMessage("Nemas vse potrebne")
			  remove
			  return 1
			endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_leather_sleeves)||(src.targ.dispid == 013C8)||(src.targ.dispid == 013CD)||(src.targ.dispid == 013CF)
		if (<src.qtag(q040_dragons)> > 11)
	    if (src.f_dragon_armor_scale_check(0,0,0,0,1,1,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_lokte>)
	  	  src.f_dragon_armor_scale_consume(0,0,0,0,1,1,0)
	    else
	  		src.sysMessage("Nemas vse potrebne")
	  		remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_leather_gloves)||(src.targ.dispid == 013CE)
		if (<src.qtag(q040_dragons)> > 9)
  	  if (src.f_dragon_armor_scale_check(0,1,0,0,0,1,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_rukavice>)
  		  src.f_dragon_armor_scale_consume(0,1,0,0,0,1,0)
  	  else
  			src.sysMessage("Nemas vse potrebne")
  			remove
  			return 1
  		endif
  	else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_chainmail_coif)||(src.targ.dispid == 013C0)
		if (<src.qtag(q040_dragons)> > 7)
	    if (src.f_dragon_armor_scale_check(1,1,0,0,0,0,0))
		    src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_helma>)
		    src.f_dragon_armor_scale_consume(1,1,0,0,0,0,0)
	    else
		  	src.sysMessage("Nemas vse potrebne")
		  	remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1			
		endif
	elseif (src.targ.dispid == i_leather_gorget)
		if (<src.qtag(q040_dragons)> > 5)
  		if (src.f_dragon_armor_scale_check(1,0,0,0,0,0,0))
  		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_krk>)
  		  src.f_dragon_armor_scale_consume(1,0,0,0,0,0,0) 
  		else
  			src.sysMessage("Nemas vse potrebne")
  			remove
  			return 1
  		endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1			
		endif
	elseif (src.targ.dispid == i_ringmail_tunic)||(src.targ.dispid == 013ED) //// ring
		if (<src.qtag(q040_dragons)> > 15)
		  if (src.f_dragon_armor_scale_check(0,0,2,1,0,0,0))
			  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_hrud>)
		    src.f_dragon_armor_scale_consume(0,0,2,1,0,0,0)
		  else
		  	src.sysMessage("Nemas vse potrebne")
		  	remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_ringmail_leggings)||(src.targ.dispid == 013F1)
	  if (<src.qtag(q040_dragons)> > 13)
	    if (src.f_dragon_armor_scale_check(0,0,0,2,1,0,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_nohy>)
		    src.f_dragon_armor_scale_consume(0,0,0,2,1,0,0)
	    else
			  src.sysMessage("Nemas vse potrebne")
			  remove
			  return 1
			endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_ringmail_sleeves)||(src.targ.dispid == 013EF)
		if (<src.qtag(q040_dragons)> > 11)
	    if (src.f_dragon_armor_scale_check(0,0,0,0,1,1,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_lokte>)
	  	  src.f_dragon_armor_scale_consume(0,0,0,0,1,1,0)
	    else
	  		src.sysMessage("Nemas vse potrebne")
	  		remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_ringmail_gloves)||(src.targ.dispid == 013F2)
		if (<src.qtag(q040_dragons)> > 9)
  	  if (src.f_dragon_armor_scale_check(0,1,0,0,0,1,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_rukavice>)
  		  src.f_dragon_armor_scale_consume(0,1,0,0,0,1,0)
  	  else
  			src.sysMessage("Nemas vse potrebne")
  			remove
  			return 1
  		endif
  	else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_helm_open)||(src.targ.dispid == 0140B)
		if (<src.qtag(q040_dragons)> > 7)
	    if (src.f_dragon_armor_scale_check(1,1,0,0,0,0,0))
		    src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_helma>)
		    src.f_dragon_armor_scale_consume(1,1,0,0,0,0,0)
	    else
		  	src.sysMessage("Nemas vse potrebne")
		  	remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1			
		endif
	else
		src.sysMessage("Tohle kovar nesvede predelat.")
		remove
		return 1
	endif
elseif (src.targ.isevent(t_allweapons))
	if ((src.targ.dispid == i_staff_gnarled)||(src.targ.dispid == 013f9)||(src.targ.dispid == i_staff_quarter)||(src.targ.dispid == 0e8a)||(src.targ.dispid == i_staff_black)||(src.targ.dispid == 0df1))
		src.sysMessage("Tohle kovar nesvede predelat.")
		remove
		return 1
	else
		if (<src.qtag(q040_dragons)> > 17)
  		if ((src.f_dragon_armor_scale_check(1,1,1,1,1,1,1))&&(<src.rescount i_gold> >= 200000))
  		  src.targ.f_dragon_armor_create_weapon
  		  src.targ.name Zbran drakobijce
  		  src.targ.color 09CE
  		  src.f_dragon_armor_scale_consume(1,1,1,1,1,1,1)
  		  src.consume(150000,i_gold)
  	  else
  	    src.sysMessage("Nemas vse potrebne")
  		  remove
  		  return 1
  		endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1			
		endif
	endif
else
 src.sysMessage("Zameruj jen zbrane a brneni.")
endif
remove
RETURN 1 

ON=@TARGON_GROUND
src.sysMessage("Tady neni co pokovat.")
remove
RETURN 1 

ON=@TARGON_CHAR
src.sysMessage("Tady neni co pokovat.")
remove
RETURN 1 

//////////////////////////////////////////////////


[function f_dragon_armor_create_dratenik]
newequip(i_zamerovatko_dragon_armor_dratenik_acreate)
lastnew.tag(quest_npc,<args>)

[itemdef i_zamerovatko_dragon_armor_dratenik_acreate]
id=i_memory
name=zamerovatko na vytvoreni dragon armor
type=t_eq_script

on=@equip
target("Zamer brneni, ktere chces predelat.")

ON=@TARGON_ITEM
if (src.distancefrom(<tag(quest_npc)>) > 6)
  src.sysMessage("Na takovou vzdalenost ti to nepokove.")
  remove
  return 0
endif

if (src.targ.topobj!=<src.uid>)
  src.sysMessage("Vec musis mit u sebe!")
  remove
  return 1
elseif (<src.targ.cont> == <src>)
  src.targ.bounce
endif
//if (src.targ.isrealmagicitem)
//	src.sysMessage("Predmet nesmie byt magicky.")
//	remove
//	return 1
//endif

if (src.targ.type == t_armor)||(src.targ.type == t_armor_leather)
  if (src.targ.dispid == i_studded_tunic)||(src.targ.dispid == 013E2)||(src.targ.dispid == 01C03)||(src.targ.dispid == i_armor_female_studded) //// studded
		if (<src.qtag(q040_dragons)> > 15)
		  if (src.f_dragon_armor_scale_check(0,0,2,1,0,0,0))
			  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_hrud>)
		    src.f_dragon_armor_scale_consume(0,0,2,1,0,0,0)
		  else
		  	src.sysMessage("Nemas vse potrebne")
		  	remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti dratenik jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_studded_leggings)||(src.targ.dispid == 013E1)
	  if (<src.qtag(q040_dragons)> > 13)
	    if (src.f_dragon_armor_scale_check(0,0,0,2,1,0,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_nohy>)
		    src.f_dragon_armor_scale_consume(0,0,0,2,1,0,0)
	    else
			  src.sysMessage("Nemas vse potrebne")
			  remove
			  return 1
			endif
		else
		  src.sysMessage("Tohle ti dratenik jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_studded_sleeves)||(src.targ.dispid == 013DC)
		if (<src.qtag(q040_dragons)> > 11)
	    if (src.f_dragon_armor_scale_check(0,0,0,0,1,1,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_lokte>)
	  	  src.f_dragon_armor_scale_consume(0,0,0,0,1,1,0)
	    else
	  		src.sysMessage("Nemas vse potrebne")
	  		remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_studded_gloves)||(src.targ.dispid == 013DD)
		if (<src.qtag(q040_dragons)> > 9)
  	  if (src.f_dragon_armor_scale_check(0,1,0,0,0,1,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_rukavice>)
  		  src.f_dragon_armor_scale_consume(0,1,0,0,0,1,0)
  	  else
  			src.sysMessage("Nemas vse potrebne")
  			remove
  			return 1
  		endif
  	else
		  src.sysMessage("Tohle ti dratenik jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_leather_cap)||(src.targ.dispid == 01DBA)
		if (<src.qtag(q040_dragons)> > 7)
	    if (src.f_dragon_armor_scale_check(1,1,0,0,0,0,0))
		    src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_helma>)
		    src.f_dragon_armor_scale_consume(1,1,0,0,0,0,0)
	    else
		  	src.sysMessage("Nemas vse potrebne")
		  	remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti dratenik jeste predelat nemuze.")
		  remove
		  return 1			
		endif
	elseif (src.targ.dispid == i_studded_gorget)
		if (<src.qtag(q040_dragons)> > 5)
  		if (src.f_dragon_armor_scale_check(1,0,0,0,0,0,0))
  		  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_krk>)
  		  src.f_dragon_armor_scale_consume(1,0,0,0,0,0,0) 
  		else
  			src.sysMessage("Nemas vse potrebne")
  			remove
  			return 1
  		endif
		else
		  src.sysMessage("Tohle ti dratenik jeste predelat nemuze.")
		  remove
		  return 1			
		endif
	elseif (src.targ.dispid == i_bone_chest)||(src.targ.dispid == 01454) //// bone
		if (<src.qtag(q040_dragons)> > 15)
		  if (src.f_dragon_armor_scale_check(0,0,2,1,0,0,0))
			  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_hrud>)
		    src.f_dragon_armor_scale_consume(0,0,2,1,0,0,0)
		  else
		  	src.sysMessage("Nemas vse potrebne")
		  	remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti dratenik jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_bone_leggings)||(src.targ.dispid == 01457)
	  if (<src.qtag(q040_dragons)> > 13)
	    if (src.f_dragon_armor_scale_check(0,0,0,2,1,0,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_nohy>)
		    src.f_dragon_armor_scale_consume(0,0,0,2,1,0,0)
	    else
			  src.sysMessage("Nemas vse potrebne")
			  remove
			  return 1
			endif
		else
		  src.sysMessage("Tohle ti dratenik jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_bone_arms)||(src.targ.dispid == 01453)
		if (<src.qtag(q040_dragons)> > 11)
	    if (src.f_dragon_armor_scale_check(0,0,0,0,1,1,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_lokte>)
	  	  src.f_dragon_armor_scale_consume(0,0,0,0,1,1,0)
	    else
	  		src.sysMessage("Nemas vse potrebne")
	  		remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti kovar jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_bone_gloves)||(src.targ.dispid == 01455)
		if (<src.qtag(q040_dragons)> > 9)
  	  if (src.f_dragon_armor_scale_check(0,1,0,0,0,1,0))
	  	  src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_rukavice>)
  		  src.f_dragon_armor_scale_consume(0,1,0,0,0,1,0)
  	  else
  			src.sysMessage("Nemas vse potrebne")
  			remove
  			return 1
  		endif
  	else
		  src.sysMessage("Tohle ti dratenik jeste predelat nemuze.")
		  remove
		  return 1	
		endif
	elseif (src.targ.dispid == i_bone_helmet)||(src.targ.dispid == 01456)
		if (<src.qtag(q040_dragons)> > 7)
	    if (src.f_dragon_armor_scale_check(1,1,0,0,0,0,0))
		    src.targ.f_dragon_armor_creator(<nastaveni_dragon_resist_helma>)
		    src.f_dragon_armor_scale_consume(1,1,0,0,0,0,0)
	    else
		  	src.sysMessage("Nemas vse potrebne")
		  	remove
		  	return 1
		  endif
		else
		  src.sysMessage("Tohle ti dratenik jeste predelat nemuze.")
		  remove
		  return 1			
		endif
	else
		src.sysMessage("Tohle dratenik nesvede predelat.")
		remove
		return 1
	endif
elseif (src.targ.isevent(t_allweapons))
	if ((src.targ.dispid == i_staff_gnarled)||(src.targ.dispid == 013f9)||(src.targ.dispid == i_staff_quarter)||(src.targ.dispid == 0e8a)||(src.targ.dispid == i_staff_black)||(src.targ.dispid == 0df1))
 		if (<src.qtag(q040_dragons)> > 17)
  		if ((src.f_dragon_armor_scale_check(1,1,1,1,1,1,1))&&(<src.rescount i_gold> >= 200000))
  		  src.targ.f_dragon_armor_create_weapon
  		  src.targ.name Zbran drakobijce
  		  src.targ.color 09CE
  		  src.f_dragon_armor_scale_consume(1,1,1,1,1,1,1)
  		  src.consume(150000,i_gold)
  	  else
  	    src.sysMessage("Nemas vse potrebne")
  		  remove
  		  return 1
  		endif
		else
		  src.sysMessage("Tohle ti dratenik jeste predelat nemuze.")
		  remove
		  return 1			
		endif
	else
		src.sysMessage("Tohle dratenik nesvede predelat.")
		remove
		return 1
	endif
else
 src.sysMessage("Zameruj iba zbrane a brneni.")
endif
remove
RETURN 1 

ON=@TARGON_GROUND
src.sysMessage("Tady neni co pokovat.")
remove
RETURN 1 

ON=@TARGON_CHAR
src.sysMessage("Tady neni co pokovat.")
remove
RETURN 1 

///////////////////////////////
//// eventy pre bahnaka
//

///// bahenna aura

[events e_bahenny_drak_aura]
on=@beforegetswing
on=@aftergetswing
bahenny_drak_aura

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
bahenny_drak_aura


[function bahenny_drak_aura]
if (chance(<tag(bahenny_drak_aura_chance)>,3)) // chance in promiles
	if !(tag(nextbahennydrakaura))
		tag(nextbahennydrakaura,0)
	endif
  if (<eval tag(nextbahennydrakaura)> < <serv.time>)
    tag(nextbahennydrakaura,<serv.time>+(<tag(bahenny_drak_aura_delay)>*10))
    //emote("pusta draciu auru") // to treba zmenit
    //sector.allchars(f_fire_dragon_aura_create(<tag(dragon_fire_aura_speed)>,<tag(dragon_fire_aura_power)>,<tag(dragon_fire_aura_dmg)>))
    newitemsafe(i_bahenny_drak_aura_creator)
    lastnew.p=<src.p>
    lastnew.z=-100
    lastnew.tag(bahenny_drak_aura_speed,<tag(bahenny_drak_aura_speed)>)
    lastnew.tag(bahenny_drak_aura_power,<tag(bahenny_drak_aura_power)>)
    lastnew.tag(bahenny_drak_aura_dmg,<tag(bahenny_drak_aura_dmg)>)
    lastnew.timerd=1
  endif
endif

[itemdef i_bahenny_drak_aura_creator]
id=i_memory
type=t_src_changer
name=bahenny drak aura creator

on=@create
attr=010

on=@timer
sector.allchars(f_bahenny_drak_aura_create(<tag(bahenny_drak_aura_speed)>,<tag(bahenny_drak_aura_power)>,<tag(bahenny_drak_aura_dmg)>,<mapplane>))
remove 
return 1


//argv(0) - speed
//argv(1) - power
//argv(2) - dmg
[function f_bahenny_drak_aura_create]
if (isdead)||!(isplayer)||(isgm)
	return 1
endif

if !(<mapplane> == <argv(3)>)
	return 1
endif

if !(<restest(i_bahenny_drak_aura)>)
	newequip(i_bahenny_drak_aura)
  lastnew.tag(bahenny_drak_aura_speed,<argv(0)>)
  lastnew.tag(bahenny_drak_aura_power,<argv(1)>)
  lastnew.tag(bahenny_drak_aura_dmg,<argv(2)>)
  lastnew.tag(max_power,<argv(1)>)
  lastnew.timer=1
else
  findid(i_bahenny_drak_aura).tag(bahenny_drak_aura_power,<argv(1)>)
endif

[itemdef i_bahenny_drak_aura]//dela efekt
ID=i_rune_poison_field
TYPE=t_eq_script
name=draci aura

on=@equip
timer=10//jak rychle bude skytat
cont.sysMessage("<cont.sex("Byl jsi zasazen draci aurou","Byla jsi zasazena draci aurou")>!")
cont.effect(3,i_fx_explode_ball,3,16,0)


on=@timer
timer=<eval tag(bahenny_drak_aura_speed)>
arg(dmg,<eval ((<tag(bahenny_drak_aura_dmg)>*<tag(bahenny_drak_aura_power)>)/<tag(max_power)>)>)
if (<tag(bahenny_drak_aura_power)> < 1)||(<arg(dmg)> < 1)||(cont.isdead) //neni skit, likvidovat
  cont.sysMessage("Draci aura byla tak slaba, ze zmizla!")
  remove
  return 1
endif
cont.damage_noResponse(<arg(dmg)>,dam_fire|dam_magic)

cont.sysMessage("Poranila te draci aura")
cont.effect(3,i_fx_explode_ball,3,16,0)

if (cont.isdead) //je mrtvy, zrusime
  remove
  return 1
endif
tag(bahenny_drak_aura_power,#-1) // dame o 1 skit menej
return 1

//////// krev bahnaka


[events e_bahenny_drak_krev]
on=@beforegetswing
on=@aftergetswing
bahenny_drak_krev

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
bahenny_drak_krev


[function bahenny_drak_krev]
arg(gethp,<eval (<hits>*100)/<maxhits>)>)	
if !(tag(vybuchol))
	tag(vybuchol,0)
endif
if (((<arg(gethp)> < 85)&&(<arg(gethp)> > 75))&&(<tag(vybuchol)> == 0))
	tag(vybuchol,#+1)
	f_bahenny_drak_krev_create(80,<src>)
elseif (((<arg(gethp)> < 65)&&(<arg(gethp)> > 55))&&(<tag(vybuchol)> == 1))
	tag(vybuchol,#+1)
	f_bahenny_drak_krev_create(80,<src>)
elseif (((<arg(gethp)> < 45)&&(<arg(gethp)> > 35))&&(<tag(vybuchol)> == 2))
	tag(vybuchol,#+1)
	f_bahenny_drak_krev_create(80,<src>)
elseif (((<arg(gethp)> < 25)&&(<arg(gethp)> > 15))&&(<tag(vybuchol)> == 3))
	tag(vybuchol,#+1)
	f_bahenny_drak_krev_create(80,<src>)
elseif ((<arg(gethp)> < 5)&&(<tag(vybuchol)> == 4))
	tag(vybuchol,#+1)
	f_bahenny_drak_krev_create(80,<src>)
endif

[function f_bahenny_drak_krev_create]
arg(i,0)
while (arg(i) < 3)
  f_dragon_blood_place(<randombetween(-3,3)>,<randombetween(-3,3)>,<argv(0)>,<argv(1)>)
  arg(i,#+1)
endwhile

[function f_dragon_blood_place] //x,y,z,mapplane, <optional> damage
newitem(i_bahenny_drak_krev)
lastnew.p=<p>
lastnew.move=<argv(0)>,<argv(1)>
lastnew.nudgeup(1)
lastnew.tag(creator,<argv(3)>)
lastnew.update
lastnew.tag(damage,<argv(2)>)

[itemdef i_bahenny_drak_krev] 
ID=i_blood
TYPE=t_normal
name=draci krev

//arg0 - source NPC
//arg1 - damage flags
//arg2 - damage lower range
//arg3 - damage higher range
//lastnew.tag.damage=<tag(roundattack_damage)>

on=@create
timer=1
attr=010
color=0296
tag(round,0)
tag(timestep,0)
//effect(2,02ED0,0,32)
//sector.allchars(f_npc_rounddamage(<uid>,<hval dam_physical>,<tag.damage>))

on=@step
if (src.isgm)
	return 1
endif
if(<serv.time> > <tag(timestep)>)
  tag(timestep,<serv.time>+100)
  f_fire_dragon_blood_poison(40,8)
  src.damage_noResponse(<tag.damage>,dam_fire|dam_magic)
  return 1
else
	return 1
endif

on=@timer
if (<tag(round)> == 0)
	timer 1800
	tag(round,1)
  effect(2,02ED0,0,32)
	sector.allchars(f_blood_rounddamage(<uid>,<hval dam_physical>,<tag.damage>,<mapplane>))
else
  remove
endif
return 1

// poison z krve

[function f_fire_dragon_blood_poison]
if (src.isdead)||!(src.isplayer)||(src.isgm)
	return 1
endif

if !(<src.restest(i_fire_dragon_blood_poison)>)
	src.newequip(i_fire_dragon_blood_poison)
  if (<argv(0)> > <src.tag(dragon_resist)>)
  	arg(dmg,<argv(0)>)
  else
  	arg(dmg,0)
  endif
  lastnew.tag(poison_dmg,<arg(dmg)>)
  lastnew.tag(power,<argv(1)>)
  lastnew.tag(max_power,<argv(1)>)
  lastnew.timer=1
else
  src.findid(i_fire_dragon_blood_poison).tag(power,<argv(1)>)
  src.sysMessage("Znova jsi se otravil!")
endif

[itemdef i_fire_dragon_blood_poison]//dela efekt
ID=i_rune_poison_field
TYPE=t_eq_script
name=draci krev poison

on=@equip
timer=4 //jak rychle bude skytat
cont.sysMessage("Zabiji te jed z draci krve!")
cont.effect(3,i_fx_curse,3,16,0)

on=@timer
timer=4
arg(dmg,<eval (<tag(poison_dmg)>*<tag(power)>)/<tag(max_power)>>)
if (<tag(power)> < 1)||(<arg(dmg)> < 1)||(cont.isdead) //neni skit, likvidovat
  cont.sysMessage("Jed z draci krve vyprchal!")
  remove
  return 1
endif
cont.damage_noResponse(<arg(dmg)>,dam_fire|dam_magic) //dmg
cont.sysMessage("Zabiji te jed z draci krve!")
cont.effect(3,i_fx_curse,3,16,0)
if (cont.isdead) //je mrtvy, zrusime
  remove
  return 1
endif
tag(power,#-1) // dame o 1 skit menej
return 1


[function f_blood_rounddamage]
if (isgm)
  return 1
endif
if (isdead)
	return 1
endif
if !(<mapplane> == <argv(3)>)
	return 1
endif
if (<distancefrom(<argv(0)>)>==1) // && ((isplayer)||(ispet))
  if !(<uid> == <argv(0)>).
    arg(my_dmg,<argv(2)>)
    if (npc) && !(strcmpi(<act>,<src>))
      damage(<eval <my_dmg>*6>,<argv(1)>,<argv(0)>)
    elseif (ispet)
      damage(<eval <my_dmg>*10>,<argv(1)>,<argv(0)>)
    elseif (isplayer)
      damage(<arg(my_dmg)>,<argv(1)>,<argv(0)>)
    endif
  endif
endif

/////////////////////////////////
// event pre hracov v pevnosti

[events e_dragons_fortress]
on=@Created
on=@DrinkingPotion
on=@afterswing
if (act.isplayer)
 var(ubrano,0)
 return 1
endif
on=@beforedoeffect
if (act.isplayer)
 if (uid==<act>)
 else
  var(spellpower,0)
  return 1
 endif
endif

on=@beforeGetSwing
on=@aftergetswing
on=@beforegeteffect

on=@skillstart
if ((action==skill_snooping)||(action==skill_stealing)||(action==01C))
	reveal
	newitemsafe(i_dragons_fortress_thief)
  lastnew.p=<src.p>
  lastnew.z=-100
  lastnew.tag(thief,<src>)
  lastnew.timerd=1
endif

[itemdef i_dragons_fortress_thief]
id=i_memory
type=t_src_changer
name=dragon fortress

on=@create
attr=010

on=@timer
sector.allchars(f_dragon_fortress_kill_thief(<tag(thief)>))
remove 
return 1

[function f_dragon_fortress_kill_thief]
if ((ischar)&&(<tag(drakobijec)> == 1))
	attack(<args>)
	say("Zlodeje tady nechcem! Chcipni!")
endif


[itemdef i_drak_krev] 
ID=i_blood
TYPE=t_normal
name=draci krev

on=@create
color=0296
tag(timestep,0)
tag(damage,60)

on=@step
if (src.isGM)
  return 1
endif
if(<serv.time> > <tag(timestep)>)
  src.damage_noResponse(<tag.damage>,dam_fire|dam_magic)
  tag(timestep,<serv.time>+100)
endif
return 1

///////////////////////////////////////////
//// e_fire_dragon_round

[events e_fire_dragon_round]
on=@beforegetswing
on=@aftergetswing
fire_dragon_round

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
fire_dragon_round

[function fire_dragon_round]
if (chance(<tag(fire_dragon_round_chance)>,3)) // chance in promiles
	if !(tag(nextdragonround))
		tag(nextdragonround,0)
	endif
  if (<eval tag(nextdragonround)> < <serv.time>)
    tag(nextdragonround,<serv.time>+(<tag(fire_dragon_round_delay)>*10))
    emote(" se zhluboka nadychuje") // to treba zmenit
    newitemsafe(i_fire_dragon_round_creator)
    lastnew.p=<src.p>
    lastnew.tag(fire_dragon_round_turns,<tag(fire_dragon_round_turns)>)
    lastnew.tag(fire_dragon_round_dmg,<tag(fire_dragon_round_dmg)>)
    lastnew.tag(fire_dragon_round_type,<tag(fire_dragon_round_type)>)
    lastnew.tag(dragon,<uid>)
    lastnew.timer=2
  endif
endif

[itemdef i_fire_dragon_round_creator]
id=i_memory
type=t_src_changer
name=dragon roundattack creator

on=@create
attr=010
tag(rounds,0)

on=@timer
if (<tag(rounds)> == 0)
	tag(dragon).flag_immobile=1
elseif (<tag(rounds)> == <eval <tag(fire_dragon_round_turns)>*9>)
	tag(dragon).flag_immobile=0
	remove
	return 1
endif
tag(dragon).flip
tag(dragon).f_fire_dragon(<tag(fire_dragon_round_dmg)>,<tag(fire_dragon_round_type)>)
tag(rounds,#+1)
timer 1
return 1

//////////////////////////////
/// e_fire_dragon_area
//

[events e_fire_dragon_area]
on=@beforegetswing
on=@aftergetswing
f_fire_dragon_area

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
f_fire_dragon_area

[function f_fire_dragon_area] // range, dmg, type
if (chance(<tag(dragon_fire_area_chance)>,3)) // chance in promiles
	if !(tag(nextdragonarea))
		tag(nextdragonarea,0)
	endif
  if (<eval tag(nextdragonarea)> < <serv.time>)
    tag(nextdragonarea,<serv.time>+(<tag(dragon_fire_area_delay)>*10))
    emote("se zhluboka nadychuje") // to treba zmenit
    newequip=i_fire_dragon_area_maker
		lastnew.tag.src=<src>
		lastnew.tag.currentRange=1
		lastnew.tag(range,<tag(dragon_fire_area_range)>)
		lastnew.tag(damage,<tag(dragon_fire_area_dmg)>)
		lastnew.tag(fire_type,<tag(dragon_fire_area_type)>)
	endif
endif


[itemdef i_fire_dragon_area_maker]
NAME=i_fire_dragon_area_maker
id=i_memory
TYPE=T_eq_SCRIPT 

on=@create
attr=010
timerd=5

on=@equip
topobj.flag_immobile=1
timer=1

on=@timer
if (<tag.currentRange><<tag.range>)
  finduid(<tag.src>).f_fire_dragon_area_create(<tag(currentRange)>,<tag(damage)>,<tag(fire_type)>)
  tag(currentRange,#+1)
  timerd=5
else
	topobj.flag_immobile=0
	remove
endif
return 1

[function f_fire_dragon_area_get_type]
if (<args> == 1)
	return(i_dragon_hit_fire_strong)
elseif (<args> == 2)
  return(i_dragon_hit_cold_strong)
elseif (<args> == 3)
  return(i_dragon_hit_poison_strong)
elseif (<args> == 4)
  return(i_dragon_hit_black_strong)
elseif (<args> == 5)
  return(i_dragon_hit_white_strong)
endif

  	
[function f_fire_dragon_area_create]//argv(0)=currentRange, argv(1)=damage, argv(2) = typ
arg(size,<argv(0)>)
arg(fire,<f_fire_dragon_area_get_type(<argv(2)>)>)
if (<size>==1)
  arg(size,2)
endif
//VYCHODna cast
//f_dragon_fire_area_create_one(<argv(0)>,0,<src>,<argv(1)>)
src.newitem=<arg(fire)>
lastnew.p=<f_get_changed_position(<argv(0)>,0)>
lastnew.tag.src=<src>//kto to vytvoril
lastnew.tag(dmg,<argv(1)>)//damage
lastnew.tag(resist_working,0)
lastnew.timer=1
arg(i,1)
while (<arg(i)> < <size>)
  src.newitem=<arg(fire)>
  lastnew.p=<f_get_changed_position(<argv(0)>,<i>)>
  lastnew.tag.src=<src>//kto to vytvoril
  lastnew.tag(dmg,<argv(1)>)//damage
  lastnew.tag(resist_working,0)
  lastnew.timer=1
  src.newitem=<arg(fire)>
  lastnew.p=<f_get_changed_position(<argv(0)>,-<i>)>
  lastnew.tag.src=<src>//kto to vytvoril
  lastnew.tag(dmg,<argv(1)>)//damage
  lastnew.tag(resist_working,0)
  lastnew.timer=1
  arg(i,#+1)
endwhile
//ZAPADna cast
src.newitem=<arg(fire)>
lastnew.p=<f_get_changed_position(-<argv(0)>,0)>
lastnew.tag.src=<src>//kto to vytvoril
lastnew.tag(dmg,<argv(1)>)//damage
lastnew.tag(resist_working,0)
lastnew.timer=1
arg(i,1)
while (<arg(i)> < <size>)
  src.newitem=<arg(fire)>
  lastnew.p=<f_get_changed_position(-<argv(0)>,<i>)>
  lastnew.tag.src=<src>//kto to vytvoril
  lastnew.tag(dmg,<argv(1)>)//damage
  lastnew.tag(resist_working,0)
  lastnew.timer=1
  src.newitem=<arg(fire)>
  lastnew.p=<f_get_changed_position(-<argv(0)>,-<i>)>
  lastnew.tag.src=<src>//kto to vytvoril
  lastnew.tag(dmg,<argv(1)>)//damage
  lastnew.tag(resist_working,0)
  lastnew.timer=1
  arg(i,#+1)
endwhile
//SEVERna cast
src.newitem=<arg(fire)>
lastnew.p=<f_get_changed_position(0,<argv(0)>)>
lastnew.tag.src=<src>//kto to vytvoril
lastnew.tag(dmg,<argv(1)>)//damage
lastnew.tag(resist_working,0)
lastnew.timer=1
arg(i,1)
while (<arg(i)> < <size>)
  src.newitem=<arg(fire)>
  lastnew.p=<f_get_changed_position(<i>,<argv(0)>)>
  lastnew.tag.src=<src>//kto to vytvoril
  lastnew.tag(dmg,<argv(1)>)//damage
  lastnew.tag(resist_working,0)
lastnew.timer=1
  src.newitem=<arg(fire)>
  lastnew.p=<f_get_changed_position(-<i>,<argv(0)>)>
  lastnew.tag.src=<src>//kto to vytvoril
  lastnew.tag(dmg,<argv(1)>)//damage
  lastnew.tag(resist_working,0)
lastnew.timer=1
  arg(i,#+1)
endwhile
//JUZna cast
src.newitem=<arg(fire)>
lastnew.p=<f_get_changed_position(0,-<argv(0)>)>
lastnew.tag.src=<src>//kto to vytvoril
lastnew.tag(dmg,<argv(1)>)//damage
lastnew.tag(resist_working,0)
lastnew.timer=1
arg(i,1)
while (<arg(i)> < <size>)
  src.newitem=<arg(fire)>
  lastnew.p=<f_get_changed_position(<i>,-<argv(0)>)>
  lastnew.tag.src=<src>//kto to vytvoril
  lastnew.tag(dmg,<argv(1)>)//damage
  lastnew.tag(resist_working,0)
lastnew.timer=1
  src.newitem=<arg(fire)>
  lastnew.p=<f_get_changed_position(-<i>,-<argv(0)>)>
  lastnew.tag.src=<src>//kto to vytvoril
  lastnew.tag(dmg,<argv(1)>)//damage
  lastnew.tag(resist_working,0)
lastnew.timer=1
  arg(i,#+1)
endwhile

////////////////////////////////////////
////////// regenerace draka

[events e_dragon_regeneration]
on=@npcseenewplayer
if !(findid(i_dragon_regenerator))
  newequip(i_dragon_regenerator)
  lastnew.tag(power,<tag(regeneration_hp)>)
  lastnew.tag(speed,<tag(regeneration_speed)>)  
endif
return 0

on=@beforegetswing
on=@aftergetswing
if !(findid(i_dragon_regenerator))
  newequip(i_dragon_regenerator)
  lastnew.tag(power,<tag(regeneration_hp)>)
  lastnew.tag(speed,<tag(regeneration_speed)>)  
endif
return 0

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
if !(findid(i_dragon_regenerator))
  newequip(i_dragon_regenerator)
  lastnew.tag(power,<tag(regeneration_hp)>)
  lastnew.tag(speed,<tag(regeneration_speed)>)  
endif
return 0
[itemdef i_dragon_regenerator]
id=i_memory
type=t_eq_script
name=regenerator

on=@create
timer=5

on=@timer
if (<topobj.hits> < <topobj.maxhits>)
	if (<eval <topobj.hits>+<tag(power)>> < <topobj.maxhits>)
		topobj.hits = <eval <topobj.hits>+<tag(power)>>
  else
  	topobj.hits = <topobj.maxhits>
  endif
  topobj.emote("is regenerating.")
else
  remove
	return 1
endif	
timer=<tag(speed)>
return 1

////////////////////////////////////////
////////// golden dragon - changer

[events e_golden_dragon]
on=@beforegetswing
on=@aftergetswing
f_golden_dragon

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
f_golden_dragon

[function f_golden_dragon] // range, dmg, type
if (chance(<tag(golden_dragon_chance)>,3)) // chance in promiles
	if !(tag(nextgolden_dragon))
		tag(nextgolden_dragon,0)
	endif
  if (<eval tag(nextgolden_dragon)> < <serv.time>)
    tag(nextgolden_dragon,<serv.time>+(<tag(golden_dragon_delay)>*10))
    emote("is changing!") // to treba zmenit + dat funkciu naku
    arg(rand,<eval <rand(5)>+1>)
    tag(dragon_fire_type,<arg(rand)>)
    tag(dragon_fire_bomb_type,<arg(rand)>)
	endif
endif

////////////////////////////////////////
////// dragons info dialog


[function dragons_info]
if (src.isgm)
  dialog(d_dragons_info)
else
	src.sysMessage("Tato funkcia nieje pre teba")
endif

[dialog d_dragons_info]
arg(textcolor,52)
argo.SetLocation=205,150

argo.tag(sirka,290)
argo.tag(vyska,432)

argo.dialog_prvni
argo.dialog_pozadi(<argo.tag(nexty)>,1)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_pozadi(<argo.tag(nexty)>,1,163)
argo.dialog_zpruhledni

argo.texta(<argo.dialog_textpos(0,0)>,42,"Dragons quest info")
argo.texta(<argo.dialog_textpos(1,0)>,<d_def_readcolor>,"Precitali svitok: ")
argo.texta(<argo.dialog_textpos(1,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_1)>")
argo.texta(<argo.dialog_textpos(2,0)>,<d_def_readcolor>,"Povedali meno: ")
argo.texta(<argo.dialog_textpos(2,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_2)>")
argo.texta(<argo.dialog_textpos(3,0)>,<d_def_readcolor>,"Priniesli hlavu: ")
argo.texta(<argo.dialog_textpos(3,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_3)>")
argo.texta(<argo.dialog_textpos(4,0)>,<d_def_readcolor>,"Priniesli bahnaka")
argo.texta(<argo.dialog_textpos(4,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_4)>")
argo.texta(<argo.dialog_textpos(5,0)>,<d_def_readcolor>,"Zabili hnedeho: ")
argo.texta(<argo.dialog_textpos(5,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_6)>")
argo.texta(<argo.dialog_textpos(6,0)>,<d_def_readcolor>,"Zabili zeleneho: ")
argo.texta(<argo.dialog_textpos(6,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_8)>")
argo.texta(<argo.dialog_textpos(7,0)>,<d_def_readcolor>,"Zabili ohniveho: ")
argo.texta(<argo.dialog_textpos(7,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_10)>")
argo.texta(<argo.dialog_textpos(8,0)>,<d_def_readcolor>,"Zabili ladoveho: ")
argo.texta(<argo.dialog_textpos(8,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_12)>")
argo.texta(<argo.dialog_textpos(9,0)>,<d_def_readcolor>,"Zabili cierneho: ")
argo.texta(<argo.dialog_textpos(9,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_14)>")
argo.texta(<argo.dialog_textpos(10,0)>,<d_def_readcolor>,"Zabili bieleho: ")
argo.texta(<argo.dialog_textpos(10,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_16)>")
argo.texta(<argo.dialog_textpos(11,0)>,<d_def_readcolor>,"Zabili zlateho: ")
argo.texta(<argo.dialog_textpos(11,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_18)>")
argo.texta(<argo.dialog_textpos(12,0)>,<d_def_readcolor>,"Zabili zapomenuteho: ")
argo.texta(<argo.dialog_textpos(12,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_20)>")
argo.texta(<argo.dialog_textpos(13,0)>,<d_def_readcolor>,"Priniesli hlavu PS: ")
argo.texta(<argo.dialog_textpos(13,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_kovar)>")
argo.texta(<argo.dialog_textpos(14,0)>,<d_def_readcolor>,"Splnili alchymistu: ")
argo.texta(<argo.dialog_textpos(14,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_alch)>")
argo.texta(<argo.dialog_textpos(15,0)>,<d_def_readcolor>,"Dali zlatu supinu: ")
argo.texta(<argo.dialog_textpos(15,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_scale)>")
argo.texta(<argo.dialog_textpos(16,0)>,<d_def_readcolor>,"Odmietli Doormana: ")
argo.texta(<argo.dialog_textpos(16,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_50)>")
argo.texta(<argo.dialog_textpos(17,0)>,<d_def_readcolor>,"Dali doormanovi ingy: ")
argo.texta(<argo.dialog_textpos(17,1)>,<d_def_writecolor>,"<finduid(#0402D472F).tag(dragons_ingots)>")

// dragon poison event

[events e_dragon_poison]
on=@death
if (<src.restest(i_fire_dragon_aura)>)
	src.findid(i_fire_dragon_aura).remove
endif
if (<src.restest(i_fire_dragon_efect_fire)>)
	src.findid(i_fire_dragon_efect_fire).remove
endif
if (<src.restest(i_fire_dragon_efect_cold)>)
	src.findid(i_fire_dragon_efect_cold).remove
endif
if (<src.restest(i_fire_dragon_efect_white)>)
	src.findid(i_fire_dragon_efect_white).remove
endif
if (<src.restest(i_fire_dragon_efect_poison)>)
	src.findid(i_fire_dragon_efect_poison).remove
endif
if (<src.restest(i_fire_dragon_efect_black)>)
	src.findid(i_fire_dragon_efect_black).remove
endif
if (<src.restest(i_bahenny_drak_aura)>)
	src.findid(i_bahenny_drak_aura).remove
endif
if (<src.restest(i_fire_dragon_blood_poison)>)
	src.findid(i_fire_dragon_blood_poison).remove
endif

//////////////////////////////////////////////////
////////// npc iduce k drakovi
//////////////////////////////////////////////////


[events e_dragon_npc]
on=@beforegetswing
on=@aftergetswing
f_dragon_npc

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
f_dragon_npc

[function f_dragon_npc] 
if (chance(<tag(dragon_npc_chance)>,3)) // chance in promiles
	if !(tag(nextDragonNpc))
		tag(nextDragonNpc,0)
	endif
  if (<eval tag(nextDragonNpc)> < <serv.time>)
    tag(nextDragonNpc,<serv.time>+(<tag(dragon_npc_delay)>*10))
    say("Aaaaaaarg!!!")
    f_dragon_npc_create_npc
	endif
endif

[function f_dragon_npc_create_npc]
arg(spawn,<memoryfindtype(Memory_ISpawned).link>)
arg(spawn).tag(spawn_npc).tag(dragon_spawn,<arg(spawn)>)
arg(spawn).tag(spawn_npc).tag(dragon,<uid>)
arg(spawn).tag(spawn_npc).amount = 1
arg(spawn).tag(spawn_npc).timer = 1


[events e_dragon_npc_healer]
on=@beforegetswing
on=@aftergetswing
if (0<tag(walker)> == 1)
  action 06D
endif

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
if (0<tag(walker)> == 1)
  action 06D
endif

on=@STEP
if !(tag(walker))
	home = <memoryfindtype(Memory_ISpawned).link.tag(dragon).p>
	tag(walker,1)
	memoryfindtype(Memory_ISpawned).link.amount = 0
endif
if (<tag(walker)> == 1)
	if (<distancefrom(<memoryfindtype(Memory_ISpawned).link.tag(dragon)>)> < 2)
		say("Povstan!!!")
		memoryfindtype(Memory_ISpawned).link.tag(dragon).emote("byl vylecen stoupencovou zivotni silou!")
		f_dragon_npc_healing(<memoryfindtype(Memory_ISpawned).link.tag(dragon)>,<memoryfindtype(Memory_ISpawned).link.tag(dragon).tag(dragon_npc_hp)>)
		tag(walker,2)
		hits = 0
	else
		home = <memoryfindtype(Memory_ISpawned).link.tag(dragon).p>
		action 06D
	endif
endif

[function f_dragon_npc_healing]
arg(drak,<argv(0)>)
arg(hpToHeal,<argv(1)>)
if (<arg(drak).maxhits> > 30000)
	if (<eval <arg(drak).hits>+<arg(hpToHeal)>> > <arg(drak).maxhits>)
		arg(drak).hits = <arg(drak).maxhits>
	else
		arg(drak).hits = <eval <arg(drak).hits>+<arg(hpToHeal)>>
	endif
else
	if (<eval <arg(drak).hits>+<arg(hpToHeal)>> > <arg(drak).maxhits>)
		arg(drak).maxhits = <eval <arg(drak).hits>+<arg(hpToHeal)>>
		arg(drak).hits = <arg(drak).maxhits>
	else
		arg(drak).hits = <eval <arg(drak).hits>+<arg(hpToHeal)>>
	endif
endif
arg(drak).EFFECT(3,i_fx_sparkle,6,20,2)

//////////// dragon cage

[events e_fire_dragon_cage]
on=@beforegetswing
on=@aftergetswing
fire_dragon_cage

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
fire_dragon_cage


[function fire_dragon_cage]
if (chance(<tag(dragon_fire_cage_chance)>,3)) // chance in promiles
	if !(tag(nextdragonfirecage))
		tag(nextdragonfirecage,0)
	endif
  if (<eval tag(nextdragonfirecage)> < <serv.time>)
    tag(nextdragonfirecage,<serv.time>+(<tag(dragon_fire_cage_delay)>*10))
    //act.flag_immobile=1
    //say("pustam klec")
    newitemsafe(i_dragon_cage_creator)
    lastnew.p=<p>
    lastnew.z=0
    lastnew.tag(dragon_fire_cage_type,<tag(dragon_fire_cage_type)>)
    lastnew.tag(dragon_fire_cage_duration,<tag(dragon_fire_cage_duration)>)
    //say("vytvoril som predmet: <lastnew.name>")
    //lastnew.tag(dragon_fire_aura_dmg,<tag(dragon_fire_aura_dmg)>)
    //f_fire_dragon_cage(<tag(dragon_fire_cage_type)>,<tag(dragon_fire_cage_duration)>)
  endif
endif

[itemdef i_dragon_cage_creator]
id=i_memory
type=t_src_changer
name=dragon cage creator

on=@create
attr=010
timer=1

on=@timer
//say("typ: <tag(dragon_fire_cage_type)>, dlzka: <tag(dragon_fire_cage_duration)>")
sector.allchars(f_fire_dragon_cage_create(<tag(dragon_fire_cage_type)>,<tag(dragon_fire_cage_duration)>,<mapplane>))
remove 
return 1

[function f_fire_dragon_cage_create]
if (isdead)||!(isplayer)||(isgm)
//	say("Prva podmienka")
	return 1
endif
if !(<mapplane> == <argv(2)>)
//	say("druha podmienka")
	return 1
endif
if (profession==class_war)
	if (chance(66,2))
		return 1
	endif
endif

//say("vytvaram")

f_fire_dragon_cage(<argv(0)>,<argv(1)>)

[function f_fire_dragon_cage]
arg(typ,<argv(0)>)
arg(cas,<argv(1)>)
//say("vytvaram cage")
flag_immobile=1

f_dragon_cage_strong(1,1,<arg(cas)>,<arg(typ)>,<p>)
f_dragon_cage_strong(0,1,<arg(cas)>,<arg(typ)>,<p>)
f_dragon_cage_strong(1,0,<arg(cas)>,<arg(typ)>,<p>)
f_dragon_cage_strong(0,-1,<arg(cas)>,<arg(typ)>,<p>)
f_dragon_cage_strong(-1,0,<arg(cas)>,<arg(typ)>,<p>)
f_dragon_cage_strong(-1,-1,<arg(cas)>,<arg(typ)>,<p>)
f_dragon_cage_strong(1,-1,<arg(cas)>,<arg(typ)>,<p>)
f_dragon_cage_strong(-1,1,<arg(cas)>,<arg(typ)>,<p>)

flag_immobile=0
 
[function f_dragon_cage_strong]
newitemsafe(i_dragon_cage_dlazka)
lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
lastnew.move=<argv(0)>,<argv(1)>
lastnew.timer=<argv(2)>
arg(dlazka,<lastnew>)

newitemsafe(i_dragon_cage_fire)
lastnew.p=<argv(4)>,<argv(5)>,<argv(6)>,<argv(7)>
lastnew.move=<argv(0)>,<argv(1)>
lastnew.timer=<argv(2)>
lastnew.tag(vydrz,<eval <argv(2)>/2>)
lastnew.tag(dlazka,<arg(dlazka)>)
lastnew.color = <f_fire_dragon_cage_get_color(<argv(3)>)>


[function f_fire_dragon_cage_get_color]
if (<argv(0)> == 1)
  return(098e)
elseif (<argv(0)> == 2)
  return(0994)
elseif (<argv(0)> == 3)
  return(097f)
elseif (<argv(0)> == 4)
  return(0692)
elseif (<argv(0)> == 5)
  return(098b)
endif
return(00)

[ITEMDEF i_dragon_cage_fire]
ID=i_fx_smoke
Name=Draci Ohen
TYPE=T_normal

ON=@CREATE
attr=010
color=00
tag(vydrz,10)

on=@step
if (src.isgm)||(src.isdead)||!(src.isplayer)
	return 1
endif
return 1

on=@userDClick
if !(tag(nextclick))
  tag(nextclick,0)
endif
if (<tag(nextclick)> > <serv.time>)
	src.sysmessage("Nic se nestalo")
  return 0
endif
if (<tag(vydrz)> > 0)
	src.sysmessage("Ohen se oslabil...")
	tag(vydrz,<eval <tag(vydrz)>-1>)
	tag(nextclick,<serv.time>+10)
else
	src.sysmessage("Ohen zmizel")
	tag(dlazka).remove
	remove
endif
return 1


on=@timer
remove
return 1


[ITEMDEF i_dragon_cage_dlazka]
ID=0AEC
NAME=nepusti hraca

ON=@Create
attr=090
COLOR=0481

ON=@step
if (<src.isGM>)||(src.isdead)||!(src.isplayer)
  return 1
endif
if (src.isplayer)
	//src.damage_noResponse(30,dam_fire|dam_magic)
	src.sysmessage("Zar je prilis silny, neda se tam projit!")
  src.move(<dir_inttochar(<dir_revert(<src.dir>)>)>)
endif

//////////////////////////////////////////////////
/////////// UPIR QUEST
//////////////////////////////////////////////////


[events e_aldaron_vamp]
on=@gethit
//aldaron_vamp

on=@Created
on=@DrinkingPotion
on=@afterswing
src.tag(vampir_zbran).remove
src.fencing = <tag(vampir_onehand)>
src.hiding = <tag(vampir_hiding)>
src.tactics = <tag(vampir_tactics)>
src.tag.remove(vampir_onehand)
src.tag.remove(vampir_hiding)
src.tag.remove(vampir_tactics)
		
src.tag.remove(vampir)
src.tag(cape).remove
src.tag.remove(cape)
src.name = <tag(vampir_name)>
src.tag.remove(vampir_name)
src.events -e_aldaron_vamp

//aldaron_vamp_hit
on=@aftergetswing
on=@beforegetswing
//aldaron_vamp
on=@beforedoeffect
on=@beforegeteffect
on=@spelleffect
//aldaron_vamp
on=@death
//src.go 4749,1345,10,12

[function aldaron_vamp]
  if ((act.npc) && (0<act.tag(vampir)> == 1))
  	src.tag(vampir,1)
  	src.events e_aldaron_vamp
  	src.aldaron_vamp_become
    src.damage_noResponse(30,dam_fire|dam_magic)
  elseif ((act.isplayer) && (0<act.tag(vampir)> == 1) && (src.distancefrom(<act>) < 2))
  	src.tag(vampir,1)
  	src.events e_aldaron_vamp
  	src.aldaron_vamp_become
    src.damage_noResponse(30,dam_fire|dam_magic)
  endif

[function aldaron_vamp_hit]
if (act.ischar)
	if (act.isplayer)
		if !(act.tag(vampir)) || (<act.tag(vampir)> == 0)
			if (src.distancefrom(<act>) < 2)
				act.tag(vampir,1)
				act.events e_aldaron_vamp
				act.aldaron_vamp_become
				act.damage_noResponse(30,dam_fire|dam_magic)
				act.sysmessage("Stal jsi se upirem!!!")
				src.hits = <src.maxhits>
			else
				src.say("neni distance")
			endif
		else
			src.say("ma tag: <act.tag(vampir)>")
		endif
	else
		src.say("neni hrac")
	endif
else
	src.say("neni char!")
endif
			
[function aldaron_vamp_become]
if (isdead)||!(isplayer)||(isgm)
	return 1
endif
if !(<restest(i_aldaron_vamp_dmg)>)
	newequip(i_aldaron_vamp_dmg)
  lastnew.timer=1
  newequip(i_cape)
  lastnew.name Vampir
  lastnew.color = 026
  lastnew.attr = 010
  tag(cape,<lastnew>)
  tag(vampir_name,<name>)
  name = Vampir <tag(vampir_name)>
endif


[itemdef i_aldaron_vamp_dmg]//dela efekt
ID=i_rune_poison_field
TYPE=t_eq_script
name=aldaron_vampire

on=@equip
timer=2 //jak rychle bude skytat
cont.sysMessage("Zabiji te nedostatok krve!")
cont.effect(3,i_fx_curse,3,16,0)

on=@timer
//timer=2
//cont.sysMessage("Zabiji te nedostatok krve!")
//arg(dmg,<eval <cont.maxhits>/100>)
//cont.damage_noResponse(<arg(dmg)>,dam_fire|dam_magic) //dmg
//cont.effect(3,i_fx_curse,3,16,0)
//if (cont.isdead) //je mrtvy, zrusime
//  remove
//  return 1
//endif
//return 1
remove
return 1
[function f_domov_drakulu_enter]
if (isgm)
	return 1
endif
newequip(i_dagger_adamantinum)
lastnew.name=Zbran na upira
lastnew.color=02A
tag(vampir_zbran,<lastnew>)
tag(vampir_onehand,<fencing>)
fencing = 1000
tag(vampir_hiding,<hiding>)
hiding = 0
tag(vampir_tactics,<tactics>)
tactics = 1000

[function f_domov_drakulu_exit]
if (isgm)
	return 1
endif
tag(vampir_zbran).remove
fencing = <tag(vampir_onehand)>
hiding = <tag(vampir_hiding)>
tactics = <tag(vampir_tactics)>
tag.remove(vampir_onehand)
tag.remove(vampir_hiding)
tag.remove(vampir_tactics)
if (tag(vampir))
	if (<tag(vampir)> == 1)
		src.tag.remove(vampir)
		src.tag(cape).remove
		src.tag.remove(cape)
		src.name = <tag(vampir_name)>
		src.tag.remove(vampir_name)
		src.events -e_aldaron_vamp
	else
		src.events -e_aldaron_vamp
		src.tag.remove(vampir)
	endif
endif

///////////// obnova veci barbora a spol:

//// masy

[template tmp_draky_masy] 
container=i_bag

// 12
item=i_dress_full
Name="Exhausting Fancy dress of Dragonslayer"
Age=0401B6B9
Changer=karath
Tag.imi_other_present="102, 113, "
Tag.imi_value_102=15
Tag.imi_value_113=4
Events=tmi_info
Events=tmi_102
Events=tmi_113
DispId=01F00
MORE1=019001C

// 13
item=i_cape
Name="Cloak of Fox and of Dragonslayer"
Age=01046142
Changer=Pikon
Tag.imi_other_present="62, 102, "
Tag.imi_value_102=12
Tag.imi_value_62=5
Events=tmi_info
Events=tmi_62
Events=tmi_102
MORE1=021000B

//14
item=i_bone_gloves_Valorite
Name="Bone gloves of Fox and of Meditation"
Color=0985
Age=013ACD23
Changer=verbes3
Tag.OMadded=630
Tag.imi_other_present="62, 72, "
Tag.imi_value_62=4
Tag.imi_value_72=5
Events=t_allarmors
Events=tmi_info
Events=tmi_62
Events=tmi_72
MORE1=090008

/// 15. valo bone helma (regen many a hp ale nevim kolik) (pokovany)
item=i_bone_helmet_Valorite
Name="Draci brneni"
Color=09CE
Age=05205F8C
Changer=lubosik
Tag.OMadded=1260
Tag.imi_other_present="70, 72, "
Tag.imi_value_70=3
Tag.imi_value_72=5
Tag.dragon_resist=8
Events=t_allarmors
Events=tmi_info
Events=tmi_70
Events=tmi_72
Events=t_dragon_armor
DispId=01456
MORE1=0120010

//16
item=i_staff_gnarled_mithril
Color=07D6
Age=047441E2
Changer=harryval
Tag.craftedby=#018DC84
Events=t_allweapons
Events=t_allstaves
DispId=013F9
MORE1=08340811
MORE2=012C
Quality=148

//17
item=i_necklace_silver
Name="Dragonslaying Necklace of Pickpocket"
Age=082BC18
Changer=mikmajk
Tag.imi_skill_present="28, "
Tag.imi_other_present="102, "
Tag.imi_value_102=15
Tag.imi_value_28=3
Events=tmi_info
Events=tmi_skills
Events=tmi_102

//18
item=i_bracelet_gold
Name="Dragonslaying Bracelet"
Age=0833CA72
Changer=snipes29
Tag.imi_other_present="102, "
Tag.imi_value_102=11
Events=tmi_info
Events=tmi_102

// 19
item=i_earrings_gold
Name="Dragonslaying Earrings"
Age=083D1FCF
Changer=snipes29
Tag.imi_other_present="102, "
Tag.imi_value_102=15
Events=tmi_info
Events=tmi_102

// 20
item=i_sash
Name="Mediums Body sash of Dragonslayer"
Age=039A8DE8
Changer=arkan
Tag.imi_skill_present="32, "
Tag.imi_other_present="102, "
Tag.imi_value_32=1
Tag.imi_value_102=15
Events=tmi_info
Events=tmi_skills
Events=tmi_102
MORE1=014000E

//21
item=i_ring_silver
Name="Dragonslaying Ring of Pickpocket"
Age=06AA852D
Changer=snipes29
Tag.imi_skill_present="28, "
Tag.imi_other_present="102, "
Tag.imi_value_102=15
Tag.imi_value_28=2
Events=tmi_info
Events=tmi_skills
Events=tmi_102

//22
item=i_bone_arms_Verite
Name="Meditating and Regenerating Bone arms"
Color=097F
Age=02151E3D
Changer=favorit
Tag.OMadded=280
Tag.imi_other_present="70, 72, "
Tag.imi_value_70=5
Tag.imi_value_72=5
Events=t_allarmors
Events=t_uneq_5
Events=tmi_info
Events=tmi_70
Events=tmi_72
MORE1=01D001C


//// cinnort

[template tmp_draky_cinnort] 
container=i_bag

//1
item=i_IRON_CHAINMAIL_COIF
Name="Draci brneni"
Color=09CE
Age=0133A8EA
Changer=Maldius
Tag.imi_skill_present="17, "
Tag.imi_other_present="70, "
Tag.imi_value_70=5
Tag.imi_value_17=5
Tag.dragon_resist=8
Events=t_allarmors
Events=tmi_info
Events=tmi_skills
Events=tmi_70
Events=t_dragon_armor
MORE1=0F000B


//2
item=i_Valorite_CHAINMAIL_gorget
Name="Draci brneni"
Color=09CE
Age=0D1669C
Changer=karath
Tag.imi_skill_present="17, "
Tag.imi_other_present="70, "
Tag.imi_value_70=4
Tag.imi_value_17=5
Tag.dragon_resist=5
Events=t_allarmors
Events=tmi_info
Events=tmi_skills
Events=tmi_70
Events=t_dragon_armor
MORE1=010000B

//3
item=i_ADAMANTINUM_RINGMAIL_GLOVES
Name="Draci brneni"
Color=09CE
Age=0C707B3
Changer=modrin
Tag.OMadded=1225
Tag.imi_skill_present="17, "
Tag.imi_other_present="70, "
Tag.imi_value_70=3
Tag.imi_value_17=5
Tag.dragon_resist=8
Events=t_allarmors
Events=tmi_info
Events=tmi_skills
Events=tmi_70
Events=t_dragon_armor
MORE1=0180011

//4
item=i_IRON_PLATEMAIL_ARMS
Name="Regenerating and Healers Platemail arms"
Color=0763
Age=047F1B3C
Changer=hatatitla01
Tag.OMadded=210
Tag.imi_skill_present="17, "
Tag.imi_other_present="70, "
Tag.imi_value_70=3
Tag.imi_value_17=5
Events=t_allarmors
Events=t_uneq_5
Events=tmi_info
Events=tmi_skills
Events=tmi_70
MORE1=0110011

//5
item=i_VERITE_PLATEMAIL
Name="Healers Platemail of Relaxation"
Color=097F
Age=0408388
Changer=Eldzey
Tag.OMadded=720
Tag.imi_skill_present="17, "
Tag.imi_value_71=3
Tag.imi_other_present="71, "
Tag.imi_value_17=5
Events=t_allarmors
Events=t_uneq_5
Events=tmi_info
Events=tmi_skills
Events=tmi_71
DispId=01416
MORE1=04B0048

//6
item=i_mace_adamantinum
Name="Mace of Dragonslayer and of Lifeleech"
Color=0999
Age=0113E384
Changer=mohnil
Tag.iic_owner=#02D2768
Tag.imi_other_present="102, 111, "
Tag.imi_value_102=18
Tag.imi_value_111=7
Events=t_allweapons
Events=t_cm_blacksmithing_target
Events=tmi_info
Events=tmi_102
Events=tmi_111
Events=t_magicflagger
Events=t_item_in_corpse
DispId=0F5D
MORE1=03DE03D6

//7
item=i_boots_calf
Name="Relaxating Boots"
Color=031C
Age=077CD1E5
Changer=snipes29
Tag.imi_value_71=5
Tag.imi_other_present="71, "
Events=tmi_info
Events=tmi_71
MORE1=01D0016

//8
item=i_plast_bojovnika
Name="Druhy plast bojovnika"
Color=098F
Age=02B765D
Changer=snipes27
Tag.craftedby=#02D2768
Tag.owner=#02D2768
Tag.imi_other_present="70, 102, "
Tag.imi_value_102=20
Tag.imi_value_70=10
Events=tmi_info
Events=tmi_70
Events=tmi_102
MORE1=0640064

//9
item=i_bracelet_silver
Name="Bracelet of Regeneration and of Relaxation"
Age=03D7E65B
Changer=Donnelly
Tag.imi_value_71=2
Tag.imi_other_present="70, 71, "
Tag.imi_value_70=5
Events=tmi_info
Events=tmi_70
Events=tmi_71

//10
item=i_VERITE_CHAINMAIL_LEGGINGS
Name="Healers Chainmail leggings of Magic Reflection"
Color=097F
Age=0918D382
Changer=bohus
Tag.OMadded=460
Tag.imi_skill_present="17, "
Tag.imi_other_present="133, "
Tag.imi_value_17=5
Tag.imi_value_133=3
Events=t_allarmors
Events=t_uneq_24
Events=tmi_info
Events=tmi_skills
Events=tmi_133
MORE1=028001B

//11
item=i_earrings_gold
Name="Regenerating Earrings of Mage"
Age=0921FF1A
Changer=snipes29
Tag.imi_skill_present="25, "
Tag.imi_other_present="70, "
Tag.imi_value_25=4
Tag.imi_value_70=5
Events=tmi_info
Events=tmi_skills
Events=tmi_70



//// maud

[template tmp_draky_maud] 
container=i_bag

//23
item=i_VALORITE_RINGMAIL_GLOVES
Name="Draci brneni"
Color=09CE
Age=02E7EA23
Changer=divenewbie
Tag.OMadded=630
Tag.imi_other_present="62, 72, "
Tag.imi_value_62=5
Tag.imi_value_72=5
Tag.dragon_resist=8
Events=t_allarmors
Events=tmi_info
Events=tmi_62
Events=tmi_72
Events=t_dragon_armor
MORE1=0C000C

//24
item=i_OBSIDIAN_RINGMAIL_GLOVES
Name="Physical Reflecting and Healers Ringmail gloves"
Color=0989
Age=0483F5A
Changer=Lejla
Tag.imi_skill_present="17, "
Tag.imi_other_present="131, "
Tag.imi_value_131=4
Tag.imi_value_17=5
Events=t_allarmors
Events=tmi_info
Events=tmi_skills
Events=tmi_131
DispId=013F2
MORE1=0100010

//25
item=i_VERITE_METAL_SHIELD
Name="Metal shield of Healer and of Regeneration"
Color=097F
Age=0BDD63E
Changer=Javor
Tag.imi_skill_present="17, "
Tag.imi_other_present="70, "
Tag.imi_value_70=4
Tag.imi_value_17=5
Events=t_allshields
Events=tmi_info
Events=tmi_skills
Events=tmi_70
MORE1=0360036

//26
item=i_VERITE_RINGMAIL_TUNIC
Name="Healers Ringmail tunic"
Color=097F
Age=0B1D3CA
Changer=danecek
Tag.OMadded=720
Tag.imi_skill_present="17, "
Tag.imi_value_17=5
Events=t_allarmors
Events=t_uneq_5
Events=tmi_info
Events=tmi_skills
MORE1=02B0027

//27
item=i_Valorite_RINGMAIL_helm
Name="Draci brneni"
Color=09CE
Age=094B940
Changer=gadzo
Tag.OMadded=1260
Tag.imi_skill_present="17, "
Tag.imi_other_present="134, "
Tag.imi_value_134=10
Tag.imi_value_17=5
Tag.dragon_resist=8
Events=t_allarmors
Events=tmi_info
Events=tmi_skills
Events=tmi_134
Events=t_dragon_armor
DispId=0140B
MORE1=0190015

//28 
item=i_Valorite_CHAINMAIL_sleeves
Name="Healers Leather sleeves"
Color=0985
Age=015C87C6
Changer=Snowik
Tag.OMadded=1260
Tag.imi_skill_present="17, "
Tag.imi_value_17=5
Events=t_allarmors
Events=t_uneq_5
Events=tmi_info
Events=tmi_skills
MORE1=0250025

//29
item=i_Valorite_CHAINMAIL_gorget
Name="Draci brneni"
Color=09CE
Age=04087A15
Changer=elba
Tag.OMadded=540
Tag.imi_skill_present="1, 17, "
Tag.imi_value_17=5
Tag.imi_value_1=4
Tag.dragon_resist=5
Events=t_allarmors
Events=tmi_info
Events=tmi_skills
Events=t_dragon_armor
MORE1=010000E

//30
item=i_boots_calf
Name="Relaxating Boots"
Color=0129
Age=077CD1E6
Changer=stevenson
Tag.imi_value_71=5
Tag.imi_other_present="71, "
Events=tmi_info
Events=tmi_71
MORE1=01A0014

//31
item=i_ring_gold
Name="Relaxating and Bards Ring"
Age=028676F3
Changer=Anar
Tag.imi_skill_present="15, "
Tag.imi_value_71=5
Tag.imi_other_present="71, "
Tag.imi_value_15=3
Events=tmi_info
Events=tmi_skills
Events=tmi_71

//// barbora

[template tmp_draky_barbora] 
container=i_bag

//32 
item=i_ADAMANTINUM_BASCINET
Name="Draci brneni"
Color=09CE
Age=02098F
Changer=wolfkiller21
Tag.OMadded=2450
Tag.imi_other_present="72, 134, "
Tag.imi_value_134=8
Tag.imi_value_72=1
Tag.dragon_resist=8
Events=t_allarmors
Events=tmi_info
Events=tmi_72
Events=tmi_134
Events=t_dragon_armor
DispId=0140D
MORE1=0580058

//33
item=i_VALORITE_PLATEMAIL_GORGET
Name="Draci brneni"
Color=09CE
Age=04F0BA4
Changer=tocivejjoe
Tag.OMadded=540
Tag.imi_other_present="62, 134, "
Tag.imi_value_134=8
Tag.imi_value_62=4
Tag.dragon_resist=5
Events=t_allarmors
Events=tmi_info
Events=tmi_62
Events=tmi_134
Events=t_dragon_armor
MORE1=0110010

//34
item=i_VALORITE_PLATEMAIL_ARMS
Name="Foxes Platemail arms of Physical Block"
Color=0985
Age=08CBEA
Changer=Johyf
Tag.OMadded=1260
Tag.imi_other_present="62, 134, "
Tag.imi_value_134=7
Tag.imi_value_62=3
Events=t_allarmors
Events=t_uneq_5
Events=tmi_info
Events=tmi_62
Events=tmi_134
MORE1=02C002C

//35
item=i_OBSIDIAN_PLATEMAIL_GAUNTLETS
Name="Draci brneni"
Color=09CE
Age=01BE2606
Changer=elfa
Tag.OMadded=1015
Tag.imi_skill_present="5, "
Tag.imi_other_present="134, "
Tag.imi_value_134=5
Tag.imi_value_5=4
Tag.dragon_resist=8
Events=t_allarmors
Events=tmi_info
Events=tmi_skills
Events=tmi_134
Events=t_dragon_armor
MORE1=01C001C

//36
item=i_VALORITE_FEMALE_PLATEMAIL
Name="Physical Blocking and Regenerating Plate armor"
Color=0985
Age=0D89927
Changer=basketak
Tag.OMadded=3240
Tag.imi_other_present="70, 134, "
Tag.imi_value_134=7
Tag.imi_value_70=4
Events=t_allarmors
Events=t_uneq_5
Events=tmi_info
Events=tmi_70
Events=tmi_134
DispId=01C05
MORE1=071006F

//37
item=i_VERITE_PLATEMAIL_leggings
Name="Platemail legs of Regeneration and of Physical Block"
Color=097F
Age=0EED81C
Changer=anarchil
Tag.OMadded=460
Tag.imi_other_present="70, 134, "
Tag.imi_value_134=8
Tag.imi_value_70=5
Events=t_allarmors
Events=t_uneq_24
Events=tmi_info
Events=tmi_70
Events=tmi_134
MORE1=030002E

//38
item=i_mace_war_mithril
Name="Crusher War mace vyroben od HandyCraft"
Color=098B
Age=0B8C1BA
Changer=harryval
Tag.craftedby=#018DC84
Tag.imi_skill_present="41, "
Tag.imi_value_41=20
Events=t_allweapons
Events=t_cm_blacksmithing_target
Events=tmi_info
Events=tmi_skills
Events=t_magicflagger
DispId=01407
MORE1=06D606AA
Quality=181

// 39
item=i_plast_bojovnika
Name="Prvni plast bojovnika"
Color=098F
Age=0405030
Changer=enrico
Tag.owner=#06BF63
Tag.imi_other_present="70, 102, "
Tag.imi_value_102=20
Tag.imi_value_70=10
Events=tmi_info
Events=tmi_70
Events=tmi_102
DispId=01530
MORE1=0640064

//40
item=i_robe
Name="Regenerating Robe of Crushe"
Color=025
Age=04ED89C9
Changer=vaci
Tag.iic_owner=#06BF63
Tag.imi_skill_present="41, "
Tag.imi_other_present="70, "
Tag.imi_value_41=2
Tag.imi_value_70=5
Events=tmi_info
Events=tmi_skills
Events=tmi_70
Events=t_item_in_corpse
DispId=01F04
MORE1=01B0027

//41
item=i_ring_gold
Name="Tamers Ring of Regeneration"
Age=042B38F3
Changer=frajer123
Tag.iic_owner=#06BF63
Tag.imi_skill_present="35, "
Tag.imi_other_present="70, "
Tag.imi_value_35=2
Tag.imi_value_70=5
Events=tmi_info
Events=tmi_skills
Events=tmi_70
Events=t_item_in_corpse

//42
item=i_bracelet_silver
Name="Bards Bracelet of Regeneration"
Age=0699D31F
Changer=elfi
Tag.iic_owner=#06BF63
Tag.imi_skill_present="22, "
Tag.imi_other_present="70, "
Tag.imi_value_22=5
Tag.imi_value_70=5
Events=tmi_info
Events=tmi_skills
Events=tmi_70
Events=t_item_in_corpse

//43
item=i_sash
Name="Body sash of Regeneration and of Ogrekiller"
Age=07F5C7CB
Changer=martinsson
Tag.iic_owner=#06BF63
Tag.imi_other_present="70, 103, "
Tag.imi_value_103=5
Tag.imi_value_70=5
Events=tmi_info
Events=tmi_70
Events=tmi_103
Events=t_item_in_corpse
DispId=01542
MORE1=0270026

//// arjan

[template tmp_draky_arjan] 
container=i_bag

//44
item=i_crossbow_mithril
Name="Knights Crossbow"
Color=07D6
Age=06EE4F2
Changer=wolfkiller
Tag.imi_other_present="51, "
Tag.imi_value_51=10
Events=t_allweapons
Events=t_allbows
Events=tmi_info
Events=tmi_51
Events=t_magicflagger
MORE1=0690068E

// 45
item=i_Adamantinum_RINGMAIL_helm
Name="Draci brneni"
Color=09CE
Age=03C1E2F
Changer=elbi
Tag.OMadded=2450
Tag.imi_skill_present="1, "
Tag.imi_other_present="60, "
Tag.imi_value_60=3
Tag.imi_value_1=1
Tag.dragon_resist=8
Events=t_allarmors
Events=tmi_info
Events=tmi_skills
Events=tmi_60
Events=t_dragon_armor
DispId=0140B
MORE1=0320032

//46
item=i_Obsidian_RINGMAIL_gorget
Name="Draci brneni"
Color=09CE
Age=01176246
Changer=mohnil
Tag.OMadded=870
Tag.imi_other_present="60, 70, "
Tag.imi_value_60=4
Tag.imi_value_70=5
Tag.dragon_resist=5
Events=t_allarmors
Events=tmi_info
Events=tmi_60
Events=tmi_70
Events=t_dragon_armor
MORE1=0E000D

//47
item=i_ring_gold
Name="Ring of Snake and of Dragonslayer"
Age=011718ED
Changer=wolfkiller
Tag.iic_owner=#0DA9BC
Tag.imi_other_present="61, 102, "
Tag.imi_value_61=5
Tag.imi_value_102=13
Events=tmi_info
Events=tmi_61
Events=tmi_102
Events=t_item_in_corpse

//48
item=i_sash
Name="Bards Body sash of Dragonslayer"
Color=0E8
Age=0169BAD0
Changer=OlDirtyShimmy
Tag.iic_owner=#0DA9BC
Tag.imi_skill_present="15, "
Tag.imi_other_present="102, "
Tag.imi_value_102=15
Tag.imi_value_15=5
Events=tmi_info
Events=tmi_skills
Events=tmi_102
Events=t_item_in_corpse
DispId=01542
MORE1=01D001A

//49
item=i_cape
Name="Dragonslaying and Mages Cloak"
Color=0E8
Age=043E6976
Changer=qqq
Tag.imi_skill_present="25, "
Tag.imi_other_present="102, "
Tag.imi_value_25=3
Tag.imi_value_102=15
Events=tmi_info
Events=tmi_skills
Events=tmi_102
DispId=01530
MORE1=028001F

//50
item=i_VALORITE_RINGMAIL_SLEEVES
Name="Titans Ringmail sleeves of Physical Reflection"
Color=0985
Age=01B4A199
Changer=OlDirtyShimmy
Tag.OMadded=1260
Tag.imi_other_present="60, 131, "
Tag.imi_value_60=4
Tag.imi_value_131=2
Events=t_allarmors
Events=t_uneq_5
Events=tmi_info
Events=tmi_60
Events=tmi_131
MORE1=0190019

//////////////////////////////////////////////////
/// hladanie pokladu: "mapa"

[function lost_treasure_map]
if (src.isgm)
  dialog(d_lost_treasure_map)
else
	src.sysMessage("Tato funkcia nieje pre teba")
endif

[dialog d_lost_treasure_map]
arg(textcolor,52)
argo.SetLocation=205,150

argo.tag(sirka,644)
argo.tag(vyska,288)

argo.dialog_prvni
argo.dialog_pozadi(<argo.tag(nexty)>,1)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_pozadi(<argo.tag(nexty)>,1,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20)
argo.dialog_zpruhledni

argo.texta(<argo.dialog_textpos(0,0)>,42,"Kdo se pozorne diva, CESTU ZNA..")
argo.texta(<argo.dialog_textpos(1,0)>,<d_def_readcolor>,"*")
argo.texta(<argo.dialog_textpos(1,1)>,<d_def_readcolor>,"A")
argo.texta(<argo.dialog_textpos(1,2)>,<d_def_readcolor>,"B")
argo.texta(<argo.dialog_textpos(1,3)>,<d_def_readcolor>,"C")
argo.texta(<argo.dialog_textpos(1,4)>,<d_def_readcolor>,"D")
argo.texta(<argo.dialog_textpos(1,5)>,<d_def_readcolor>,"E")
argo.texta(<argo.dialog_textpos(1,6)>,<d_def_readcolor>,"F")
argo.texta(<argo.dialog_textpos(1,7)>,<d_def_readcolor>,"G")
argo.texta(<argo.dialog_textpos(1,8)>,<d_def_readcolor>,"H")
argo.texta(<argo.dialog_textpos(1,9)>,<d_def_readcolor>,"I")
argo.texta(<argo.dialog_textpos(1,10)>,<d_def_readcolor>,"J")
argo.texta(<argo.dialog_textpos(1,11)>,<d_def_readcolor>,"K")
argo.texta(<argo.dialog_textpos(1,12)>,<d_def_readcolor>,"L")
argo.texta(<argo.dialog_textpos(1,13)>,<d_def_readcolor>,"M")
argo.texta(<argo.dialog_textpos(1,14)>,<d_def_readcolor>,"N")
argo.texta(<argo.dialog_textpos(1,15)>,<d_def_readcolor>,"O")
argo.texta(<argo.dialog_textpos(1,16)>,<d_def_readcolor>,"P")
argo.texta(<argo.dialog_textpos(1,17)>,<d_def_readcolor>,"Q")
argo.texta(<argo.dialog_textpos(1,18)>,<d_def_readcolor>,"R")
argo.texta(<argo.dialog_textpos(1,19)>,<d_def_readcolor>,"S")
argo.texta(<argo.dialog_textpos(1,20)>,<d_def_readcolor>,"T")
argo.texta(<argo.dialog_textpos(1,21)>,<d_def_readcolor>,"U")
argo.texta(<argo.dialog_textpos(1,22)>,<d_def_readcolor>,"V")
argo.texta(<argo.dialog_textpos(1,23)>,<d_def_readcolor>,"W")
argo.texta(<argo.dialog_textpos(1,24)>,<d_def_readcolor>,"X")
argo.texta(<argo.dialog_textpos(1,25)>,<d_def_readcolor>,"Y")
argo.texta(<argo.dialog_textpos(1,26)>,<d_def_readcolor>,"Z")

argo.texta(<argo.dialog_textpos(2,0)>,<d_def_writecolor>,"0")
argo.texta(<argo.dialog_textpos(2,1)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(2,2)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(2,3)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(2,4)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(2,5)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(2,6)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(2,7)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(2,8)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(2,9)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(2,10)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(2,11)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(2,12)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(2,13)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(2,14)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(2,15)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(2,16)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(2,17)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(2,18)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(2,19)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(2,20)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(2,21)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(2,22)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(2,23)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(2,24)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(2,25)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(2,26)>,<d_def_readcolor>,"4")

argo.texta(<argo.dialog_textpos(3,0)>,<d_def_writecolor>,"1")
argo.texta(<argo.dialog_textpos(3,1)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(3,2)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(3,3)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(3,4)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(3,5)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(3,6)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(3,7)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(3,8)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(3,9)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(3,10)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(3,11)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(3,12)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(3,13)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(3,14)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(3,15)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(3,16)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(3,17)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(3,18)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(3,19)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(3,20)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(3,21)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(3,22)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(3,23)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(3,24)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(3,25)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(3,26)>,<d_def_readcolor>,"8")

argo.texta(<argo.dialog_textpos(4,0)>,<d_def_writecolor>,"2")
argo.texta(<argo.dialog_textpos(4,1)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(4,2)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(4,3)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(4,4)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(4,5)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(4,6)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(4,7)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(4,8)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(4,9)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(4,10)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(4,11)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(4,12)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(4,13)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(4,14)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(4,15)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(4,16)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(4,17)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(4,18)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(4,19)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(4,20)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(4,21)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(4,22)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(4,23)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(4,24)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(4,25)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(4,26)>,<d_def_readcolor>,"9")

argo.texta(<argo.dialog_textpos(5,0)>,<d_def_writecolor>,"3")
argo.texta(<argo.dialog_textpos(5,1)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(5,2)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(5,3)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(5,4)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(5,5)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(5,6)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(5,7)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(5,8)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(5,9)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(5,10)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(5,11)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(5,12)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(5,13)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(5,14)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(5,15)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(5,16)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(5,17)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(5,18)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(5,19)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(5,20)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(5,21)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(5,22)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(5,23)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(5,24)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(5,25)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(5,26)>,<d_def_readcolor>,"0")

argo.texta(<argo.dialog_textpos(6,0)>,<d_def_writecolor>,"4")
argo.texta(<argo.dialog_textpos(6,1)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(6,2)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(6,3)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(6,4)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(6,5)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(6,6)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(6,7)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(6,8)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(6,9)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(6,10)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(6,11)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(6,12)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(6,13)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(6,14)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(6,15)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(6,16)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(6,17)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(6,18)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(6,19)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(6,20)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(6,21)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(6,22)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(6,23)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(6,24)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(6,25)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(6,26)>,<d_def_readcolor>,"4")

argo.texta(<argo.dialog_textpos(7,0)>,<d_def_writecolor>,"5")
argo.texta(<argo.dialog_textpos(7,1)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(7,2)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(7,3)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(7,4)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(7,5)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(7,6)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(7,7)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(7,8)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(7,9)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(7,10)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(7,11)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(7,12)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(7,13)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(7,14)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(7,15)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(7,16)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(7,17)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(7,18)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(7,19)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(7,20)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(7,21)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(7,22)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(7,23)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(7,24)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(7,25)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(7,26)>,<d_def_readcolor>,"6")

argo.texta(<argo.dialog_textpos(8,0)>,<d_def_writecolor>,"6")
argo.texta(<argo.dialog_textpos(8,1)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(8,2)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(8,3)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(8,4)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(8,5)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(8,6)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(8,7)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(8,8)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(8,9)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(8,10)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(8,11)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(8,12)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(8,13)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(8,14)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(8,15)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(8,16)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(8,17)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(8,18)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(8,19)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(8,20)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(8,21)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(8,22)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(8,23)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(8,24)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(8,25)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(8,26)>,<d_def_readcolor>,"3")

argo.texta(<argo.dialog_textpos(9,0)>,<d_def_writecolor>,"7")
argo.texta(<argo.dialog_textpos(9,1)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(9,2)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(9,3)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(9,4)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(9,5)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(9,6)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(9,7)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(9,8)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(9,9)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(9,10)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(9,11)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(9,12)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(9,13)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(9,14)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(9,15)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(9,16)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(9,17)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(9,18)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(9,19)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(9,20)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(9,21)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(9,22)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(9,23)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(9,24)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(9,25)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(9,26)>,<d_def_readcolor>,"7")

argo.texta(<argo.dialog_textpos(10,0)>,<d_def_writecolor>,"8")
argo.texta(<argo.dialog_textpos(10,1)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(10,2)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(10,3)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(10,4)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(10,5)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(10,6)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(10,7)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(10,8)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(10,9)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(10,10)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(10,11)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(10,12)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(10,13)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(10,14)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(10,15)>,<d_def_readcolor>,"7")
argo.texta(<argo.dialog_textpos(10,16)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(10,17)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(10,18)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(10,19)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(10,20)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(10,21)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(10,22)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(10,23)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(10,24)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(10,25)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(10,26)>,<d_def_readcolor>,"7")

argo.texta(<argo.dialog_textpos(11,0)>,<d_def_writecolor>,"9")
argo.texta(<argo.dialog_textpos(11,1)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(11,2)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(11,3)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(11,4)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(11,5)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(11,6)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(11,7)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(11,8)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(11,9)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(11,10)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(11,11)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(11,12)>,<d_def_readcolor>,"0")
argo.texta(<argo.dialog_textpos(11,13)>,<d_def_readcolor>,"4")
argo.texta(<argo.dialog_textpos(11,14)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(11,15)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(11,16)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(11,17)>,<d_def_readcolor>,"6")
argo.texta(<argo.dialog_textpos(11,18)>,<d_def_readcolor>,"3")
argo.texta(<argo.dialog_textpos(11,19)>,<d_def_readcolor>,"9")
argo.texta(<argo.dialog_textpos(11,20)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(11,21)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(11,22)>,<d_def_readcolor>,"8")
argo.texta(<argo.dialog_textpos(11,23)>,<d_def_readcolor>,"1")
argo.texta(<argo.dialog_textpos(11,24)>,<d_def_readcolor>,"5")
argo.texta(<argo.dialog_textpos(11,25)>,<d_def_readcolor>,"2")
argo.texta(<argo.dialog_textpos(11,26)>,<d_def_readcolor>,"8")

[ITEMDEF i_lost_treasure_trap]
ID=0495
Name=Podivna dlazka
TYPE=T_normal

ON=@CREATE
attr=010
color=00

on=@step
if (src.isgm) 
	return 0
endif	
if (<src.flags>&statf_dead)
  src.move(<dir_inttochar(<dir_revert(<src.dir>)>)>)
endif
if (<src.findlayer.layer_horse>)&&(!src.isgm)
    src.hits = 0
    effect(2,i_trap_saw_floor,6,16,0)
  	src.move(<dir_inttochar(<dir_revert(<src.dir>)>)>)
    //src.effect(3,i_fx_curse,6,15,1)
    //sound=<s_explosion.sound>
	  src.sysMessage("Pod tvou vahou se dlazdice propadla a past spustila. Ale bylo to rychle, skoro bezbolestne...")
else
	src.sysMessage("Dlazdice sice vydava podivne zvuky, ale zustava na svem miste.")
endif
return 1

[ITEMDEF i_lost_treasure_rock]
ID=i_rock_plain
Name=Podivny kamen
TYPE=T_normal

ON=@CREATE
attr=010
color=00

on=@userDClick
 if (<src.flags>&statf_dead)
   return 0
 else
 	src.go <morep>
 endif
 

[ITEMDEF i_lost_treasure_doors]
ID=i_wall_dungeon
Name=Podivna stena
TYPE=T_normal

ON=@CREATE
attr=010
color=00
tag(open,0)

on=@timer
if (<tag(open)> == 1)
	nudgedown(20)
	tag(open,0)
endif
return 1

on=@userDClick
if (<tag(open)> == 0)
	nudgeup(20)
	timer 180
	tag(open,1)
endif
return 1


[itemdef i_lost_treasure_cannon_ball]
ID=i_cannon_ball
Type=t_normal
Name=Delove gule

ON=@Create
attr=010
tag(zobrane,0)

on=@timer
tag(zobrane,0)
return 1

on=@UserDClick
if (<src.flags>&statf_dead)
   return 0
endif
if (<tag(zobrane)> == 0)
  src.sysMessage("Sebral si delovu gulu.")
  src.newitem(i_cannon_ball).bounce
  tag(zobrane,1)
  timer=600
else
	src.sysMessage("Ta se neda zvednout...")
endif
return 0


[itemdef i_lost_treasure_switch]
ID=i_switch
Type=t_normal
Name=Tlacidlo

ON=@Create
attr=010

on=@UserDClick
if (<src.flags>&statf_dead)
   return 0
endif
tag(statue).flip
tag(controller).check_statues(<tag(statue)>)
src.sysMessage("Socha se otocila...")
return 0


[ITEMDEF i_lost_treasure_statue_ovladac]
ID=0a0a
Name=Ovladac soch
TYPE=T_normal

ON=@CREATE
attr=010
tag(statues_count,0)

on=@userdclick
if (src.isgm)
	src.add_statue(<uid>)
endif

return 0

on=@timer 
return 1

[function add_statue]
newequip(i_zamerovatko_add_statue)
lastnew.tag(ovladac,<args>)

[itemdef i_zamerovatko_add_statue]
id=i_memory
name=zamerovatko na vytvoreni sochy
type=t_eq_script

on=@equip
target("Zamer sochu")

ON=@TARGON_char
arg(socha,<src.targ>)
tag(ovladac).tag(statue_<tag(ovladac).tag(statues_count)>,<arg(socha)>)
tag(ovladac).tag(statue[<arg(socha)>]_dir,<arg(socha).dir>)
tag(ovladac).tag(statues_count,0<tag(ovladac).tag(statues_count)>+1)

[function check_statues]
logmsg("argv: <args>")
logmsg("tag dir: <tag(statue[<args>]_dir)>") 
logmsg("dir: <finduid(<args>).dir>")
if (<finduid(<args>).dir> == <tag(statue[<args>]_dir)>)
	arg(i,1)
	while (i <= <tag(statues_count)>)
	  if !(<tag(statue_<i>).dir> == <tag(statue[<tag(statue_<i>)>]_dir)>)
			dispid = 0a0a
  		update	
	  	tag(open,0)
	  	tag(door_1).type=t_door_locked
  		tag(door_2).type=t_door_locked
	  	return 0
	  endif
	arg(i,#+1)
	endwhile
	tag(open,1)
	dispid = 0a0c
  update
  if (<tag(scnd).tag(open)> == 1)
  	tag(door_1).type=t_door
  	tag(door_2).type=t_door
  endif
else	  
	dispid = 0a0a
  update	
	tag(open,0)
	tag(door_1).type=t_door_locked
  tag(door_2).type=t_door_locked
endif
return 0

[ITEMDEF i_lost_treasure_vahy_miska]
ID=04ab
Type=t_normal
Name=Miska vah

ON=@Create
attr=010
tag(rock_on,0)
tag(miska,0)

on=@UserDClick
src.sysmessage("Opatrne pri dotykani misiek vah..")
return 0

[ITEMDEF i_lost_treasure_vahy_ovladac]
ID=0edc
Type=t_normal
Name=Vaha

ON=@Create
tag(balance,0)
tag(miska_1,0)
tag(miska_2,0)
tag(stones_left,10)
attr=010

on=@userclicik
if (<tag(balance)> == 1)
	src.sysmessage("Vahy su vyvazene a dvere su otvorene...")
else
	src.sysmessage("Vahy este nesu vyvazene...")
endif

on=@UserDClick
src.sysmessage("Opatrne pri dotykani misiek vah..")
return 0

[ITEMDEF i_lost_treasure_vahy_rock]
ID=i_rock_plain
Type=t_normal
Name=kamen

ON=@Create
attr=010
tag(na_miske,0)
tag(vaha,0)

on=@UserDClick
src.newequip(i_lost_treasure_rock_move)
lastnew.tag(kamen,<uid>)
lastnew.tag(vaha,<tag(controller)>)

[ITEMDEF i_lost_treasure_rock_move]
id=i_rune_poison_field
name=zamerovatko na presun kamenu
type=t_eq_script

on=@equip
target("Zamer, na ktoru misku chces kamen polozit.")

ON=@TARGON_ITEM
if (src.targ.id != i_lost_treasure_vahy_miska)
	src.sysMessage("Zameriavaj iba misky vah.")
  remove
  return 0
endif
if (<src.targ.tag(rock_on)> == 1)
	src.sysMessage("Na casti misky uz kamen je.")
  remove
  return 0
endif
if (<tag(kamen).tag(na_miske)> == 1)
	tag(kamen).tag(miska_uid).tag(rock_on,0)
	tag(vaha).tag(miska_<tag(kamen).tag(miska)>,<tag(vaha).tag(miska_<tag(kamen).tag(miska)>)>-<tag(kamen).tag(vaha)>)
	tag(vaha).tag(stones_left,<tag(vaha).tag(stones_left)>+1)
	tag(kamen).p = <src.targ.p>
	tag(kamen).update
	tag(kamen).tag(miska,<src.targ.tag(miska)>)
	tag(kamen).tag(miska_uid,<src.targ>)
	tag(kamen).tag(miska_uid).tag(rock_on,1)
	tag(vaha).tag(stones_left,<tag(vaha).tag(stones_left)>-1)	
	tag(vaha).tag(miska_<tag(kamen).tag(miska)>,<tag(vaha).tag(miska_<tag(kamen).tag(miska)>)>+<tag(kamen).tag(vaha)>)
	if ((<tag(vaha).tag(miska_1)> == <tag(vaha).tag(miska_2)>)&&(<tag(vaha).tag(stones_left)> == 0))
		tag(vaha).tag(balance,1)
		tag(vaha).tag(door_1).type t_door
		tag(vaha).tag(door_2).type t_door
	else
		tag(vaha).tag(balance,0)
		tag(vaha).tag(door_1).type t_door_locked
		tag(vaha).tag(door_2).type t_door_locked
	endif
else
	src.targ.tag(rock_on,1)
	tag(kamen).p = <src.targ.p>
	tag(kamen).update
	tag(kamen).tag(miska,<src.targ.tag(miska)>)
	tag(kamen).tag(miska_uid,<src.targ>)
	tag(kamen).tag(na_miske,1)
	tag(vaha).tag(stones_left,<tag(vaha).tag(stones_left)>-1)
	tag(vaha).tag(miska_<src.targ.tag(miska)>,<tag(vaha).tag(miska_<src.targ.tag(miska)>)>+<tag(kamen).tag(vaha)>)
	if ((<tag(vaha).tag(miska_1)> == <tag(vaha).tag(miska_2)>)&&(<tag(vaha).tag(stones_left)> == 0))
		tag(vaha).tag(balance,1)
		tag(vaha).tag(door_1).type t_door
		tag(vaha).tag(door_2).type t_door
	else
		tag(vaha).tag(balance,0)
		tag(vaha).tag(door_1).type t_door_locked
		tag(vaha).tag(door_2).type t_door_locked
	endif
endif
	

ON=@TARGON_GROUND
src.sysMessage("Tady ho nemuzes presunut.")
remove
RETURN 1 

ON=@TARGON_CHAR
src.sysMessage("Tady ho nemuzes presunut.")
remove
RETURN 1 

[ITEMDEF i_lost_treasure_mapa]
ID=i_map
NAME=Sifrovana mapa
TYPE=t_normal

on=@create
attr=attr_move_never
color=00

on=@timer
return 1

on=@userdclick
src.dialog(d_lost_treasure_map)

//////////////////////////////////////////////////
//////////////////////////////////////////////////
//////////////////////////////////////////////////
/// shooter
//////////////////////////////////////////////////
//////////////////////////////////////////////////
//////////////////////////////////////////////////


[function shooter_walk]
if (<src.tag(shooter_next)> > <serv.time>)
  classMessage("Jeste nemuzes pouzit.")
  return 0
endif
newnpc(c_dummy)
act.p=<p>
act.walk(<args>)
p=<act.p>
act.remove
src.update
src.tag(shooter_next,<eval <serv.time>+5>)

[function shooter_new_walk]
if (<src.tag(shooter_next)> > <serv.time>)
  classMessage("Jeste nemuzes pouzit.")
  return 0
endif
src.tag(shooter_next,<eval <serv.time>+5>)

[function gonorth]
if !(src.tag(shooter_control))
	src.sysmessage("Nieje pre teba")
	return 0
endif
//src.move(0,-1)
//shooter_new_walk(1)
shooter_walk(n)

[function gosouth]
if !(src.tag(shooter_control))
	src.sysmessage("Nieje pre teba")
	return 0
endif
//src.move(0,1)
//shooter_new_walk(2)
shooter_walk(s)

[function goeast]
if !(src.tag(shooter_control))
	src.sysmessage("Nieje pre teba")
	return 0
endif
//src.move(1,0)
//shooter_new_walk(3)
shooter_walk(e)

[function gowest]
if !(src.tag(shooter_control))
	src.sysmessage("Nieje pre teba")
	return 0
endif
//src.move(-1,0)
//shooter_new_walk(4)
shooter_walk(w)

[function turnright]
if !(src.tag(shooter_control))
	src.sysmessage("Nieje pre teba")
	return 0
endif
if (<src.tag(shooter_next)> > <serv.time>)
  classMessage("Jeste nemuzes pouzit.")
  return 0
endif
if (<src.dir> == 0)
	src.dir = 2
  src.update
elseif (<src.dir> == 2)
	src.dir = 4
  src.update
elseif (<src.dir> == 4)
	src.dir = 6
  src.update
elseif (<src.dir> == 6)
	src.dir = 0
  src.update
endif
src.tag(shooter_next,<eval <serv.time>+5>)

[function turnleft]
if !(src.tag(shooter_control))
	src.sysmessage("Nieje pre teba")
	return 0
endif
if (<src.tag(shooter_next)> > <serv.time>)
  classMessage("Jeste nemuzes pouzit.")
  return 0
endif
if (<src.dir> == 0)
	src.dir = 6
  src.update
elseif (<src.dir> == 6)
	src.dir = 4
  src.update
elseif (<src.dir> == 4)
	src.dir = 2
  src.update
elseif (<src.dir> == 2)
	src.dir = 0
  src.update
endif
src.tag(shooter_next,<eval <serv.time>+5>)

[function turnaround]
if !(src.tag(shooter_control))
	src.sysmessage("Nieje pre teba")
	return 0
endif
if (<src.tag(shooter_next)> > <serv.time>)
  classMessage("Jeste nemuzes pouzit.")
  return 0
endif
if (<src.dir> == 0)
	src.dir = 4
  src.update
elseif (<src.dir> == 6)
	src.dir = 2
  src.update
elseif (<src.dir> == 4)
	src.dir = 0
  src.update
elseif (<src.dir> == 2)
	src.dir = 6
  src.update
endif
src.tag(shooter_next,<eval <serv.time>+5>)


[ITEMDEF i_shooter_ovladac]
ID=0EDC
Name=Ovladac portu
TYPE=T_normal

ON=@CREATE
attr=090
color=0986
tag(players,0)

on=@timer
return 1

on=@userdclick
if (src.isgm)
	src.shooter_add_player(<uid>)
endif

[function shooter_add_player]
newequip(i_zamerovatko_shooter_add_player)
lastnew.tag(ovladac,<args>)

[itemdef i_zamerovatko_shooter_add_player]
id=i_memory
name=zamerovatko na pridanie hraca
type=t_eq_script

on=@equip
target("Zamer hraca")

ON=@TARGON_char
arg(hrac,<src.targ>)
tag(ovladac).tag(players,<eval <tag(ovladac).tag(players)>+1>)

tag(ovladac).tag(number_of[<arg(hrac)>],<tag(ovladac).tag(players)>)

tag(ovladac).tag(player_<tag(ovladac).tag(players)>,<arg(hrac)>)
tag(ovladac).tag(player_<tag(ovladac).tag(players)>_health,100)
tag(ovladac).tag(player_<tag(ovladac).tag(players)>_munition,6)
tag(ovladac).tag(player_<tag(ovladac).tag(players)>_lifes,3)
tag(ovladac).tag(player_<tag(ovladac).tag(players)>_medkit,0)
tag(ovladac).tag(player_<tag(ovladac).tag(players)>_kills,0)

arg(hrac).tag(shooter_control,<tag(ovladac)>)

arg(hrac).flag_immobile=1
arg(hrac).dir=0
arg(hrac).resync
arg(hrac).go <shooter_spawn_<eval <rand(12)>+1>>

[function reload]
if !(src.tag(shooter_control))
	src.sysmessage("Nieje pre teba")
	return 0
endif
if (<src.tag(shooter_next)> > <serv.time>)
  classMessage("Jeste nemuzes pouzit.")
  return 0
endif

arg(mynumber,<src.tag(shooter_control).tag(number_of[<uid>])>)
src.tag(shooter_control).tag(player_<arg(mynumber)>_munition,6)

src.tag(shooter_next,<eval <serv.time>+20>)

[function fire]
if !(src.tag(shooter_control))
	src.sysmessage("Nieje pre teba")
	return 0
endif
if (<src.tag(shooter_next)> > <serv.time>)
  classMessage("Jeste nemuzes pouzit.")
  return 0
endif

arg(mynumber,<src.tag(shooter_control).tag(number_of[<uid>])>)

if (<src.tag(shooter_control).tag(player_<arg(mynumber)>_munition)> == 0)
	src.sysmessage("Nemas naboje, nabij zbran")
	return 0
endif

src.tag(shooter_control).tag(player_<arg(mynumber)>_munition,<src.tag(shooter_control).tag(player_<arg(mynumber)>_munition)>-1)

arg(i,1)
arg(distance,1000)
while (i <= <tag(shooter_control).tag(players)>)
	if !(<src.tag(shooter_control).tag(player_<arg(i)>)> == <uid>)
	  if (<src.dir> == 0)
			if (<src.p_y> > <src.tag(shooter_control).tag(player_<i>).p_y>)&&(<src.p_x> == <src.tag(shooter_control).tag(player_<i>).p_x>)
				if (src.tag(shooter_control).tag(player_<i>).srccombatLOS)
					if (<arg(distance)> > <eval <src.p_y>-<src.tag(shooter_control).tag(player_<i>).p_y>>)
						arg(distance,<eval <src.p_y>-<src.tag(shooter_control).tag(player_<i>).p_y>>)
						arg(target,<src.tag(shooter_control).tag(player_<i>)>)
					endif
				endif
			endif
		elseif (<src.dir> == 4)
			if (<src.p_y> < <src.tag(shooter_control).tag(player_<i>).p_y>)&&(<src.p_x> == <src.tag(shooter_control).tag(player_<i>).p_x>)
				if (src.tag(shooter_control).tag(player_<i>).srccombatLOS)
					if (<arg(distance)> > <eval <src.tag(shooter_control).tag(player_<i>).p_y>-<src.p_y>>)
						arg(distance,<eval <src.tag(shooter_control).tag(player_<i>).p_y>-<src.p_y>>)
						arg(target,<src.tag(shooter_control).tag(player_<i>)>)
					endif
				endif
			endif
		elseif (<src.dir> == 2)
			if (<src.p_x> < <src.tag(shooter_control).tag(player_<i>).p_x>)&&(<src.p_y> == <src.tag(shooter_control).tag(player_<i>).p_y>)
				if (src.tag(shooter_control).tag(player_<i>).srccombatLOS)
					if (<arg(distance)> > <eval <src.tag(shooter_control).tag(player_<i>).p_x>-<src.p_x>>)
						arg(distance,<eval <src.tag(shooter_control).tag(player_<i>).p_x>-<src.p_x>>)
						arg(target,<src.tag(shooter_control).tag(player_<i>)>)
					endif
				endif
			endif
		elseif (<src.dir> == 6)
			if (<src.p_x> > <src.tag(shooter_control).tag(player_<i>).p_x>)&&(<src.p_y> == <src.tag(shooter_control).tag(player_<i>).p_y>)
				if (src.tag(shooter_control).tag(player_<i>).srccombatLOS)
					if (<arg(distance)> > <eval <src.p_x>-<src.tag(shooter_control).tag(player_<i>).p_x>>)
						arg(distance,<eval <src.p_x>-<src.tag(shooter_control).tag(player_<i>).p_x>>)
						arg(target,<src.tag(shooter_control).tag(player_<i>)>)
					endif
				endif
			endif
		endif
  endif
arg(i,#+1)
endwhile


	
if (arg(target))
	arg(hisnumber,<src.tag(shooter_control).tag(number_of[<arg(target)>])>)
	arg(dmg,<eval 55-<eval <arg(distance)>*5>>)
	src.sysmessage("Trafil jsi hraca <arg(target).name>")
  arg(target).effect(0,i_cannon_ball,2,16,0)
	if (<src.tag(shooter_control).tag(player_<arg(hisnumber)>_health)> > <arg(dmg)>)
		src.tag(shooter_control).tag(player_<arg(hisnumber)>_health,<eval <src.tag(shooter_control).tag(player_<arg(hisnumber)>_health)>-<arg(dmg)>>)
	  arg(target).sysmessage("Trafil ta hrac <src.name>, ostava ti <src.tag(shooter_control).tag(player_<arg(hisnumber)>_health)> hp")
	else
		src.tag(shooter_control).tag(player_<arg(mynumber)>_kills,<eval <src.tag(shooter_control).tag(player_<arg(mynumber)>_kills)>+1>)
		src.tag(shooter_control).tag(player_<arg(hisnumber)>_lifes,<eval <src.tag(shooter_control).tag(player_<arg(hisnumber)>_lifes)>-1>)
		if (<rand(2)> == 1)
			newitem=i_shooter_medkit
      lastnew.p=<shooter_spawn_<eval <rand(12)>+1>>
    endif
		if (<src.tag(shooter_control).tag(player_<arg(hisnumber)>_lifes)> > 0)
		  src.tag(shooter_control).tag(player_<arg(hisnumber)>_health,100)
		  src.tag(shooter_control).tag(player_<arg(hisnumber)>).go <shooter_spawn_<eval <rand(12)>+1>>
		  src.tag(shooter_control).tag(player_<arg(hisnumber)>_munition,6)
		  src.tag(shooter_control).tag(player_<arg(hisnumber)>_medkit,0)
		  src.sysmessage("Zabil jsi hraca <arg(target).name>.")
		  arg(target).sysmessage("Zabil ta hrac <src.name>, mas este: <src.tag(shooter_control).tag(player_<arg(hisnumber)>_lifes)> zivot.")
		else
			src.tag(shooter_control).tag(player_<arg(hisnumber)>_health,0)
		  src.tag(shooter_control).tag(player_<arg(hisnumber)>).go <shooter_lobby>
		  src.tag(shooter_control).tag(player_<arg(hisnumber)>).tag.remove(shooter_control)
		  src.tag(shooter_control).tag(player_<arg(hisnumber)>).flag_immobile=0
		  src.sysmessage("Zabil jsi hraca <arg(target).name> a vyradil si ho z hry.")
		  arg(target).sysmessage("Hrac <src.name> ta vyradil z hry.")
		endif
	endif
else
	src.sysmessage("Minul jsi!")
endif
src.tag(shooter_next,<eval <serv.time>+10>)
		
[function shooterinfo]
arg(mynumber,<src.tag(shooter_control).tag(number_of[<uid>])>)
src.sysmessage("Shooter info:")
src.sysmessage("Zivoty: <src.tag(shooter_control).tag(player_<arg(mynumber)>_lifes)>")
src.sysmessage("HP: <src.tag(shooter_control).tag(player_<arg(mynumber)>_health)>")
src.sysmessage("Naboje: <src.tag(shooter_control).tag(player_<arg(mynumber)>_munition)>")
src.sysmessage("Lekarnicky: <src.tag(shooter_control).tag(player_<arg(mynumber)>_medkit)>")

[function shooterscore]
if (src.tag(shooter_control))
  dialog(d_shooter_score)
else
	src.sysMessage("Tato funkce neni pro tebe")
endif

[dialog d_shooter_score]
arg(textcolor,52)
argo.SetLocation=205,150

arg(mynumber,<src.tag(shooter_control).tag(number_of[<uid>])>)

argo.tag(sirka,270)
argo.tag(vyska,<eval <eval <src.tag(shooter_control).tag(players)>*23>+50>)

argo.dialog_prvni
argo.dialog_pozadi(<argo.tag(nexty)>,1)
argo.dialog_pozadi(<argo.tag(nexty)>,1,120,60,60)
arg(i,0)
while (i < <src.tag(shooter_control).tag(players)>)
argo.dialog_pozadi(<argo.tag(nexty)>,1,120,60,60)
	arg(i,#+1)
endwhile
argo.dialog_zpruhledni


argo.texta(<argo.dialog_textpos(0,0)>,42,"Shooter game score:")
argo.texta(<argo.dialog_textpos(1,0)>,<d_def_writecolor>,"Meno:")
argo.texta(<argo.dialog_textpos(1,1)>,<d_def_writecolor>,"Kills:")
argo.texta(<argo.dialog_textpos(1,2)>,<d_def_writecolor>,"Deaths:")
arg(i,1)
while (i <= <src.tag(shooter_control).tag(players)>)
argo.texta(<argo.dialog_textpos(<eval <arg(i)>+1>,0)>,<d_def_readcolor>,"<src.tag(shooter_control).tag(player_<arg(i)>).name>")
argo.texta(<argo.dialog_textpos(<eval <arg(i)>+1>,1)>,<d_def_readcolor>,"<src.tag(shooter_control).tag(player_<arg(i)>_kills)>")
argo.texta(<argo.dialog_textpos(<eval <arg(i)>+1>,2)>,<d_def_readcolor>,"<eval 3-<src.tag(shooter_control).tag(player_<arg(i)>_lifes)>>")
	arg(i,#+1)
endwhile

[defnames shooter_ports]
shooter_lobby 5927,129,0,11
shooter_spawn_1 5986,126,0,11
shooter_spawn_2 5993,128,0,11
shooter_spawn_3 6003,125,0,11
shooter_spawn_4 6003,135,0,11
shooter_spawn_5 5996,137,0,11
shooter_spawn_6 5986,139,0,11
shooter_spawn_7 5988,146,0,11
shooter_spawn_8 5983,152,0,11
shooter_spawn_9 5994,151,0,11
shooter_spawn_10 6006,140,0,11
shooter_spawn_11 6001,147,0,11
shooter_spawn_12 6005,142,0,11


[function medkit]
if !(src.tag(shooter_control))
	src.sysmessage("Nieje pre teba")
	return 0
endif
if (<src.tag(shooter_next)> > <serv.time>)
  classMessage("Jeste nemuzes pouzit.")
  return 0
endif

arg(mynumber,<src.tag(shooter_control).tag(number_of[<uid>])>)

if (<src.tag(shooter_control).tag(player_<arg(mynumber)>_medkit)> == 0)
	src.sysmessage("Nemas zadnu lekarnicku")
  return 0
endif

if (<src.tag(shooter_control).tag(player_<arg(mynumber)>_health)> < 50)
  src.tag(shooter_control).tag(player_<arg(mynumber)>_health,<eval <src.tag(shooter_control).tag(player_<arg(mynumber)>_health)>+50>)
else
	src.tag(shooter_control).tag(player_<arg(mynumber)>_health,100)
endif

src.tag(shooter_control).tag(player_<arg(mynumber)>_medkit,<eval <src.tag(shooter_control).tag(player_<arg(mynumber)>_medkit)>-1>)
src.sysmessage("Pouzil si lekarnicku, tvoje hp su: <src.tag(shooter_control).tag(player_<arg(mynumber)>_health)>")
	
src.tag(shooter_next,<eval <serv.time>+10>)

[ITEMDEF i_shooter_medkit]
ID=0bab
Name=Medkit
TYPE=T_normal

ON=@CREATE
attr=010
timer=60

ON=@Timer
remove
return 1

on=@step
if (src.isgm)
	return 0
endif
if (src.isplayer)
	if (src.tag(shooter_control))
		arg(mynumber,<src.tag(shooter_control).tag(number_of[<src.uid>])>)
		src.tag(shooter_control).tag(player_<arg(mynumber)>_medkit,<eval <src.tag(shooter_control).tag(player_<arg(mynumber)>_medkit)>+1>)
		src.sysmessage("Ziskal si lekarnicku")
		remove
		return 1
	endif
endif


//////////////////////////////////////////////////
//////////////////////////////////////////////////
//////////////////////////////////////////////////

// golden dragon

//////////////////////////////////////////////////
//////////////////////////////////////////////////
//////////////////////////////////////////////////

[defnames golden_dragon_morph]
golden_dragon_morph_amount 1 // pocet verzii - morfov

// 1. morf - idealne defaultne nastavenie toho draka

golden_dragon_morph_color[0] 0650 // farba draka

golden_dragon_morph_dragon_fire_aura_chance[0] 1000 // draci aura, vsetko ako ked to nastavujes do tagov
golden_dragon_morph_dragon_fire_aura_delay[0] 30
golden_dragon_morph_dragon_fire_aura_speed[0] 5
golden_dragon_morph_dragon_fire_aura_power[0] 10
golden_dragon_morph_dragon_fire_aura_dmg[0] 50
golden_dragon_morph_dragon_fire_aura_resist[0] 1

golden_dragon_morph_dragon_fire_chance[0] 800  // draci ohen, rovnako ako ked nastavujes do tagov
golden_dragon_morph_dragon_fire_dmg[0] 105
golden_dragon_morph_dragon_fire_type[0] 4
golden_dragon_morph_dragon_fire_delay[0] 20

golden_dragon_morph_dragon_fire_bomb_chance[0] 800        // sanca zasadenia v promile
golden_dragon_morph_dragon_fire_bomb_dmg[0] 40		// dmg po prejdeni
golden_dragon_morph_dragon_fire_bomb_type[0] 1		// typ ohna - 1 az 5 
golden_dragon_morph_dragon_fire_bomb_delay[0] 10		// prodleva kedy zase moze pustit ohen

golden_dragon_morph_dragon_fire_cage_chance[0] 1000       // sanca v promile
golden_dragon_morph_dragon_fire_cage_delay[0] 25          // prodleva v sekundach medzi klietkami
golden_dragon_morph_dragon_fire_cage_type[0] 4            // typ ohna, rovnako ako utoky - 1 az 5
golden_dragon_morph_dragon_fire_cage_duration[0] 16       // kolko sekund bude klietka existovat

golden_dragon_morph_fire_dragon_round_chance[0] 1000      // 100% - sanca v promile
golden_dragon_morph_fire_dragon_round_delay[0] 40         // 40 sek - prodleva mezi pustenim roundu
golden_dragon_morph_fire_dragon_round_turns[0] 2 		// 2 otocka - pocet otociek
golden_dragon_morph_fire_dragon_round_type[0] 1 		// typ ohne 1 - zapali
golden_dragon_morph_fire_dragon_round_dmg[0] 100 		// max dmg

golden_dragon_morph_regeneration_hp[0] 2000                // pocet hp ktore zregeneruje
golden_dragon_morph_regeneration_speed[0] 10               // rychlost regeneracie v sekundach

golden_dragon_morph_npc_summoning_chance[0] 400      //40%
golden_dragon_morph_npc_summoning_time[0] 190        //nezakouzli znovu v sek
golden_dragon_morph_npc_summoning_count[0] 4         //pocet
golden_dragon_morph_npc_summoning_char_0_[0] c_elem_fire_dragon
golden_dragon_morph_npc_summoning_char_1_[0] c_elem_fire_dragon
golden_dragon_morph_npc_summoning_char_2_[0] c_elem_fire
golden_dragon_morph_npc_summoning_char_3_[0] c_elem_fire

golden_dragon_morph_npc_bleed[0] 1000 // 100% sanca na bleed

golden_dragon_morph_npc_critic_chance[0] 350               //25% chance
golden_dragon_morph_npc_critic_dmg[0] 35,40                //dmg in between

golden_dragon_morph_npc_port_timer[0] 10
golden_dragon_morph_npc_port_distance[0] 6

golden_dragon_morph_resist_poison[0] 00
golden_dragon_morph_resist_summon[0] 1000
golden_dragon_morph_resist_para[0] 1000
golden_dragon_morph_resist_bleed[0] 00   //krvaci dost

golden_dragon_morph_resist_sharp[0] 900
golden_dragon_morph_resist_slash[0] 990   // sekery
golden_dragon_morph_resist_pierce[0] 600
golden_dragon_morph_resist_blunt[0] 800

golden_dragon_morph_resist_fire[0] 450
golden_dragon_morph_resist_elect[0] 1000
golden_dragon_morph_resist_cold[0] 700

golden_dragon_morph_explode_dmg[0] 100

golden_dragon_morph_npc_stun_time[0] 20              //2 seconds of stun
golden_dragon_morph_npc_stun_chance[0] 300           //35%, defaultne 20% 

////

/////////////////////////////// dalsie morfy

[events e_golden_dragon_morph]
on=@beforegetswing
on=@aftergetswing
golden_dragon_morph

on=@beforegeteffect
on=@Created
on=@DrinkingPotion
on=@afterswing

on=@beforedoeffect
on=@spelleffect
golden_dragon_morph


[function golden_dragon_morph]
if (chance(<tag(golden_dragon_morph_chance)>,3)) // chance in promiles
	if !(tag(nextgoldendragonmorph))
		tag(nextgoldendragonmorph,0)
	endif
  if (<eval tag(nextgoldendragonmorph)> < <serv.time>)
    tag(nextgoldendragonmorph,<serv.time>+(<tag(golden_dragon_morph_delay)>*10))
    emote(" is changing")
    f_golden_dragon_morph
  endif
endif

[function f_golden_dragon_morph]
arg(morph_number,<eval {1  <golden_dragon_morph_amount>}-1>)

color = <golden_dragon_morph_color[<arg(morph_number)>]>

tag(dragon_fire_aura_chance,<golden_dragon_morph_dragon_fire_aura_chance[<arg(morph_number)>]>)
tag(dragon_fire_aura_delay,<golden_dragon_morph_dragon_fire_aura_delay[<arg(morph_number)>]>)
tag(dragon_fire_aura_speed,<golden_dragon_morph_dragon_fire_aura_speed[<arg(morph_number)>]>)
tag(dragon_fire_aura_power,<golden_dragon_morph_dragon_fire_aura_power[<arg(morph_number)>]>)
tag(dragon_fire_aura_dmg,<golden_dragon_morph_dragon_fire_aura_dmg[<arg(morph_number)>]>)
tag(dragon_fire_aura_resist,<golden_dragon_morph_dragon_fire_aura_resist[<arg(morph_number)>]>)

tag(dragon_fire_chance,<golden_dragon_morph_dragon_fire_chance[<arg(morph_number)>]>)
tag(dragon_fire_dmg,<golden_dragon_morph_dragon_fire_dmg[<arg(morph_number)>]>)
tag(dragon_fire_type,<golden_dragon_morph_dragon_fire_type[<arg(morph_number)>]>)
tag(dragon_fire_delay,<golden_dragon_morph_dragon_fire_delay[<arg(morph_number)>]>)

tag(dragon_fire_bomb_chance,<golden_dragon_morph_dragon_fire_bomb_chance[<arg(morph_number)>]>)
tag(dragon_fire_bomb_dmg,<golden_dragon_morph_dragon_fire_bomb_dmg[<arg(morph_number)>]>)
tag(dragon_fire_bomb_type,<golden_dragon_morph_dragon_fire_bomb_type[<arg(morph_number)>]>)
tag(dragon_fire_bomb_delay,<golden_dragon_morph_dragon_fire_bomb_delay[<arg(morph_number)>]>)

tag(dragon_fire_cage_chance,<golden_dragon_morph_dragon_fire_cage_chance[<arg(morph_number)>]>)
tag(dragon_fire_cage_delay,<golden_dragon_morph_dragon_fire_cage_delay[<arg(morph_number)>]>)
tag(dragon_fire_cage_type,<golden_dragon_morph_dragon_fire_cage_type[<arg(morph_number)>]>)
tag(dragon_fire_cage_duration,<golden_dragon_morph_dragon_fire_cage_duration[<arg(morph_number)>]>)

tag(fire_dragon_round_chance,<golden_dragon_morph_fire_dragon_round_chance[<arg(morph_number)>]>)
tag(fire_dragon_round_delay,<golden_dragon_morph_fire_dragon_round_delay[<arg(morph_number)>]>)
tag(fire_dragon_round_turns,<golden_dragon_morph_fire_dragon_round_turns[<arg(morph_number)>]>)
tag(fire_dragon_round_type,<golden_dragon_morph_fire_dragon_round_type[<arg(morph_number)>]>)
tag(fire_dragon_round_dmg,<golden_dragon_morph_fire_dragon_round_dmg[<arg(morph_number)>]>)

tag(regeneration_hp,<golden_dragon_morph_regeneration_hp[<arg(morph_number)>]>)
tag(regeneration_speed,<golden_dragon_morph_regeneration_speed[<arg(morph_number)>]>)

tag(npc_summoning_chance,<golden_dragon_morph_npc_summoning_chance[<arg(morph_number)>]>)
tag(npc_summoning_time,<golden_dragon_morph_npc_summoning_time[<arg(morph_number)>]>)
tag(npc_summoning_count,<golden_dragon_morph_npc_summoning_count[<arg(morph_number)>]>)

////

arg(i,1)
arg(summ_coung,<golden_dragon_morph_npc_summoning_count[<arg(morph_number)>]>)
while (i <= <arg(summ_coung)>)
tag(npc_summoning_char[<eval <i>-1>],<golden_dragon_morph_npc_summoning_char_<eval <i>-1>_[<arg(morph_number)>]>)
arg(i,#+1)
endwhile

////

tag(npc_bleed,<golden_dragon_morph_npc_bleed[<arg(morph_number)>]>)

tag(npc_critic_chance,<golden_dragon_morph_npc_critic_chance[<arg(morph_number)>]>)
tag(npc_critic_dmg,<golden_dragon_morph_npc_critic_dmg[<arg(morph_number)>]>)

tag(npc_port_timer,<golden_dragon_morph_npc_port_timer[<arg(morph_number)>]>)
tag(npc_port_distance,<golden_dragon_morph_npc_port_distance[<arg(morph_number)>]>)

tag(resist_poison,<golden_dragon_morph_resist_poison[<arg(morph_number)>]>)
tag(resist_summon,<golden_dragon_morph_resist_summon[<arg(morph_number)>]>)
tag(resist_para,<golden_dragon_morph_resist_para[<arg(morph_number)>]>)
tag(resist_bleed,<golden_dragon_morph_resist_bleed[<arg(morph_number)>]>)

tag(resist_sharp,<golden_dragon_morph_resist_sharp[<arg(morph_number)>]>)
tag(resist_slash,<golden_dragon_morph_resist_slash[<arg(morph_number)>]>)
tag(resist_pierce,<golden_dragon_morph_resist_pierce[<arg(morph_number)>]>)
tag(resist_blunt,<golden_dragon_morph_resist_blunt[<arg(morph_number)>]>)

tag(resist_fire,<golden_dragon_morph_resist_fire[<arg(morph_number)>]>)
tag(resist_elect,<golden_dragon_morph_resist_elect[<arg(morph_number)>]>)
tag(resist_cold,<golden_dragon_morph_resist_cold[<arg(morph_number)>]>)

tag(explode_dmg,<golden_dragon_morph_explode_dmg[<arg(morph_number)>]>)

tag(npc_stun_time,<golden_dragon_morph_npc_stun_time[<arg(morph_number)>]>)
tag(npc_stun_chance,<golden_dragon_morph_npc_stun_chance[<arg(morph_number)>]>)